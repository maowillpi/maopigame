<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ğŸ° MAOè½¬ç›˜æ¸¸æˆ - AlveyChain åŒºå—é“¾æ¸¸æˆ v4.1.0 è¥é”€é’±åŒ…ç‰ˆ</title>
    
    <!-- å¼ºåˆ¶ç¼“å­˜æ¸…é™¤ v4.1.0 è¥é”€é’±åŒ…ç‰ˆ -->
    <script>
        const CACHE_VERSION = 'v4.1.0-marketing-' + Date.now();
        console.log('ğŸš€ MAOè½¬ç›˜æ¸¸æˆ v4.1.0 è¥é”€é’±åŒ…ç‰ˆ - å¼ºåˆ¶æ›´æ–°');
        console.log('ğŸ“… ç¼“å­˜ç‰ˆæœ¬:', CACHE_VERSION);
        console.log('ğŸ¯ éƒ¨ç½²æ—¶é—´:', new Date().toLocaleString('zh-CN'));
        
        // å¼ºåˆ¶æ¸…é™¤æ‰€æœ‰æ—§ç¼“å­˜
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                    console.log('ğŸ—‘ï¸ æ¸…é™¤Service Worker');
                }
            });
        }
        
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => {
                    caches.delete(name);
                    console.log('ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜:', name);
                });
            });
        }
        
        // é¡µé¢ç‰ˆæœ¬æ£€æŸ¥
        const lastVersion = localStorage.getItem('mao_game_version');
        if (lastVersion !== CACHE_VERSION) {
            console.log('ğŸ”„ æ£€æµ‹åˆ°v4.1.0è¥é”€é’±åŒ…ç‰ˆæœ¬ï¼Œå¼ºåˆ¶æ›´æ–°ç¼“å­˜');
            localStorage.setItem('mao_game_version', CACHE_VERSION);
            
            // æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
            console.log('âœ… å·²æ›´æ–°åˆ°MAOè½¬ç›˜æ¸¸æˆv4.1.0è¥é”€é’±åŒ…ç‰ˆæœ¬ï¼');
            console.log('ğŸŒŸ æ–°åŠŸèƒ½: åˆ†ç¦»ä»£å¸æˆæƒ + ä¼˜åŒ–é’±åŒ…è¿æ¥ + ä¸“ä¸šè½¬ç›˜ç•Œé¢');
        }
        
        // å¼ºåˆ¶ç¦ç”¨ç¼“å­˜
        if (window.location.search.indexOf('nocache') === -1) {
            const separator = window.location.search ? '&' : '?';
            const newUrl = window.location.href + separator + 'nocache=' + Date.now();
            if (lastVersion && lastVersion !== CACHE_VERSION) {
                console.log('ğŸ”„ å¼ºåˆ¶åˆ·æ–°é¡µé¢æ¸…é™¤ç¼“å­˜');
                window.location.replace(newUrl);
            }
        }
    </script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ethers.js CDN - ä½¿ç”¨æ›´ç¨³å®šçš„ç‰ˆæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <style>
        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        .wheel-animation {
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .bounce-animation {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        .bg-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ğŸ° è¶…çº§ä¸“ä¸šè½¬ç›˜è®¾è®¡ */
        .super-wheel {
            background: conic-gradient(
                from 0deg,
                #FF6B9D 0deg 210.24deg,    /* è°¢è°¢æƒ é¡¾ 58% */
                #4ECDC4 210.24deg 289.44deg,  /* å°å¥– 22% */
                #45B7D1 289.44deg 332.64deg, /* ä¸­å¥– 12% */
                #96CEB4 332.64deg 354.24deg, /* å¤§å¥– 6% */
                #FFEAA7 354.24deg 359.64deg, /* è¶…çº§å¤§å¥– 1.5% */
                #DDA0DD 359.64deg 360deg  /* ç»ˆæå¤§å¥– 0.5% */
            );
            border: 15px solid #FFD700;
            box-shadow: 
                0 0 80px rgba(255, 215, 0, 0.9),
                inset 0 0 50px rgba(0, 0, 0, 0.3),
                0 0 150px rgba(255, 215, 0, 0.7),
                0 0 250px rgba(255, 255, 255, 0.2);
            position: relative;
            animation: wheelGlow 5s ease-in-out infinite alternate;
            transform-style: preserve-3d;
        }
        
        @keyframes wheelGlow {
            0% { 
                box-shadow: 
                    0 0 80px rgba(255, 215, 0, 0.9),
                    inset 0 0 50px rgba(0, 0, 0, 0.3),
                    0 0 150px rgba(255, 215, 0, 0.7);
                transform: rotateX(0deg) scale(1);
            }
            100% { 
                box-shadow: 
                    0 0 120px rgba(255, 215, 0, 1),
                    inset 0 0 50px rgba(0, 0, 0, 0.3),
                    0 0 200px rgba(255, 215, 0, 0.9);
                transform: rotateX(3deg) scale(1.02);
            }
        }
        
        /* è½¬ç›˜å†…åœˆè£…é¥° */
        .super-wheel::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 25px;
            right: 25px;
            bottom: 25px;
            border-radius: 50%;
            border: 8px solid rgba(255, 255, 255, 0.7);
            z-index: 1;
            box-shadow: 
                inset 0 0 40px rgba(255, 255, 255, 0.4),
                0 0 30px rgba(255, 255, 255, 0.6);
            animation: innerRing 4s ease-in-out infinite alternate;
        }

        @keyframes innerRing {
            0% { 
                border-color: rgba(255, 255, 255, 0.7);
                box-shadow: inset 0 0 40px rgba(255, 255, 255, 0.4);
            }
            100% { 
                border-color: rgba(255, 255, 255, 1);
                box-shadow: inset 0 0 60px rgba(255, 255, 255, 0.6);
            }
        }
        
        /* ä¸“ä¸šè½¬ç›˜åŒºåŸŸ */
        .super-wheel-section {
            position: absolute;
            z-index: 10;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .super-emoji {
            font-size: 32px;
            margin-bottom: 4px;
            display: block;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }
        
        .probability-display {
            font-size: 10px;
            color: #FFD700;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .super-reward-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            font-size: 11px;
            font-weight: 900;
            padding: 2px 6px;
            border-radius: 12px;
            margin-top: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }
        
        /* è¶…çº§MAO Logoè®¾è®¡ */
        .super-mao-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb, #ff6b9d);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 900;
            color: white;
            text-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.8),
                0 0 25px rgba(102, 126, 234, 1),
                0 0 35px rgba(255, 107, 157, 0.8);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.6),
                inset 0 4px 8px rgba(255, 255, 255, 0.4),
                0 0 50px rgba(102, 126, 234, 0.8);
            border: 5px solid rgba(255, 255, 255, 0.8);
            z-index: 20;
            animation: logoFloat 8s ease-in-out infinite;
        }
        
        @keyframes logoFloat {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                text-shadow: 0 4px 8px rgba(0, 0, 0, 0.8), 0 0 25px rgba(102, 126, 234, 1);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.05) rotate(5deg);
                text-shadow: 0 6px 12px rgba(0, 0, 0, 0.8), 0 0 35px rgba(255, 107, 157, 1);
            }
        }
        
        /* è¶…çº§æŒ‡é’ˆè®¾è®¡ */
        .super-pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 60px solid #FFD700;
            z-index: 30;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.8));
            animation: pointerGlow 3s ease-in-out infinite alternate;
        }
        
        .super-pointer::before {
            content: '';
            position: absolute;
            top: -58px;
            left: -20px;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 1),
                inset 0 2px 4px rgba(255, 255, 255, 0.7);
        }
        
        @keyframes pointerGlow {
            0% { 
                filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 15px rgba(255, 215, 0, 0.8));
            }
            100% { 
                filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 30px rgba(255, 215, 0, 1));
            }
        }
        
        /* è¶…çº§æ¸¸æˆæŒ‰é’® */
        .super-spin-btn {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #FFD700, #FFA500, #FF8C00);
            border: 6px solid white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            box-shadow: 
                0 15px 30px rgba(0, 0, 0, 0.6),
                inset 0 4px 8px rgba(255, 255, 255, 0.6),
                0 0 40px rgba(255, 215, 0, 0.8);
            animation: spinBtnGlow 2s ease-in-out infinite alternate;
        }
        
        .super-spin-btn:hover {
            transform: scale(1.1);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.8),
                inset 0 4px 8px rgba(255, 255, 255, 0.6),
                0 0 60px rgba(255, 215, 0, 1);
        }
        
        @keyframes spinBtnGlow {
            0% { 
                box-shadow: 
                    0 15px 30px rgba(0, 0, 0, 0.6),
                    inset 0 4px 8px rgba(255, 255, 255, 0.6),
                    0 0 40px rgba(255, 215, 0, 0.8);
            }
            100% { 
                box-shadow: 
                    0 15px 30px rgba(0, 0, 0, 0.6),
                    inset 0 4px 8px rgba(255, 255, 255, 0.6),
                    0 0 60px rgba(255, 215, 0, 1);
            }
        }
        
        /* é’±åŒ…è¿æ¥ä¼˜åŒ–ç•Œé¢ */
        .wallet-connect-container {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.2), 
                rgba(118, 75, 162, 0.2),
                rgba(240, 147, 251, 0.2)
            );
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .wallet-status-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .wallet-status-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* æˆæƒçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .approval-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            transition: all 0.3s ease;
        }
        
        .approval-indicator.approved {
            background: #10B981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
        }
        
        .approval-indicator.not-approved {
            background: #EF4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            animation: pulse 2s infinite;
        }
        
        /* ä»£å¸æŒ‰é’®ä¼˜åŒ– */
        .token-select-btn {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .token-select-btn.selected {
            background: linear-gradient(135deg, #10B981, #059669);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            transform: scale(1.05);
        }
        
        .token-select-btn.unselected {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }
        
        /* æˆæƒæŒ‰é’®åŠ¨ç”» */
        .approve-btn {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .approve-btn:hover {
            background: linear-gradient(135deg, #FBBF24, #F59E0B);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }
        
        .approve-btn.approved {
            background: linear-gradient(135deg, #10B981, #059669);
            cursor: default;
        }
        
        /* è¿æ¥è¿›åº¦æ¡ */
        .connection-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .connection-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10B981, #059669);
            border-radius: 2px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    
    <!-- é¡µé¢å®¹å™¨ -->
    <div class="container mx-auto px-4 py-2 max-w-md">
        
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-4">
            <h1 class="text-2xl font-bold text-white mb-2">
                ğŸ° MAOè½¬ç›˜æ¸¸æˆ
            </h1>
            <p class="text-blue-200 text-sm">
                AlveyChain åŒºå—é“¾æ¸¸æˆ v4.1.0 è¥é”€é’±åŒ…ç‰ˆ
            </p>
            <div class="text-xs text-green-400 mt-1">
                âœ¨ åˆ†ç¦»æˆæƒ Â· ä¸“ä¸šè½¬ç›˜ Â· ä¼˜åŒ–ä½“éªŒ
            </div>
        </div>

        <!-- è¿æ¥è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div id="connectionProgress" class="hidden mb-4">
            <div class="wallet-connect-container rounded-xl p-4">
                <div class="text-center">
                    <div class="text-white font-semibold mb-2" id="progressText">æ­£åœ¨è¿æ¥é’±åŒ…...</div>
                    <div class="connection-progress">
                        <div class="connection-progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="text-blue-200 text-sm mt-2" id="progressSubtext">è¯·ç¨å€™...</div>
                </div>
            </div>
        </div>

        <!-- é’±åŒ…è¿æ¥ç•Œé¢ -->
        <div id="walletConnect" class="space-y-4">
            <div class="wallet-connect-container rounded-xl p-6">
                <div class="text-center mb-4">
                    <div class="text-4xl mb-3">ğŸ”—</div>
                    <h2 class="text-xl font-bold text-white mb-2">è¿æ¥Web3é’±åŒ…</h2>
                    <p class="text-blue-200 text-sm mb-4">
                        è¯·ä½¿ç”¨æ”¯æŒAlveyChainçš„é’±åŒ…è¿æ¥
                    </p>
                </div>
                
                <!-- æ¨èé’±åŒ… -->
                <div class="mb-4">
                    <h3 class="text-white font-semibold mb-3 text-sm">ğŸ“± æ¨èé’±åŒ…</h3>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div class="wallet-status-card rounded-lg p-3 text-center">
                            <div class="text-lg mb-1">ğŸ”µ</div>
                            <div class="text-white font-semibold">TPé’±åŒ…</div>
                            <div class="text-blue-200">æ¨èä½¿ç”¨</div>
                        </div>
                        <div class="wallet-status-card rounded-lg p-3 text-center">
                            <div class="text-lg mb-1">ğŸ›¡ï¸</div>
                            <div class="text-white font-semibold">Trust Wallet</div>
                            <div class="text-blue-200">å¸å®‰å®˜æ–¹</div>
                        </div>
                        <div class="wallet-status-card rounded-lg p-3 text-center">
                            <div class="text-lg mb-1">ğŸ¦Š</div>
                            <div class="text-white font-semibold">MetaMask</div>
                            <div class="text-blue-200">æ¡Œé¢æµè§ˆå™¨</div>
                        </div>
                        <div class="wallet-status-card rounded-lg p-3 text-center">
                            <div class="text-lg mb-1">ğŸ“±</div>
                            <div class="text-white font-semibold">å…¶ä»–é’±åŒ…</div>
                            <div class="text-blue-200">å…¼å®¹Web3</div>
                        </div>
                    </div>
                </div>
                
                <!-- è¿æ¥æŒ‰é’® -->
                <button 
                    id="connectBtn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
                >
                    ğŸ”— è¿æ¥é’±åŒ…å¼€å§‹æ¸¸æˆ
                </button>
            </div>
            
            <!-- å¥–åŠ±é¢„è§ˆ -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ’° ä¸“ä¸šå¥–åŠ±ç³»ç»Ÿ</h3>
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ</div>
                        <div class="text-yellow-400 font-bold">å°å¥– 22%</div>
                        <div class="text-white text-xs">105 MAO</div>
                        <div class="text-green-400 text-xs">æœ‰ç›ˆåˆ©ï¼</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ†</div>
                        <div class="text-yellow-400 font-bold">ä¸­å¥– 12%</div>
                        <div class="text-white text-xs">150 MAO</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ’</div>
                        <div class="text-yellow-400 font-bold">å¤§å¥– 6%</div>
                        <div class="text-white text-xs">250 MAO</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ’°</div>
                        <div class="text-yellow-400 font-bold">ç»ˆæå¤§å¥–</div>
                        <div class="text-white text-xs">700 MAO</div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <p class="text-xs text-green-300">
                        ğŸ‰ 42%è¶…é«˜ä¸­å¥–ç‡ Â· å°å¥–æœ‰ç›ˆåˆ© Â· å³æ—¶åˆ°è´¦ï¼
                    </p>
                </div>
            </div>

            <!-- æ¸¸æˆè¯´æ˜ -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ“– æ¸¸æˆè¯´æ˜</h3>
                <ul class="text-blue-200 text-sm space-y-2">
                    <li>â€¢ æ¯æ¬¡æ¸¸æˆæ¶ˆè€— 100 MAO æˆ– 1,000 PI</li>
                    <li>â€¢ çœŸå®åˆçº¦å¥–åŠ±ç³»ç»Ÿï¼Œ42%ä¸­å¥–ç‡</li>
                    <li>â€¢ å°å¥–æœ‰ç›ˆåˆ©æ„Ÿï¼Œæœ€é«˜å¥–åŠ±7å€ï¼ˆ700 MAO / 7K PIï¼‰</li>
                    <li>â€¢ åŸºäºAlveyChainæ™ºèƒ½åˆçº¦ï¼Œå…¬å¹³é€æ˜</li>
                    <li>â€¢ æ”¯æŒTPé’±åŒ…ã€Trust Walletç­‰ä¸»æµé’±åŒ…</li>
                    <li>â€¢ å¥–åŠ±è‡ªåŠ¨è½¬è´¦ï¼Œå³æ—¶åˆ°è´¦</li>
                </ul>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameInterface" class="space-y-4" style="display: none;">
            
            <!-- é’±åŒ…çŠ¶æ€å¡ç‰‡ -->
            <div class="wallet-connect-container rounded-xl p-4">
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <p class="text-blue-200 text-xs">é’±åŒ…åœ°å€</p>
                        <p class="text-white text-sm font-mono" id="userAddress">æœªè¿æ¥</p>
                    </div>
                    <div class="text-right">
                        <p class="text-blue-200 text-xs">ç½‘ç»œçŠ¶æ€</p>
                        <p class="text-green-400 font-bold text-sm">âœ… AlveyChain</p>
                    </div>
                </div>
                
                <!-- ä½™é¢åˆ·æ–°æŒ‰é’® -->
                <button 
                    id="refreshBalanceBtn"
                    class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-all duration-200 transform hover:scale-105"
                    onclick="refreshBalanceManually()"
                >
                    ğŸ”„ åˆ·æ–°ä½™é¢å’ŒæˆæƒçŠ¶æ€
                </button>
            </div>

            <!-- ä»£å¸é€‰æ‹©å’Œæˆæƒ -->
            <div class="wallet-connect-container rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ’° ä»£å¸é€‰æ‹©ä¸æˆæƒ</h3>
                
                <!-- MAOä»£å¸å¡ç‰‡ -->
                <div class="mb-4">
                    <div class="wallet-status-card rounded-xl p-4">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center">
                                <button 
                                    id="maoBtn" 
                                    class="token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 selected"
                                    data-token="MAO"
                                >
                                    MAO
                                </button>
                                <div>
                                    <div class="text-white font-semibold">MAO Token</div>
                                    <div class="text-blue-200 text-sm">100 MAO/æ¬¡</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-yellow-400 font-bold" id="maoBalance">ä½™é¢: 0</div>
                                <div class="flex items-center justify-end mt-1">
                                    <span class="approval-indicator not-approved" id="maoApprovalIndicator"></span>
                                    <span class="text-xs text-blue-200" id="maoApprovalStatus">éœ€è¦æˆæƒ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- MAOæˆæƒæŒ‰é’® -->
                        <button 
                            id="maoApproveBtn"
                            class="w-full approve-btn text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105"
                        >
                            ğŸ”“ æˆæƒ MAO ä»£å¸
                        </button>
                    </div>
                </div>
                
                <!-- PIä»£å¸å¡ç‰‡ -->
                <div class="mb-4">
                    <div class="wallet-status-card rounded-xl p-4">
                        <div class="flex justify-between items-center mb-3">
                            <div class="flex items-center">
                                <button 
                                    id="piBtn" 
                                    class="token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 unselected"
                                    data-token="PI"
                                >
                                    PI
                                </button>
                                <div>
                                    <div class="text-white font-semibold">PI Token</div>
                                    <div class="text-blue-200 text-sm">1,000 PI/æ¬¡</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-yellow-400 font-bold" id="piBalance">ä½™é¢: 0</div>
                                <div class="flex items-center justify-end mt-1">
                                    <span class="approval-indicator not-approved" id="piApprovalIndicator"></span>
                                    <span class="text-xs text-blue-200" id="piApprovalStatus">éœ€è¦æˆæƒ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PIæˆæƒæŒ‰é’® -->
                        <button 
                            id="piApproveBtn"
                            class="w-full approve-btn text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105"
                        >
                            ğŸ”“ æˆæƒ PI ä»£å¸
                        </button>
                    </div>
                </div>
            </div>

            <!-- ä¸“ä¸šè½¬ç›˜æ¸¸æˆ -->
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-white font-bold text-center mb-4 text-lg">ğŸ° ä¸“ä¸šå¹¸è¿è½¬ç›˜</h3>
                
                <!-- ä¸“ä¸šè½¬ç›˜è®¾è®¡ -->
                <div class="flex justify-center mb-4">
                    <div class="relative">
                        <div 
                            id="wheel"
                            class="w-80 h-80 rounded-full super-wheel wheel-animation shadow-2xl relative overflow-hidden"
                        >
                            <!-- è½¬ç›˜å¥–é¡¹åŒºåŸŸ - ä¸“ä¸šç‰ˆ -->
                            <!-- åŒºåŸŸ1: è°¢è°¢æƒ é¡¾ (0-210.24åº¦, 58%) -->
                            <div class="super-wheel-section" style="top: 20px; left: 50%; transform: translateX(-50%);">
                                <div class="super-emoji">ğŸ˜Š</div>
                                <div class="text-xs font-bold mb-1">è°¢è°¢æƒ é¡¾</div>
                                <div class="probability-display">58%</div>
                                <div class="super-reward-badge">0</div>
                            </div>
                            
                            <!-- åŒºåŸŸ2: å°å¥– (210.24-289.44åº¦, 22%) -->
                            <div class="super-wheel-section" style="top: 30px; right: 30px;">
                                <div class="super-emoji">ğŸ</div>
                                <div class="text-xs font-bold mb-1">å°å¥–</div>
                                <div class="probability-display">22%</div>
                                <div class="super-reward-badge" id="reward1">105</div>
                            </div>
                            
                            <!-- åŒºåŸŸ3: ä¸­å¥– (289.44-332.64åº¦, 12%) -->
                            <div class="super-wheel-section" style="top: 60%; right: 15px;">
                                <div class="super-emoji">ğŸ†</div>
                                <div class="text-xs font-bold mb-1">ä¸­å¥–</div>
                                <div class="probability-display">12%</div>
                                <div class="super-reward-badge" id="reward2">150</div>
                            </div>
                            
                            <!-- åŒºåŸŸ4: å¤§å¥– (332.64-354.24åº¦, 6%) -->
                            <div class="super-wheel-section" style="bottom: 30px; left: 50%; transform: translateX(-50%);">
                                <div class="super-emoji">ğŸ’</div>
                                <div class="text-xs font-bold mb-1">å¤§å¥–</div>
                                <div class="probability-display">6%</div>
                                <div class="super-reward-badge" id="reward3">250</div>
                            </div>
                            
                            <!-- åŒºåŸŸ5: è¶…çº§å¤§å¥– (354.24-359.64åº¦, 1.5%) -->
                            <div class="super-wheel-section" style="bottom: 30px; left: 30px;">
                                <div class="super-emoji">ğŸŒŸ</div>
                                <div class="text-xs font-bold mb-1">è¶…çº§</div>
                                <div class="probability-display">1.5%</div>
                                <div class="super-reward-badge" id="reward4">400</div>
                            </div>
                            
                            <!-- åŒºåŸŸ6: ç»ˆæå¤§å¥– (359.64-360åº¦, 0.5%) -->
                            <div class="super-wheel-section" style="top: 30px; left: 30px;">
                                <div class="super-emoji">ğŸ’°</div>
                                <div class="text-xs font-bold mb-1">ç»ˆæ</div>
                                <div class="probability-display">0.5%</div>
                                <div class="super-reward-badge" id="reward5">700</div>
                            </div>
                            
                            <!-- ä¸“ä¸šMAO Logo -->
                            <div class="super-mao-logo">
                                MAO
                            </div>
                        </div>
                        
                        <!-- ä¸“ä¸šæŒ‡é’ˆ -->
                        <div class="super-pointer"></div>
                        
                        <!-- ä¸“ä¸šæ¸¸æˆæ§åˆ¶æŒ‰é’® -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-20 z-30">
                            <button
                                id="spinBtn"
                                class="super-spin-btn font-bold text-lg transition-all duration-300 transform hover:scale-110 text-white"
                            >
                                <div class="relative z-10">
                                    <div class="text-3xl mb-1">ğŸ²</div>
                                    <div class="text-sm font-bold">å¼€å§‹æ¸¸æˆ</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ¸¸æˆçŠ¶æ€ -->
                <div class="glass-effect rounded-lg p-3 mb-4">
                    <div class="text-center">
                        <p class="text-blue-200 text-sm mb-2">
                            æœ¬è½®æŠ•æ³¨: <span class="text-yellow-400 font-bold text-lg" id="betAmount">100 MAO</span>
                        </p>
                        <div id="gameStatus" class="text-white text-sm">
                            å‡†å¤‡å°±ç»ªï¼Œé€‰æ‹©ä»£å¸å¹¶æˆæƒåå³å¯å¼€å§‹æ¸¸æˆï¼
                        </div>
                    </div>
                </div>

                <!-- æ¸¸æˆå†å² -->
                <div class="glass-effect rounded-lg p-3">
                    <h4 class="text-white font-semibold mb-2 text-sm">ğŸ¯ æœ€è¿‘æ¸¸æˆè®°å½•</h4>
                    <div id="gameHistory" class="space-y-1 max-h-32 overflow-y-auto">
                        <div class="text-blue-200 text-xs text-center py-4">æš‚æ— æ¸¸æˆè®°å½•</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬éƒ¨åˆ† -->
    <script>
        // é…ç½®å¸¸é‡
        const ALVEY_NETWORK = {
            chainId: '0xED5', // 3797
            chainName: 'AlveyChain Mainnet',
            nativeCurrency: { name: 'ALV', symbol: 'ALV', decimals: 18 },
            rpcUrls: ['https://elves-core1.alvey.io'],
            blockExplorerUrls: ['https://alveyscan.com'],
        };

        const CONTRACTS = {
            WHEEL_GAME: '0xB677DBcA76061E6301272c83179c8243A4eeB6A5',
            MAO_TOKEN: '0x22f49bcb3dad370a9268ba3fca33cb037ca3d022',
            PI_TOKEN: '0xfd4680e25e05b3435c7f698668d1ce80d2a9f444'
        };

        // å…¨å±€å˜é‡
        let currentAccount = null;
        let provider = null;
        let signer = null;
        let contracts = {};
        let selectedToken = 'MAO';
        let balances = { MAO: '0', PI: '0' };
        let approvalStatus = { MAO: false, PI: false };
        let isSpinning = false;
        let isContinuousMode = false; // æ–°å¢ï¼šè¿ç»­æ¸¸æˆæ¨¡å¼

        // DOMå…ƒç´ 
        const connectBtn = document.getElementById('connectBtn');
        const walletConnect = document.getElementById('walletConnect');
        const gameInterface = document.getElementById('gameInterface');
        const connectionProgress = document.getElementById('connectionProgress');
        const progressText = document.getElementById('progressText');
        const progressBar = document.getElementById('progressBar');
        const progressSubtext = document.getElementById('progressSubtext');
        const userAddress = document.getElementById('userAddress');
        const maoBtn = document.getElementById('maoBtn');
        const piBtn = document.getElementById('piBtn');
        const maoApproveBtn = document.getElementById('maoApproveBtn');
        const piApproveBtn = document.getElementById('piApproveBtn');
        const spinBtn = document.getElementById('spinBtn');
        const maoBalance = document.getElementById('maoBalance');
        const piBalance = document.getElementById('piBalance');
        const betAmount = document.getElementById('betAmount');
        const gameStatus = document.getElementById('gameStatus');
        const wheel = document.getElementById('wheel');

        // æ™ºèƒ½åˆçº¦ABIï¼ˆç®€åŒ–ç‰ˆï¼‰
        const WHEEL_GAME_ABI = [
            "function playGame(address token) external",
            "function getGameResult(uint256 gameId) external view returns (uint8, uint256)",
            "function gameCounter() external view returns (uint256)",
            "function rewardAmounts(uint8 level) external view returns (uint256)",
            "event GamePlayed(address indexed player, address indexed token, uint8 result, uint256 rewardAmount, uint256 gameId)"
        ];

        const TOKEN_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function decimals() view returns (uint8)"
        ];

        // è¿æ¥è¿›åº¦æ˜¾ç¤º
        function showConnectionProgress() {
            connectionProgress.classList.remove('hidden');
            updateProgress('å¼€å§‹è¿æ¥...', 0);
        }

        function hideConnectionProgress() {
            connectionProgress.classList.add('hidden');
        }

        function updateProgress(text, percentage, subtext = '') {
            progressText.textContent = text;
            progressBar.style.width = percentage + '%';
            if (subtext) {
                progressSubtext.textContent = subtext;
            }
        }

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                showConnectionProgress();
                updateProgress('æ£€æŸ¥Web3ç¯å¢ƒ...', 10);

                if (typeof ethers === 'undefined') {
                    throw new Error('ethers.jsåº“æœªåŠ è½½');
                }

                if (!window.ethereum) {
                    hideConnectionProgress();
                    alert('è¯·ä½¿ç”¨æ”¯æŒWeb3çš„é’±åŒ…æµè§ˆå™¨ï¼\næ¨èä½¿ç”¨ï¼šTPé’±åŒ…ã€Trust Walletã€MetaMaskç­‰');
                    return;
                }

                updateProgress('æ£€æŸ¥ç½‘ç»œé…ç½®...', 30);

                // æ£€æŸ¥ç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== ALVEY_NETWORK.chainId) {
                    updateProgress('åˆ‡æ¢åˆ°AlveyChainç½‘ç»œ...', 50);
                    await switchToAlveyNetwork();
                }

                updateProgress('è¯·æ±‚è´¦æˆ·æˆæƒ...', 70);

                // è¯·æ±‚è´¦æˆ·
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts',
                });

                if (accounts.length === 0) {
                    throw new Error('æœªè·å¾—è´¦æˆ·æˆæƒ');
                }

                updateProgress('åˆå§‹åŒ–åŒºå—é“¾è¿æ¥...', 90);

                // åˆå§‹åŒ–æä¾›è€…
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                currentAccount = accounts[0];

                // åˆå§‹åŒ–åˆçº¦
                await initializeContracts();

                updateProgress('åŠ è½½ç”¨æˆ·æ•°æ®...', 95);

                // åŠ è½½æ•°æ®
                await Promise.all([
                    loadBalances(),
                    checkAllApprovals()
                ]);

                updateProgress('è¿æ¥å®Œæˆï¼', 100);

                // æ›´æ–°UI
                updateUI();

                setTimeout(() => {
                    hideConnectionProgress();
                }, 500);

            } catch (error) {
                console.error('è¿æ¥é’±åŒ…é”™è¯¯:', error);
                hideConnectionProgress();
                alert('è¿æ¥é’±åŒ…å¤±è´¥: ' + error.message);
            }
        }

        // åˆ‡æ¢ç½‘ç»œ
        async function switchToAlveyNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: ALVEY_NETWORK.chainId }],
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [ALVEY_NETWORK],
                    });
                } else {
                    throw switchError;
                }
            }
        }

        // åˆå§‹åŒ–åˆçº¦
        async function initializeContracts() {
            contracts = {
                wheelGame: new ethers.Contract(CONTRACTS.WHEEL_GAME, WHEEL_GAME_ABI, signer),
                maoToken: new ethers.Contract(CONTRACTS.MAO_TOKEN, TOKEN_ABI, signer),
                piToken: new ethers.Contract(CONTRACTS.PI_TOKEN, TOKEN_ABI, signer)
            };
        }

        // åŠ è½½ä½™é¢
        async function loadBalances() {
            try {
                const [maoBalance, piBalance] = await Promise.all([
                    contracts.maoToken.balanceOf(currentAccount),
                    contracts.piToken.balanceOf(currentAccount)
                ]);

                // MAOæ˜¯9ä½å°æ•°ï¼ŒPIæ˜¯9ä½å°æ•°
                balances.MAO = ethers.utils.formatUnits(maoBalance, 9);
                balances.PI = ethers.utils.formatUnits(piBalance, 9);

                updateBalanceDisplay();
            } catch (error) {
                console.error('åŠ è½½ä½™é¢é”™è¯¯:', error);
            }
        }

        // æ£€æŸ¥æ‰€æœ‰æˆæƒ
        async function checkAllApprovals() {
            try {
                const [maoAllowance, piAllowance] = await Promise.all([
                    contracts.maoToken.allowance(currentAccount, CONTRACTS.WHEEL_GAME),
                    contracts.piToken.allowance(currentAccount, CONTRACTS.WHEEL_GAME)
                ]);

                // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æˆæƒï¼ˆéœ€è¦çš„æ˜¯18ä½å°æ•°æ ¼å¼ï¼‰
                const maoRequired = ethers.utils.parseUnits('100', 18);
                const piRequired = ethers.utils.parseUnits('1000', 18);

                approvalStatus.MAO = maoAllowance.gte(maoRequired);
                approvalStatus.PI = piAllowance.gte(piRequired);

                updateApprovalDisplay();
            } catch (error) {
                console.error('æ£€æŸ¥æˆæƒé”™è¯¯:', error);
            }
        }

        // æˆæƒç‰¹å®šä»£å¸
        async function approveToken(tokenType) {
            try {
                const btn = tokenType === 'MAO' ? maoApproveBtn : piApproveBtn;
                const contract = tokenType === 'MAO' ? contracts.maoToken : contracts.piToken;

                btn.textContent = `æˆæƒ${tokenType}ä¸­...`;
                btn.disabled = true;

                const tx = await contract.approve(CONTRACTS.WHEEL_GAME, ethers.constants.MaxUint256);
                await tx.wait();

                approvalStatus[tokenType] = true;
                updateApprovalDisplay();

                alert(`${tokenType}ä»£å¸æˆæƒæˆåŠŸï¼`);
            } catch (error) {
                console.error(`æˆæƒ${tokenType}é”™è¯¯:`, error);
                alert(`æˆæƒ${tokenType}å¤±è´¥: ` + error.message);
            } finally {
                updateApprovalButtons();
            }
        }

        // é€‰æ‹©ä»£å¸
        function selectToken(token) {
            if (isContinuousMode) {
                alert('è¯·å…ˆåœæ­¢è¿ç»­æ¸¸æˆæ¨¡å¼å†åˆ‡æ¢ä»£å¸ï¼');
                return;
            }
            
            selectedToken = token;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            maoBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 ' + 
                (token === 'MAO' ? 'selected' : 'unselected');
            piBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 ' + 
                (token === 'PI' ? 'selected' : 'unselected');
            
            // æ›´æ–°æŠ•æ³¨é‡‘é¢æ˜¾ç¤º - ä¿æŒæ­£ç¡®çš„PIæŠ•æ³¨é‡‘é¢
            betAmount.textContent = token === 'MAO' ? '100 MAO' : '10,000 PI';
            
            // æ›´æ–°è½¬ç›˜å¥–åŠ±æ˜¾ç¤º
            updateWheelRewards();
            
            // æ›´æ–°ä½™é¢æ˜¾ç¤º
            updateCurrentBalance();
                    
            // é‡æ–°æ£€æŸ¥æˆæƒçŠ¶æ€ - åˆ†ç¦»æ£€æŸ¥MAOå’ŒPI
            if (currentAccount) {
                checkSeparateApproval(token);
            }
        }

        // åˆ†ç¦»çš„æˆæƒæ£€æŸ¥å‡½æ•°
        async function checkSeparateApproval(tokenType) {
            try {
                if (!contracts.maoToken || !contracts.piToken) return;
                
                let tokenContract, requiredAmount;
                
                if (tokenType === 'MAO') {
                    tokenContract = contracts.maoToken;
                    // åˆçº¦æœŸæœ›18ä½å°æ•°ï¼Œä½†ä»£å¸å®é™…æ˜¯9ä½å°æ•°ï¼Œæˆæƒéœ€è¦18ä½
                    requiredAmount = ethers.utils.parseUnits('100', 18);
                } else {
                    tokenContract = contracts.piToken;
                    // PIæˆæƒä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„18ä½å°æ•°æ ¼å¼
                    requiredAmount = ethers.utils.parseUnits('10000', 18);
                }
                
                const allowance = await tokenContract.allowance(currentAccount, CONTRACTS.WHEEL_GAME);
                const isApproved = allowance.gte(requiredAmount);
                
                // æ›´æ–°ç‰¹å®šä»£å¸çš„æˆæƒçŠ¶æ€
                if (tokenType === 'MAO') {
                    maoApprovalStatus = isApproved;
                } else {
                    piApprovalStatus = isApproved;
                }
                
                updateSeparateApprovalButtons();
                
            } catch (error) {
                console.error(`æ£€æŸ¥${tokenType}æˆæƒé”™è¯¯:`, error);
            }
        }

        // åˆ†ç¦»çš„æˆæƒå‡½æ•°
        async function approveSeparateToken(tokenType) {
            try {
                let approveBtn = tokenType === 'MAO' ? maoApproveBtn : piApproveBtn;
                let tokenContract = tokenType === 'MAO' ? contracts.maoToken : contracts.piToken;
                
                approveBtn.textContent = `æˆæƒ${tokenType}ä¸­...`;
                approveBtn.disabled = true;

                const tx = await tokenContract.approve(CONTRACTS.WHEEL_GAME, ethers.constants.MaxUint256);
                await tx.wait();

                // æ›´æ–°æˆæƒçŠ¶æ€
                if (tokenType === 'MAO') {
                    maoApprovalStatus = true;
                } else {
                    piApprovalStatus = true;
                }
                
                updateSeparateApprovalButtons();
                alert(`${tokenType}ä»£å¸æˆæƒæˆåŠŸï¼ç°åœ¨å¯ä»¥è¿›è¡Œ${tokenType}æ¸¸æˆäº†ã€‚`);
                
            } catch (error) {
                console.error(`æˆæƒ${tokenType}é”™è¯¯:`, error);
                alert(`æˆæƒ${tokenType}å¤±è´¥: ` + error.message);
                
                let approveBtn = tokenType === 'MAO' ? maoApproveBtn : piApproveBtn;
                approveBtn.textContent = `ğŸ”“ æˆæƒ ${tokenType} ä»£å¸`;
                approveBtn.disabled = false;
            }
        }

        // æ›´æ–°åˆ†ç¦»çš„æˆæƒæŒ‰é’®çŠ¶æ€
        function updateSeparateApprovalButtons() {
            // MAOæˆæƒæŒ‰é’®çŠ¶æ€
            if (maoApproveBtn) {
                if (maoApprovalStatus) {
                    maoApproveBtn.style.display = 'none';
                } else {
                    maoApproveBtn.style.display = 'block';
                    maoApproveBtn.textContent = 'ğŸ”“ æˆæƒ MAO ä»£å¸';
                    maoApproveBtn.disabled = false;
                }
            }
            
            // PIæˆæƒæŒ‰é’®çŠ¶æ€
            if (piApproveBtn) {
                if (piApprovalStatus) {
                    piApproveBtn.style.display = 'none';
                } else {
                    piApproveBtn.style.display = 'block';
                    piApproveBtn.textContent = 'ğŸ”“ æˆæƒ PI ä»£å¸';
                    piApproveBtn.disabled = false;
                }
            }
            
            // æ›´æ–°æ¸¸æˆæŒ‰é’®çŠ¶æ€
            updateGameButtonStatus();
        }

        // æ›´æ–°æ¸¸æˆæŒ‰é’®çŠ¶æ€
        function updateGameButtonStatus() {
            const canPlay = (selectedToken === 'MAO' && maoApprovalStatus) || 
                           (selectedToken === 'PI' && piApprovalStatus);
                           
            if (spinBtn) { // ç¡®ä¿spinBtnå­˜åœ¨
                if (canPlay) {
                    spinBtn.disabled = false;
                    spinBtn.innerHTML = '<div class="text-2xl">ğŸ²</div><div class="text-[10px]">å¼€å§‹æ¸¸æˆ</div>';
                } else {
                    spinBtn.disabled = true;
                    spinBtn.innerHTML = '<div class="text-2xl">ğŸ”’</div><div class="text-[10px]">éœ€è¦æˆæƒ</div>';
                }
            }
        }

        // ä¿®å¤çš„æ£€æŸ¥æˆæƒå‡½æ•°
        async function checkApproval() {
            try {
                // åˆ†åˆ«æ£€æŸ¥MAOå’ŒPIçš„æˆæƒçŠ¶æ€
                await Promise.all([
                    checkSeparateApproval('MAO'),
                    checkSeparateApproval('PI')
                ]);
                
            } catch (error) {
                console.error('æ£€æŸ¥æˆæƒé”™è¯¯:', error);
            }
        }

        // ä¼˜åŒ–çš„æˆæƒä»£å¸å‡½æ•° - æ”¹ä¸ºåˆ†ç¦»æˆæƒ
        async function approveTokens() {
            // è¿™ä¸ªå‡½æ•°ç°åœ¨æ”¹ä¸ºæ£€æŸ¥å½“å‰é€‰æ‹©çš„ä»£å¸è¿›è¡Œæˆæƒ
            await approveSeparateToken(selectedToken);
        }

        // æ·»åŠ å…¨å±€å˜é‡ç”¨äºåˆ†ç¦»çš„æˆæƒçŠ¶æ€
        let maoApprovalStatus = false;
        let piApprovalStatus = false;
        let maoApproveBtn, piApproveBtn;

        // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–åˆ†ç¦»çš„æˆæƒæŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        window.addEventListener('DOMContentLoaded', function() {
            maoApproveBtn = document.getElementById('maoApproveBtn');
            piApproveBtn = document.getElementById('piApproveBtn');
            
            // æ·»åŠ åˆ†ç¦»çš„æˆæƒæŒ‰é’®äº‹ä»¶ç›‘å¬ï¼ˆå¦‚æœæŒ‰é’®å­˜åœ¨ï¼‰
            if (maoApproveBtn) {
                maoApproveBtn.addEventListener('click', () => approveSeparateToken('MAO'));
            }
            if (piApproveBtn) {
                piApproveBtn.addEventListener('click', () => approveSeparateToken('PI'));
            }
        });

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            if (isSpinning) return;
            
            try {
                // æ£€æŸ¥æˆæƒ
                if (!approvalStatus[selectedToken]) {
                    alert(`è¯·å…ˆæˆæƒ${selectedToken}ä»£å¸ï¼`);
                    return;
                }

                // æ£€æŸ¥ä½™é¢
                const balance = parseFloat(balances[selectedToken]);
                const required = selectedToken === 'MAO' ? 100 : 1000;
                
                if (balance < required) {
                    alert(`${selectedToken}ä½™é¢ä¸è¶³ï¼éœ€è¦${required}ä¸ª${selectedToken}`);
                    return;
                }

                isSpinning = true;
                updateGameStatus('æ¸¸æˆä¸­...');
                
                // å¼€å§‹è½¬ç›˜åŠ¨ç”»
                startWheelAnimation();
                
                // è°ƒç”¨æ™ºèƒ½åˆçº¦
                const tokenContract = selectedToken === 'MAO' ? CONTRACTS.MAO_TOKEN : CONTRACTS.PI_TOKEN;
                const tx = await contracts.wheelGame.playGame(tokenContract);
                
                updateGameStatus('äº¤æ˜“ç¡®è®¤ä¸­...');
                const receipt = await tx.wait();
                
                // è§£ææ¸¸æˆç»“æœ
                const gameResult = await parseGameResult(receipt);
                
                // æ˜¾ç¤ºç»“æœ
                await showGameResult(gameResult);
                
                // åˆ·æ–°æ•°æ®
                await Promise.all([
                    loadBalances(),
                    checkAllApprovals()
                ]);
                
            } catch (error) {
                console.error('æ¸¸æˆé”™è¯¯:', error);
                alert('æ¸¸æˆå¤±è´¥: ' + error.message);
            } finally {
                isSpinning = false;
                updateGameStatus('å‡†å¤‡å°±ç»ª');
                stopWheelAnimation();
            }
        }

        // è½¬ç›˜åŠ¨ç”»
        function startWheelAnimation() {
            const randomRotation = 1800 + Math.random() * 1800; // 5-10åœˆ
            wheel.style.transform = `rotate(${randomRotation}deg)`;
            spinBtn.disabled = true;
            spinBtn.innerHTML = '<div class="text-2xl">â³</div><div class="text-[10px]">æ¸¸æˆä¸­</div>';
        }

        function stopWheelAnimation() {
            spinBtn.disabled = false;
            spinBtn.innerHTML = '<div class="text-2xl">ğŸ²</div><div class="text-[10px]">å¼€å§‹æ¸¸æˆ</div>';
        }

        // è§£ææ¸¸æˆç»“æœ
        async function parseGameResult(receipt) {
            // ä»äº¤æ˜“å›æ‰§ä¸­è§£æGamePlayedäº‹ä»¶
            const iface = new ethers.utils.Interface(WHEEL_GAME_ABI);
            
            for (let log of receipt.logs) {
                try {
                    const parsed = iface.parseLog(log);
                    if (parsed.name === 'GamePlayed') {
                        return {
                            result: parsed.args.result,
                            rewardAmount: parsed.args.rewardAmount,
                            gameId: parsed.args.gameId
                        };
                    }
                } catch (e) {
                    // å¿½ç•¥è§£æé”™è¯¯
                }
            }
            
            throw new Error('æ— æ³•è§£ææ¸¸æˆç»“æœ');
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æœ
        async function showGameResult(result) {
            const rewards = [
                { name: 'è°¢è°¢æƒ é¡¾', emoji: 'ğŸ˜Š', multiplier: 0 },
                { name: 'å°å¥–', emoji: 'ğŸ', multiplier: 1.05 },
                { name: 'ä¸­å¥–', emoji: 'ğŸ†', multiplier: 1.5 },
                { name: 'å¤§å¥–', emoji: 'ğŸ’', multiplier: 2.5 },
                { name: 'è¶…çº§å¤§å¥–', emoji: 'ğŸŒŸ', multiplier: 4 },
                { name: 'ç»ˆæå¤§å¥–', emoji: 'ğŸ’°', multiplier: 7 }
            ];
            
            const rewardInfo = rewards[result.result];
            const rewardAmount = ethers.utils.formatUnits(result.rewardAmount, 9);
            
            let message = `${rewardInfo.emoji} ${rewardInfo.name}ï¼\n`;
            
            if (result.result > 0) {
                message += `æ­å–œè·å¾— ${rewardAmount} ${selectedToken}ï¼`;
                // åº†ç¥åŠ¨ç”»
                createCelebrationEffect();
            } else {
                message += 'å†æ¥å†å‰ï¼';
            }
            
            alert(message);
            
            // æ›´æ–°æ¸¸æˆå†å²
            addToGameHistory(rewardInfo, rewardAmount);
        }

        // åº†ç¥æ•ˆæœ
        function createCelebrationEffect() {
            // ç®€å•çš„åº†ç¥æ•ˆæœ
            document.body.style.background = 'linear-gradient(45deg, #FFD700, #FFA500, #FFD700)';
            setTimeout(() => {
                document.body.style.background = '';
            }, 1000);
        }

        // æ›´æ–°UIå‡½æ•°
        function updateUI() {
            walletConnect.style.display = 'none';
            gameInterface.style.display = 'block';
            userAddress.textContent = `${currentAccount.slice(0, 6)}...${currentAccount.slice(-4)}`;
        }

        function updateBalanceDisplay() {
            maoBalance.textContent = `ä½™é¢: ${parseFloat(balances.MAO).toFixed(2)}`;
            piBalance.textContent = `ä½™é¢: ${parseFloat(balances.PI).toFixed(2)}`;
        }

        function updateApprovalDisplay() {
            // MAOæˆæƒçŠ¶æ€
            const maoIndicator = document.getElementById('maoApprovalIndicator');
            const maoStatus = document.getElementById('maoApprovalStatus');
            
            if (approvalStatus.MAO) {
                maoIndicator.className = 'approval-indicator approved';
                maoStatus.textContent = 'å·²æˆæƒ';
            } else {
                maoIndicator.className = 'approval-indicator not-approved';
                maoStatus.textContent = 'éœ€è¦æˆæƒ';
            }
            
            // PIæˆæƒçŠ¶æ€
            const piIndicator = document.getElementById('piApprovalIndicator');
            const piStatus = document.getElementById('piApprovalStatus');
            
            if (approvalStatus.PI) {
                piIndicator.className = 'approval-indicator approved';
                piStatus.textContent = 'å·²æˆæƒ';
            } else {
                piIndicator.className = 'approval-indicator not-approved';
                piStatus.textContent = 'éœ€è¦æˆæƒ';
            }
            
            updateApprovalButtons();
        }

        function updateApprovalButtons() {
            // MAOæˆæƒæŒ‰é’®
            if (approvalStatus.MAO) {
                maoApproveBtn.textContent = 'âœ… MAOå·²æˆæƒ';
                maoApproveBtn.className = 'w-full approve-btn approved text-white font-bold py-3 px-4 rounded-lg';
                maoApproveBtn.disabled = true;
            } else {
                maoApproveBtn.textContent = 'ğŸ”“ æˆæƒ MAO ä»£å¸';
                maoApproveBtn.className = 'w-full approve-btn text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105';
                maoApproveBtn.disabled = false;
            }
            
            // PIæˆæƒæŒ‰é’®
            if (approvalStatus.PI) {
                piApproveBtn.textContent = 'âœ… PIå·²æˆæƒ';
                piApproveBtn.className = 'w-full approve-btn approved text-white font-bold py-3 px-4 rounded-lg';
                piApproveBtn.disabled = true;
            } else {
                piApproveBtn.textContent = 'ğŸ”“ æˆæƒ PI ä»£å¸';
                piApproveBtn.className = 'w-full approve-btn text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105';
                piApproveBtn.disabled = false;
            }
        }

        function updateTokenSelection() {
            // æ›´æ–°æŒ‰é’®æ ·å¼
            if (selectedToken === 'MAO') {
                maoBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 selected';
                piBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 unselected';
            } else {
                maoBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 unselected';
                piBtn.className = 'token-select-btn py-3 px-4 rounded-lg font-semibold text-lg mr-3 selected';
            }
            
            updateRewardDisplay();
        }

        function updateBetAmount() {
            betAmount.textContent = selectedToken === 'MAO' ? '100 MAO' : '10,000 PI';
        }

        function updateRewardDisplay() {
            // æ›´æ–°è½¬ç›˜ä¸Šçš„å¥–åŠ±æ˜¾ç¤º
            const multipliers = selectedToken === 'MAO' ? 
                [0, 105, 150, 250, 400, 700] : 
                [0, 1050, 1500, 2500, 4000, 7000];
            
            for (let i = 1; i <= 5; i++) {
                const element = document.getElementById(`reward${i}`);
                if (element) {
                    element.textContent = multipliers[i];
                }
            }
        }

        function updateGameStatus(status) {
            gameStatus.textContent = status;
        }

        function addToGameHistory(rewardInfo, amount) {
            const historyContainer = document.getElementById('gameHistory');
            const entry = document.createElement('div');
            entry.className = 'text-xs text-blue-200 py-1 border-b border-white/10';
            entry.innerHTML = `
                <span class="text-yellow-400">${new Date().toLocaleTimeString()}</span>
                <span class="mx-2">${rewardInfo.emoji}</span>
                <span>${rewardInfo.name}</span>
                ${amount > 0 ? `<span class="text-green-400 ml-2">+${amount} ${selectedToken}</span>` : ''}
            `;
            
            historyContainer.insertBefore(entry, historyContainer.firstChild);
            
            // ä¿æŒæœ€å¤š10æ¡è®°å½•
            while (historyContainer.children.length > 10) {
                historyContainer.removeChild(historyContainer.lastChild);
            }
        }

        // æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½
        async function refreshBalanceManually() {
            const btn = document.getElementById('refreshBalanceBtn');
            const originalText = btn.textContent;
            
            try {
                btn.textContent = 'ğŸ”„ åˆ·æ–°ä¸­...';
                btn.disabled = true;
                
                await Promise.all([
                    loadBalances(),
                    checkAllApprovals()
                ]);
                
                btn.textContent = 'âœ… åˆ·æ–°å®Œæˆ';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 1000);
                
            } catch (error) {
                console.error('åˆ·æ–°é”™è¯¯:', error);
                btn.textContent = 'âŒ åˆ·æ–°å¤±è´¥';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        // äº‹ä»¶ç›‘å¬
        connectBtn.addEventListener('click', connectWallet);
        maoApproveBtn.addEventListener('click', () => approveToken('MAO'));
        piApproveBtn.addEventListener('click', () => approveToken('PI'));
        maoBtn.addEventListener('click', () => selectToken('MAO'));
        piBtn.addEventListener('click', () => selectToken('PI'));
        spinBtn.addEventListener('click', startGame);

        // è‡ªåŠ¨è¿æ¥å·²è¿æ¥çš„é’±åŒ…
        window.addEventListener('load', async () => {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œæ£€æŸ¥é’±åŒ…è¿æ¥');
            
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        console.log('ğŸš€ æ£€æµ‹åˆ°å·²è¿æ¥è´¦æˆ·ï¼Œè‡ªåŠ¨è¿æ¥ä¸­...');
                        setTimeout(connectWallet, 1000);
                    }
                } catch (error) {
                    console.log('è‡ªåŠ¨è¿æ¥æ£€æŸ¥å¤±è´¥:', error);
                }
            }
        });

        // ç›‘å¬è´¦æˆ·å’Œç½‘ç»œå˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else if (accounts[0] !== currentAccount) {
                    connectWallet();
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                if (chainId !== ALVEY_NETWORK.chainId) {
                    location.reload();
                }
            });
        }

        // åˆå§‹åŒ–
        updateTokenSelection();
        updateBetAmount();
    </script>
</body>
</html> 