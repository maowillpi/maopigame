"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[309],{2309:function(e,t,a){a.r(t),a.d(t,{default:function(){return MobileGame}});var l=a(5893),s=a(7294),n=a(1476),i=a(7583),r=a(8470),o=a(4222);let c=["function playMAOGame() external","function playPIGame() external","function getPlayerHistory(address player) external view returns (tuple(address player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 timestamp, uint256 randomSeed)[])","function getRewardLevelName(uint8 level) external pure returns (string)","event GamePlayed(address indexed player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 randomSeed)"],d=["function balanceOf(address owner) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"],m={WHEEL_GAME:"0xc27e29BCe41db77815435a9415329424849Daeb6",MAO_TOKEN:"0x22f49bcb3dad370a9268ba3fca33cb037ca3d022",PI_TOKEN:"0xfd4680e25e05b3435c7f698668d1ce80d2a9f444"},x={chainId:"0xED5",chainName:"AlveyChain Mainnet",nativeCurrency:{name:"ALV",symbol:"ALV",decimals:18},rpcUrls:["https://elves-core1.alvey.io"],blockExplorerUrls:["https://alveyscan.com"]},h=[{level:0,name:"谢谢惠顾",maoAmount:0,piAmount:0,color:"#6B7280",probability:"85%",emoji:"\uD83D\uDE0A"},{level:1,name:"小奖",maoAmount:150,piAmount:15e3,color:"#F59E0B",probability:"8%",emoji:"\uD83C\uDF81"},{level:2,name:"中奖",maoAmount:400,piAmount:4e4,color:"#EF4444",probability:"4%",emoji:"\uD83C\uDFC6"},{level:3,name:"大奖",maoAmount:800,piAmount:8e4,color:"#8B5CF6",probability:"2%",emoji:"\uD83D\uDC8E"},{level:4,name:"超级大奖",maoAmount:1500,piAmount:15e4,color:"#10B981",probability:"0.8%",emoji:"\uD83C\uDF1F"},{level:5,name:"终极大奖",maoAmount:3e3,piAmount:3e5,color:"#F97316",probability:"0.2%",emoji:"\uD83D\uDCB0"}];function MobileGame(){let[e,t]=(0,s.useState)(null),[a,u]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[p,v]=(0,s.useState)({}),[j,g]=(0,s.useState)({MAO:"0",PI:"0"}),[N,f]=(0,s.useState)("MAO"),[y,D]=(0,s.useState)(!1),[A,k]=(0,s.useState)([]),[C,M]=(0,s.useState)(!1),[O,E]=(0,s.useState)(!1),[F,T]=(0,s.useState)(0),[B,G]=(0,s.useState)(null),[_,S]=(0,s.useState)(!1),checkNetwork=async()=>{if(!window.ethereum)return!1;try{let e=await window.ethereum.request({method:"eth_chainId"});return e===x.chainId}catch(e){return console.error("检查网络错误:",e),!1}},switchToAlveyNetwork=async()=>{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:x.chainId}]})}catch(e){if(4902===e.code)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[x]})}catch(e){throw console.error("添加网络错误:",e),e}else throw e}},connectWallet=async()=>{if(!window.ethereum){alert("请使用支持Web3的钱包浏览器！\n推荐使用：TP钱包、Trust Wallet、MetaMask等");return}try{D(!0);let e=await checkNetwork();e||await switchToAlveyNetwork();let a=await window.ethereum.request({method:"eth_requestAccounts"});if(a.length>0){let e=new n.Q(window.ethereum),l=await e.getSigner();t(a[0]),u(e),w(l),await initializeContracts(l),await loadBalances(a[0],l),await loadGameHistory(a[0]),await checkApproval(a[0],l)}}catch(e){console.error("连接钱包错误:",e),alert("连接钱包失败: "+e.message)}finally{D(!1)}},initializeContracts=async e=>{try{let t=new i.CH(m.WHEEL_GAME,c,e),a=new i.CH(m.MAO_TOKEN,d,e),l=new i.CH(m.PI_TOKEN,d,e);return v({wheelGame:t,maoToken:a,piToken:l}),{wheelGame:t,maoToken:a,piToken:l}}catch(e){throw console.error("初始化合约错误:",e),e}},loadBalances=async(e,t)=>{try{let a=p.maoToken?p:await initializeContracts(t),[l,s]=await Promise.all([a.maoToken.balanceOf(e),a.piToken.balanceOf(e)]);g({MAO:r.dF(l),PI:r.dF(s)})}catch(e){console.error("加载余额错误:",e)}},loadGameHistory=async e=>{try{let t=localStorage.getItem("gameHistory_".concat(e));t&&k(JSON.parse(t))}catch(e){console.error("加载游戏历史错误:",e)}},checkApproval=async(e,t)=>{try{let a=p.maoToken?p:await initializeContracts(t),l="MAO"===N?a.maoToken:a.piToken,s=await l.allowance(e,m.WHEEL_GAME),n=r.fi("MAO"===N?"1000":"100000");S(s>=n)}catch(e){console.error("检查授权错误:",e)}},approveTokens=async()=>{if(p.maoToken&&p.piToken&&e)try{D(!0);let e=o.Bz,t="MAO"===N?p.maoToken:p.piToken,a=await t.approve(m.WHEEL_GAME,e);await a.wait(),S(!0),alert("代币授权成功！现在可以开始游戏了。")}catch(e){console.error("授权错误:",e),alert("授权失败: "+e.message)}finally{D(!1)}},startGame=async()=>{if(p.wheelGame&&e&&!O){if(!_){alert("请先授权代币！");return}try{E(!0);let t="MAO"===N?100:1e4,a=parseFloat(j[N]);if(a<t){alert("余额不足！需要至少 ".concat(t," ").concat(N)),E(!1);return}let l=F+2160+360*Math.random();T(l);let s="MAO"===N?"playMAOGame":"playPIGame",n=await p.wheelGame[s](),i=await n.wait(),r=null;for(let e of i.logs)try{let t=p.wheelGame.interface.parseLog(e);if("GamePlayed"===t.name){let e=Number(t.args.rewardLevel),a=h[e];r={level:e,name:a.name,amount:"MAO"===N?a.maoAmount:a.piAmount,isWin:e>0,txHash:i.hash,emoji:a.emoji};break}}catch(e){console.error("解析事件错误:",e)}if(!r){let e=.15>Math.random()?Math.floor(6*Math.random()):0,t=h[e];r={level:e,name:t.name,amount:"MAO"===N?t.maoAmount:t.piAmount,isWin:e>0,txHash:i.hash,emoji:t.emoji}}let o=60*r.level,c=l-l%360+o;T(c);let d={id:Date.now(),token:N,betAmount:"MAO"===N?100:1e4,rewardAmount:r.amount,rewardLevel:r.level,isWin:r.isWin,timestamp:Date.now(),txHash:r.txHash},m=[d,...A].slice(0,20);k(m),localStorage.setItem("gameHistory_".concat(e),JSON.stringify(m)),G(r),setTimeout(()=>{E(!1),r.isWin?alert("\uD83C\uDF89 恭喜！获得 ".concat(r.name,"！\n奖励: ").concat(r.amount," ").concat(N," ").concat(r.emoji)):alert("\uD83D\uDE05 谢谢惠顾！继续努力！"),loadBalances(e,b)},4e3)}catch(e){console.error("游戏错误:",e),E(!1),alert("游戏失败: "+(e.reason||e.message))}}};return(0,s.useEffect)(()=>{window.ethereum&&window.ethereum.request({method:"eth_accounts"}).then(e=>{e.length>0&&connectWallet()})},[]),(0,s.useEffect)(()=>{e&&b&&checkApproval(e,b)},[N,e,b]),(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[(0,l.jsxs)("div",{className:"bg-black/30 backdrop-blur-lg px-4 py-3 text-center sticky top-0 z-50",children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-white",children:"\uD83C\uDFB0 MAO转盘游戏"}),(0,l.jsx)("p",{className:"text-xs text-blue-200",children:"AlveyChain 区块链游戏"})]}),(0,l.jsx)("div",{className:"px-4 py-4 space-y-4 pb-20",children:e?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-blue-200 text-xs",children:"钱包地址"}),(0,l.jsxs)("p",{className:"text-white text-sm font-mono",children:[e.slice(0,6),"...",e.slice(-4)]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-blue-200 text-xs",children:"当前余额"}),(0,l.jsxs)("p",{className:"text-white font-bold text-lg",children:[Number(j[N]).toFixed(2)," ",N]})]})]})}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,l.jsx)("h3",{className:"text-white font-semibold mb-3 text-center",children:"选择游戏代币"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsxs)("button",{onClick:()=>f("MAO"),disabled:O,className:"py-4 px-4 rounded-xl font-semibold transition-all ".concat("MAO"===N?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg scale-105":"bg-white/20 text-blue-200 hover:bg-white/30"," ").concat(O?"opacity-50 cursor-not-allowed":""),children:[(0,l.jsx)("div",{className:"text-lg",children:"MAO"}),(0,l.jsx)("div",{className:"text-xs mt-1",children:"100 MAO/次"}),(0,l.jsxs)("div",{className:"text-xs text-yellow-400",children:["余额: ",Number(j.MAO).toFixed(2)]})]}),(0,l.jsxs)("button",{onClick:()=>f("PI"),disabled:O,className:"py-4 px-4 rounded-xl font-semibold transition-all ".concat("PI"===N?"bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg scale-105":"bg-white/20 text-blue-200 hover:bg-white/30"," ").concat(O?"opacity-50 cursor-not-allowed":""),children:[(0,l.jsx)("div",{className:"text-lg",children:"PI"}),(0,l.jsx)("div",{className:"text-xs mt-1",children:"10,000 PI/次"}),(0,l.jsxs)("div",{className:"text-xs text-yellow-400",children:["余额: ",Number(j.PI).toFixed(2)]})]})]})]}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,l.jsx)("h3",{className:"text-white font-bold text-center mb-4 text-lg",children:"\uD83C\uDFB0 幸运转盘"}),(0,l.jsx)("div",{className:"flex justify-center mb-6",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("div",{className:"w-72 h-72 rounded-full border-4 border-yellow-400 transition-transform duration-[4000ms] ease-out shadow-2xl",style:{transform:"rotate(".concat(F,"deg)"),background:"conic-gradient(\n                        #6B7280 0deg 60deg,\n                        #F59E0B 60deg 120deg,\n                        #EF4444 120deg 180deg,\n                        #8B5CF6 180deg 240deg,\n                        #10B981 240deg 300deg,\n                        #F97316 300deg 360deg\n                      )"},children:[h.map((e,t)=>(0,l.jsx)("div",{className:"absolute text-white text-xs font-bold",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(".concat(60*t+30,"deg) translateY(-120px) rotate(-").concat(60*t+30,"deg)"),transformOrigin:"50% 120px"},children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-lg",children:e.emoji}),(0,l.jsx)("div",{className:"text-[10px]",children:e.name})]})},t)),(0,l.jsx)("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 z-10",children:(0,l.jsx)("div",{className:"w-0 h-0 border-l-6 border-r-6 border-b-12 border-l-transparent border-r-transparent border-b-yellow-400 drop-shadow-lg"})})]}),(0,l.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:(0,l.jsx)("button",{onClick:startGame,disabled:O||y||!_,className:"w-24 h-24 rounded-full font-bold text-sm transition-all shadow-2xl ".concat(O?"bg-gray-600 cursor-not-allowed animate-pulse":_?"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 transform hover:scale-110":"bg-red-600 text-white"," text-white"),children:O?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"animate-spin text-2xl",children:"\uD83C\uDFB0"}),(0,l.jsx)("div",{className:"text-xs",children:"转动中"})]}):_?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-2xl",children:"\uD83C\uDFB2"}),(0,l.jsx)("div",{className:"text-xs",children:"开始游戏"})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-2xl",children:"\uD83D\uDD12"}),(0,l.jsx)("div",{className:"text-xs",children:"需授权"})]})})})]})}),(0,l.jsx)("div",{className:"bg-white/20 rounded-lg p-4 mb-4",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("p",{className:"text-blue-200 text-sm mb-2",children:["本轮投注: ",(0,l.jsxs)("span",{className:"text-yellow-400 font-bold text-lg",children:["MAO"===N?"100":"10,000"," ",N]})]}),B&&(0,l.jsxs)("div",{className:"bg-black/30 rounded-lg p-3",children:[(0,l.jsxs)("p",{className:"text-green-400 text-sm",children:[B.emoji," 上次结果: ",B.name]}),B.isWin&&(0,l.jsxs)("p",{className:"text-yellow-400 font-bold",children:["奖励: +",B.amount," ",N]})]})]})}),!_&&(0,l.jsx)("button",{onClick:approveTokens,disabled:y||O,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-4 rounded-xl mb-4 disabled:opacity-50 shadow-lg",children:y?"授权中...":"\uD83D\uDD13 授权 ".concat(N," 代币")})]}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,l.jsx)("h3",{className:"text-white font-semibold mb-3 text-center",children:"\uD83C\uDFC6 奖励表"}),(0,l.jsx)("div",{className:"space-y-2 text-sm",children:h.map((e,t)=>(0,l.jsxs)("div",{className:"flex justify-between items-center bg-white/10 rounded-lg p-3",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"text-xl mr-3",children:e.emoji}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-white font-medium",children:e.name}),(0,l.jsxs)("div",{className:"text-blue-300 text-xs",children:["概率: ",e.probability]})]})]}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsx)("div",{className:"text-yellow-400 font-bold",children:0===e.level?"无奖励":"".concat("MAO"===N?e.maoAmount:e.piAmount," ").concat(N)})})]},t))})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsx)("button",{onClick:()=>M(!C),className:"bg-white/20 hover:bg-white/30 text-white py-4 px-4 rounded-xl font-semibold transition-all shadow-lg",children:"\uD83D\uDCC8 游戏记录"}),(0,l.jsx)("button",{onClick:()=>{window.open("https://alveyscan.com/address/"+m.WHEEL_GAME,"_blank")},className:"bg-white/20 hover:bg-white/30 text-white py-4 px-4 rounded-xl font-semibold transition-all shadow-lg",children:"\uD83D\uDD17 合约验证"})]}),C&&(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,l.jsx)("h3",{className:"text-white font-semibold mb-3",children:"\uD83C\uDFAE 最近游戏记录"}),A.length>0?(0,l.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:A.slice(0,10).map(e=>{var t,a;return(0,l.jsxs)("div",{className:"bg-white/10 rounded-lg p-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"text-lg mr-2",children:(null===(t=h[e.rewardLevel])||void 0===t?void 0:t.emoji)||"\uD83C\uDFB0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-white font-medium text-sm",children:(null===(a=h[e.rewardLevel])||void 0===a?void 0:a.name)||"未知"}),(0,l.jsxs)("div",{className:"text-blue-300 text-xs",children:[e.token," \xb7 ",new Date(e.timestamp).toLocaleTimeString()]})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"font-bold ".concat(e.isWin?"text-green-400":"text-gray-400"),children:e.isWin?"+".concat(e.rewardAmount):"未中奖"}),(0,l.jsxs)("div",{className:"text-xs text-blue-300",children:["-",e.betAmount," ",e.token]})]})]}),e.txHash&&(0,l.jsx)("button",{onClick:()=>window.open("https://alveyscan.com/tx/".concat(e.txHash),"_blank"),className:"text-xs text-blue-400 hover:text-blue-300 mt-1",children:"查看交易 →"})]},e.id)})}):(0,l.jsxs)("p",{className:"text-blue-200 text-center py-8",children:["暂无游戏记录",(0,l.jsx)("br",{}),(0,l.jsx)("span",{className:"text-xs",children:"开始您的第一次游戏吧！"})]})]})]}):(0,l.jsxs)("div",{className:"text-center space-y-6",children:[(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-6",children:[(0,l.jsx)("div",{className:"text-6xl mb-4 animate-bounce",children:"\uD83C\uDFB0"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-3",children:"欢迎来到MAO转盘"}),(0,l.jsx)("p",{className:"text-blue-200 text-sm mb-6",children:"连接您的钱包开始转盘之旅"}),(0,l.jsx)("button",{onClick:connectWallet,disabled:y,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 shadow-lg",children:y?"连接中...":"\uD83D\uDD17 连接钱包开始游戏"})]}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,l.jsx)("h3",{className:"text-white font-semibold mb-3 text-center",children:"\uD83D\uDCB0 丰厚奖励等你来拿"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,l.jsxs)("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[(0,l.jsx)("div",{className:"text-2xl mb-1",children:"\uD83C\uDF81"}),(0,l.jsx)("div",{className:"text-yellow-400 font-bold",children:"小奖 8%"}),(0,l.jsx)("div",{className:"text-white text-xs",children:"150 MAO"})]}),(0,l.jsxs)("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[(0,l.jsx)("div",{className:"text-2xl mb-1",children:"\uD83C\uDFC6"}),(0,l.jsx)("div",{className:"text-yellow-400 font-bold",children:"大奖 2%"}),(0,l.jsx)("div",{className:"text-white text-xs",children:"800 MAO"})]}),(0,l.jsxs)("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[(0,l.jsx)("div",{className:"text-2xl mb-1",children:"\uD83C\uDF1F"}),(0,l.jsx)("div",{className:"text-yellow-400 font-bold",children:"超级大奖"}),(0,l.jsx)("div",{className:"text-white text-xs",children:"1,500 MAO"})]}),(0,l.jsxs)("div",{className:"bg-white/10 rounded-lg p-3 text-center",children:[(0,l.jsx)("div",{className:"text-2xl mb-1",children:"\uD83D\uDCB0"}),(0,l.jsx)("div",{className:"text-yellow-400 font-bold",children:"终极大奖"}),(0,l.jsx)("div",{className:"text-white text-xs",children:"3,000 MAO"})]})]})]}),(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,l.jsx)("h3",{className:"text-white font-semibold mb-3 text-center",children:"\uD83D\uDCD6 游戏说明"}),(0,l.jsxs)("ul",{className:"text-blue-200 text-sm space-y-2",children:[(0,l.jsx)("li",{children:"• 每次游戏消耗 100 MAO 或 10,000 PI"}),(0,l.jsx)("li",{children:"• 6级奖励系统，最高奖励3,000倍"}),(0,l.jsx)("li",{children:"• 基于AlveyChain智能合约，公平透明"}),(0,l.jsx)("li",{children:"• 支持TP钱包、Trust Wallet等主流钱包"})]})]})]})}),(0,l.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-black/50 backdrop-blur-lg p-3 text-center",children:(0,l.jsx)("p",{className:"text-blue-200 text-xs",children:"基于 AlveyChain 智能合约 \xb7 公平透明 \xb7 立即到账"})})]})}}}]);