(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{9644:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mobile",function(){return a(2309)}])},2309:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return MobileGame}});var s=a(5893),n=a(7294),l=a(1476),i=a(7583),r=a(8470),c=a(6415);let d=["function playMAOGame() external","function playPIGame() external","function getPlayerHistory(address player) external view returns (tuple(address player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 timestamp, uint256 randomSeed)[])","function getRewardLevelName(uint8 level) external pure returns (string)","event GamePlayed(address indexed player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 randomSeed)"],o=["function balanceOf(address owner) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"],u={WHEEL_GAME:"0xc27e29BCe41db77815435a9415329424849Daeb6",MAO_TOKEN:"0x22f49bcb3dad370a9268ba3fca33cb037ca3d022",PI_TOKEN:"0xfd4680e25e05b3435c7f698668d1ce80d2a9f444"},h={chainId:"0xED5",chainName:"AlveyChain Mainnet",nativeCurrency:{name:"ALV",symbol:"ALV",decimals:18},rpcUrls:["https://elves-core1.alvey.io"],blockExplorerUrls:["https://alveyscan.com"]};function MobileGame(){let[e,t]=(0,n.useState)(null),[a,m]=(0,n.useState)(null),[x,w]=(0,n.useState)(null),[b,p]=(0,n.useState)({}),[N,f]=(0,n.useState)({MAO:"0",PI:"0"}),[j,v]=(0,n.useState)("MAO"),[g,y]=(0,n.useState)(!1),[k,D]=(0,n.useState)([]),[A,C]=(0,n.useState)(!1),checkNetwork=async()=>{if(!window.ethereum)return!1;try{let e=await window.ethereum.request({method:"eth_chainId"});return e===h.chainId}catch(e){return console.error("检查网络错误:",e),!1}},switchToAlveyNetwork=async()=>{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:h.chainId}]})}catch(e){if(4902===e.code)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[h]})}catch(e){throw console.error("添加网络错误:",e),e}else throw e}},connectWallet=async()=>{if(!window.ethereum){alert("请使用支持Web3的钱包浏览器！");return}try{y(!0);let e=await checkNetwork();e||await switchToAlveyNetwork();let a=await window.ethereum.request({method:"eth_requestAccounts"});if(a.length>0){let e=new l.Q(window.ethereum),s=await e.getSigner();t(a[0]),m(e),w(s),await initializeContracts(s),await loadBalances(a[0],s)}}catch(e){console.error("连接钱包错误:",e),alert("连接钱包失败: "+e.message)}finally{y(!1)}},initializeContracts=async e=>{try{let t=new i.CH(u.WHEEL_GAME,d,e),a=new i.CH(u.MAO_TOKEN,o,e),s=new i.CH(u.PI_TOKEN,o,e);return p({wheelGame:t,maoToken:a,piToken:s}),{wheelGame:t,maoToken:a,piToken:s}}catch(e){throw console.error("初始化合约错误:",e),e}},loadBalances=async(e,t)=>{try{let a=b.maoToken?b:await initializeContracts(t),[s,n]=await Promise.all([a.maoToken.balanceOf(e),a.piToken.balanceOf(e)]);f({MAO:r.dF(s),PI:r.dF(n)})}catch(e){console.error("加载余额错误:",e)}};return(0,n.useEffect)(()=>{window.ethereum&&window.ethereum.request({method:"eth_accounts"}).then(e=>{e.length>0&&connectWallet()})},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:[(0,s.jsx)("header",{className:"bg-black/30 backdrop-blur-lg",children:(0,s.jsx)("div",{className:"px-4 py-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white",children:"\uD83C\uDFB0 MAO转盘游戏"}),(0,s.jsx)("p",{className:"text-sm text-blue-200",children:"AlveyChain 区块链游戏"})]})})}),(0,s.jsx)("div",{className:"px-4 py-6",children:e?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-blue-200 text-sm",children:"我的余额"}),(0,s.jsxs)("p",{className:"text-white font-bold text-lg",children:[Number(N[j]).toFixed(2)," ",j]})]}),(0,s.jsx)("button",{onClick:()=>loadBalances(e,x),className:"text-blue-400 hover:text-blue-300",children:"\uD83D\uDD04"})]})}),(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-3 text-center",children:"选择代币"}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("button",{onClick:()=>v("MAO"),className:"flex-1 py-3 px-4 rounded-lg font-semibold transition-all ".concat("MAO"===j?"bg-blue-600 text-white shadow-lg":"bg-white/20 text-blue-200 hover:bg-white/30"),children:["MAO",(0,s.jsx)("div",{className:"text-xs mt-1",children:"100 MAO/次"})]}),(0,s.jsxs)("button",{onClick:()=>v("PI"),className:"flex-1 py-3 px-4 rounded-lg font-semibold transition-all ".concat("PI"===j?"bg-purple-600 text-white shadow-lg":"bg-white/20 text-blue-200 hover:bg-white/30"),children:["PI",(0,s.jsx)("div",{className:"text-xs mt-1",children:"10,000 PI/次"})]})]})]}),(0,s.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:(0,s.jsx)(c.Z,{selectedToken:j,account:e,contracts:b,balances:N,onGameResult:t=>{let a={id:Date.now(),token:j,betAmount:"MAO"===j?"100":"10000",rewardAmount:t.amount.toString(),isWin:t.isWin,timestamp:Date.now(),rewardLevel:t.rewardLevel};D(e=>[a,...e]),setTimeout(()=>{loadBalances(e,x)},2e3)},isLoading:g,setIsLoading:y})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)("button",{onClick:()=>C(!A),className:"bg-white/20 hover:bg-white/30 text-white py-3 px-4 rounded-lg font-semibold transition-all",children:"\uD83D\uDCC8 游戏记录"}),(0,s.jsx)("button",{onClick:()=>{window.open("https://alveyscan.com/address/"+u.WHEEL_GAME,"_blank")},className:"bg-white/20 hover:bg-white/30 text-white py-3 px-4 rounded-lg font-semibold transition-all",children:"\uD83D\uDD17 合约信息"})]}),A&&(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-3",children:"\uD83C\uDFAE 最近游戏"}),k.length>0?(0,s.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:k.slice(0,5).map(e=>(0,s.jsx)("div",{className:"bg-white/10 rounded-lg p-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-white font-medium",children:e.token}),(0,s.jsx)("span",{className:"text-blue-200 text-sm ml-2",children:e.isWin?"+".concat(e.rewardAmount):"未中奖"})]}),(0,s.jsx)("div",{className:"text-xs text-blue-300",children:new Date(e.timestamp).toLocaleTimeString()})]})},e.id))}):(0,s.jsx)("p",{className:"text-blue-200 text-center py-4",children:"暂无游戏记录"})]})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-2xl p-8 mb-6",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFB0"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"开始游戏"}),(0,s.jsx)("p",{className:"text-blue-200 mb-6",children:"连接钱包开始您的转盘之旅"}),(0,s.jsx)("button",{onClick:connectWallet,disabled:g,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50",children:g?"连接中...":"\uD83D\uDD17 连接钱包"})]}),(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:[(0,s.jsx)("h3",{className:"text-white font-semibold mb-3",children:"\uD83D\uDCB0 奖励一览"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between text-white",children:[(0,s.jsx)("span",{children:"\uD83C\uDF81 小奖"}),(0,s.jsx)("span",{className:"text-yellow-400",children:"150 MAO / 15,000 PI"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-white",children:[(0,s.jsx)("span",{children:"\uD83C\uDFC6 大奖"}),(0,s.jsx)("span",{className:"text-yellow-400",children:"800 MAO / 80,000 PI"})]}),(0,s.jsxs)("div",{className:"flex justify-between text-white",children:[(0,s.jsx)("span",{children:"\uD83D\uDC8E 终极大奖"}),(0,s.jsx)("span",{className:"text-yellow-400",children:"3,000 MAO / 300,000 PI"})]})]})]})]})})]})}}},function(e){e.O(0,[26,415,774,888,179],function(){return e(e.s=9644)}),_N_E=e.O()}]);