(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5405],{5557:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(9309)}])},9309:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return Home}});var s=l(5893),a=l(7294),n=l(565),r=l(7583),components_WalletConnection=e=>{let{account:t,balances:l,onConnect:a}=e,formatBalance=e=>parseFloat(e).toFixed(2);return(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"钱包连接"}),t?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"✅"}),(0,s.jsx)("p",{className:"text-green-400 font-semibold",children:"钱包已连接"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm mt-1",children:t?"".concat(t.slice(0,6),"...").concat(t.slice(-4)):""})]}),(0,s.jsxs)("div",{className:"border-t border-white/20 pt-4",children:[(0,s.jsx)("h4",{className:"text-white font-semibold mb-3",children:"代币余额"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center bg-white/5 rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3",children:"M"}),(0,s.jsx)("span",{className:"text-white",children:"MAO"})]}),(0,s.jsx)("span",{className:"text-yellow-400 font-bold",children:formatBalance(l.MAO)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center bg-white/5 rounded-lg p-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3",children:"π"}),(0,s.jsx)("span",{className:"text-white",children:"PI"})]}),(0,s.jsx)("span",{className:"text-yellow-400 font-bold",children:formatBalance(l.PI)})]})]})]}),(0,s.jsx)("div",{className:"bg-blue-500/20 border border-blue-500 rounded-lg p-3",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-blue-400 mr-2",children:"ℹ️"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm",children:"确保您在 AlveyChain 网络上"})]})})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDD12"}),(0,s.jsx)("p",{className:"text-blue-200 mb-4",children:"请连接您的钱包开始游戏"}),(0,s.jsx)("button",{onClick:a,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105",children:"\uD83D\uDD17 连接钱包"})]})]})},components_WheelGame=e=>{let{account:t,contract:l,balances:r,onUpdateBalances:i,onGameResult:o}=e,[c,d]=(0,a.useState)("MAO"),[m,x]=(0,a.useState)(!1),[h,u]=(0,a.useState)(null),[b,p]=(0,a.useState)(!1),w=(0,a.useRef)(null),j={MAO:{betAmount:100,rewards:[{level:0,name:"谢谢惠顾",amount:0,color:"#6B7280",textColor:"#FFFFFF"},{level:1,name:"小奖",amount:150,color:"#F59E0B",textColor:"#FFFFFF"},{level:2,name:"中奖",amount:400,color:"#EF4444",textColor:"#FFFFFF"},{level:3,name:"大奖",amount:800,color:"#8B5CF6",textColor:"#FFFFFF"},{level:4,name:"超级大奖",amount:1500,color:"#10B981",textColor:"#FFFFFF"},{level:5,name:"终极大奖",amount:3e3,color:"#F97316",textColor:"#FFFFFF"}]},PI:{betAmount:1e4,rewards:[{level:0,name:"谢谢惠顾",amount:0,color:"#6B7280",textColor:"#FFFFFF"},{level:1,name:"小奖",amount:15e3,color:"#F59E0B",textColor:"#FFFFFF"},{level:2,name:"中奖",amount:4e4,color:"#EF4444",textColor:"#FFFFFF"},{level:3,name:"大奖",amount:8e4,color:"#8B5CF6",textColor:"#FFFFFF"},{level:4,name:"超级大奖",amount:15e4,color:"#10B981",textColor:"#FFFFFF"},{level:5,name:"终极大奖",amount:3e5,color:"#F97316",textColor:"#FFFFFF"}]}},f=j[c].rewards.map((e,t)=>({...e,startAngle:60*t,endAngle:(t+1)*60,angle:60})),drawWheel=()=>{let e=w.current;if(!e)return;let t=e.getContext("2d"),l=e.width/2,s=e.height/2,a=Math.min(l,s)-15;t.clearRect(0,0,e.width,e.height),t.beginPath(),t.arc(l,s,a+8,0,2*Math.PI),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(),f.forEach((e,n)=>{let r=e.startAngle*Math.PI/180-Math.PI/2,i=e.endAngle*Math.PI/180-Math.PI/2;t.beginPath(),t.moveTo(l,s),t.arc(l,s,a,r,i),t.closePath();let o=t.createRadialGradient(l,s,0,l,s,a);o.addColorStop(0,e.color),o.addColorStop(1,e.color+"80"),t.fillStyle=o,t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=3,t.stroke();let c=(r+i)/2,d=.65*a,m=l+Math.cos(c)*d,x=s+Math.sin(c)*d;if(t.save(),t.translate(m,x),t.rotate(c+Math.PI/2),t.fillStyle=e.textColor,t.font="bold 14px Arial",t.textAlign="center",t.strokeStyle="rgba(0, 0, 0, 0.8)",t.lineWidth=2,t.strokeText(e.name,0,-5),t.fillText(e.name,0,-5),e.amount>0){t.font="bold 12px Arial";let l="".concat(e.amount.toLocaleString());t.strokeText(l,0,10),t.fillText(l,0,10)}t.restore()});let n=t.createRadialGradient(l,s,0,l,s,40);n.addColorStop(0,"#FFFFFF"),n.addColorStop(1,"#E5E7EB"),t.beginPath(),t.arc(l,s,40,0,2*Math.PI),t.fillStyle=n,t.fill(),t.strokeStyle="#374151",t.lineWidth=3,t.stroke(),t.fillStyle="#374151",t.font="bold 16px Arial",t.textAlign="center",t.fillText("\uD83C\uDFB0",l,s+5),t.beginPath(),t.moveTo(l+a+5,s),t.lineTo(l+a-25,s-12.5),t.lineTo(l+a-25,s+12.5),t.closePath();let r=t.createLinearGradient(l+a+5,s,l+a-25,s);r.addColorStop(0,"#EF4444"),r.addColorStop(1,"#DC2626"),t.fillStyle=r,t.fill(),t.strokeStyle="#7F1D1D",t.lineWidth=2,t.stroke()};(0,a.useEffect)(()=>{drawWheel()},[c]);let spinWheel=e=>{let t=w.current;if(!t)return;let l=2880+e,s=Date.now(),a=0,animate=()=>{let e=Date.now()-s,n=Math.min(e/4e3,1);a=l*(1-Math.pow(1-n,4)),t.style.transform="rotate(".concat(a,"deg)"),n<1?requestAnimationFrame(animate):(x(!1),p(!0))};requestAnimationFrame(animate)},playGame=async()=>{if(!t||!l){alert("请先连接钱包");return}let e=j[c],s=e.betAmount;if(r[c]<s){alert("余额不足！需要 ".concat(s.toLocaleString()," ").concat(c));return}try{let t;x(!0),p(!1),u(null),t="MAO"===c?await l.playMAOGame():await l.playPIGame();let s=await t.wait(),a=s.events.find(e=>"GamePlayed"===e.event);if(a){let{rewardAmount:t,rewardLevel:l,randomSeed:s}=a.args,r={level:l,name:e.rewards[l].name,amount:parseFloat(n.utils.formatEther(t)),isWin:l>0};u(r);let c=f[l],d=Math.random()*c.angle,m=360-(c.startAngle+d);spinWheel(m),i&&i(),o&&o(r)}}catch(e){console.error("游戏错误:",e),x(!1),alert("游戏失败："+(e.reason||e.message))}},closeResult=()=>{p(!1),u(null),w.current&&(w.current.style.transform="rotate(0deg)")};return(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-white mb-6 text-center",children:"\uD83C\uDFB0 转盘游戏"}),(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"bg-white/20 rounded-lg p-1 flex",children:["MAO","PI"].map(e=>(0,s.jsx)("button",{onClick:()=>d(e),className:"px-6 py-2 rounded-md font-semibold transition-all ".concat(c===e?"bg-blue-600 text-white shadow-lg":"text-blue-200 hover:text-white"),children:e},e))})}),(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"relative wheel-container",children:(0,s.jsx)("canvas",{ref:w,width:350,height:350,className:"transition-transform duration-1000 ease-out drop-shadow-2xl"})})}),(0,s.jsx)("div",{className:"bg-white/20 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h4",{className:"text-lg font-semibold text-white mb-2",children:[c," 转盘游戏"]}),(0,s.jsxs)("div",{className:"text-blue-200 text-sm space-y-1",children:[(0,s.jsxs)("p",{children:["投注金额: ",(0,s.jsxs)("span",{className:"text-yellow-400 font-bold",children:[j[c].betAmount.toLocaleString()," ",c]})]}),(0,s.jsxs)("p",{children:["您的余额: ",(0,s.jsxs)("span",{className:"text-green-400 font-bold",children:[parseFloat(r[c]).toFixed(2)," ",c]})]})]})]})}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4 mb-6",children:[(0,s.jsx)("h5",{className:"text-white font-semibold mb-3 text-center",children:"\uD83C\uDFC6 奖励表"}),(0,s.jsx)("div",{className:"space-y-2",children:j[c].rewards.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{className:"text-white font-medium",children:e.name})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("div",{className:"text-yellow-400 font-bold",children:e.amount>0?"".concat(e.amount.toLocaleString()," ").concat(c):"无奖励"})})]},t))})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("button",{onClick:playGame,disabled:m||!t||r[c]<j[c].betAmount,className:"w-full py-4 px-6 rounded-lg font-bold text-xl transition-all duration-200 transform ".concat(m?"bg-gray-500 cursor-not-allowed":t?r[c]<j[c].betAmount?"bg-red-500 cursor-not-allowed":"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white hover:scale-105 shadow-lg":"bg-gray-500 cursor-not-allowed"),children:m?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-2"}),"转盘中..."]}):t?r[c]<j[c].betAmount?"余额不足":"\uD83C\uDFAF 开始游戏 (".concat(j[c].betAmount.toLocaleString()," ").concat(c,")"):"请连接钱包"})}),b&&h&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 modal-enter",onClick:closeResult,children:(0,s.jsx)("div",{className:"bg-white rounded-xl p-8 max-w-md mx-4 shadow-2xl",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4 animate-bounce",children:h.isWin?"\uD83C\uDF89":"\uD83D\uDE14"}),(0,s.jsx)("h3",{className:"text-2xl font-bold mb-2 text-gray-800",children:h.name}),h.isWin?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-green-600 text-xl font-bold mb-2",children:"恭喜中奖！"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-4",children:["获得奖励: ",(0,s.jsxs)("span",{className:"text-yellow-600 font-bold text-xl",children:[h.amount.toLocaleString()," ",c]})]})]}):(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"很遗憾，请再试一次！"}),(0,s.jsx)("button",{onClick:closeResult,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition-all",children:"继续游戏"})]})})})]})},components_GameHistory=e=>{let{history:t,account:l}=e,[n,r]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(l){let e=localStorage.getItem("gameHistory_".concat(l));e&&r(JSON.parse(e))}},[l]);let formatTime=e=>new Date(e).toLocaleString("zh-CN"),formatAmount=e=>parseFloat(e).toFixed(2),i=[{id:1,token:"MAO",betAmount:"100",rewardAmount:"0",isWin:!1,timestamp:Date.now()-36e5,txHash:"0x123...abc"},{id:2,token:"PI",betAmount:"10000",rewardAmount:"1000",isWin:!0,timestamp:Date.now()-72e5,txHash:"0x456...def"},{id:3,token:"MAO",betAmount:"100",rewardAmount:"25",isWin:!0,timestamp:Date.now()-108e5,txHash:"0x789...ghi"}],o=n.length>0?n:i;return(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 h-full",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"游戏历史"}),l?(0,s.jsx)("div",{className:"space-y-4",children:0===o.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFAE"}),(0,s.jsx)("p",{className:"text-blue-200",children:"还没有游戏记录"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm mt-1",children:"开始您的第一次游戏吧！"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("span",{className:"text-blue-200 text-sm",children:"最近游戏记录"}),(0,s.jsxs)("span",{className:"text-blue-200 text-sm",children:[o.length," 条记录"]})]}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-3",children:o.map(e=>(0,s.jsxs)("div",{className:"p-4 rounded-lg border ".concat(e.isWin?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-2xl mr-3",children:e.isWin?"\uD83C\uDF89":"\uD83D\uDE14"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-white font-semibold",children:[e.token," 转盘"]}),(0,s.jsx)("div",{className:"text-blue-200 text-xs",children:formatTime(e.timestamp)})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"font-bold ".concat(e.isWin?"text-green-400":"text-red-400"),children:e.isWin?"+".concat(formatAmount(e.rewardAmount)):"谢谢惠顾"}),(0,s.jsxs)("div",{className:"text-blue-200 text-xs",children:["投注: ",formatAmount(e.betAmount)," ",e.token]})]})]}),e.txHash&&(0,s.jsx)("div",{className:"mt-2 pt-2 border-t border-white/20",children:(0,s.jsxs)("a",{href:"https://alveyscan.com/tx/".concat(e.txHash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 text-xs flex items-center",children:[(0,s.jsx)("span",{className:"mr-1",children:"\uD83D\uDD17"}),"查看交易详情"]})})]},e.id))}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-white/20",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"总游戏次数:"}),(0,s.jsx)("span",{className:"text-white font-semibold",children:o.length})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm mt-1",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"胜率:"}),(0,s.jsx)("span",{className:"text-green-400 font-semibold",children:o.length>0?"".concat((o.filter(e=>e.isWin).length/o.length*100).toFixed(1),"%"):"0%"})]})]})]})}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC8"}),(0,s.jsx)("p",{className:"text-blue-200",children:"连接钱包查看游戏历史"})]})]})},i=l(2592),components_QRGameComponent=e=>{let{gameType:t,onGameResult:l}=e,[n,r]=(0,a.useState)(""),[o,c]=(0,a.useState)(""),[d,m]=(0,a.useState)(!1),generateMobileGameUrl=()=>{let e=window.location.origin,l="".concat(e,"/mobile?token=").concat(t);return l},generateQRCode=async()=>{try{m(!0);let e=generateMobileGameUrl();c(e);let t=await i.toDataURL(e,{width:280,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"});r(t)}catch(e){console.error("生成二维码失败:",e),alert("生成二维码失败")}finally{m(!1)}};return(0,s.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 max-w-md mx-auto",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-white mb-4",children:"\uD83D\uDCF1 手机游戏"}),(0,s.jsxs)("div",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg mb-4",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[t," 游戏"]}),(0,s.jsxs)("p",{className:"text-sm opacity-90",children:["投注: ","MAO"===t?"100 MAO":"10,000 PI"]})]}),n?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg p-4 qr-container",children:(0,s.jsx)("img",{src:n,alt:"游戏二维码",className:"w-full max-w-xs mx-auto qr-code"})}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-200 text-sm mb-2",children:"\uD83D\uDCF1 扫码说明"}),(0,s.jsxs)("div",{className:"text-xs text-blue-100 space-y-1",children:[(0,s.jsx)("p",{children:"• 使用手机相机或微信扫一扫"}),(0,s.jsx)("p",{children:"• 自动跳转到移动端游戏"}),(0,s.jsx)("p",{children:"• 连接钱包开始游戏"})]})]}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-200 text-sm mb-2",children:"\uD83D\uDD17 游戏链接"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"text",value:o,readOnly:!0,className:"flex-1 bg-black/20 text-white text-xs p-2 rounded border border-white/20 font-mono"}),(0,s.jsx)("button",{onClick:()=>{o&&navigator.clipboard.writeText(o).then(()=>{alert("链接已复制到剪贴板！")}).catch(()=>{alert("复制失败，请手动复制链接")})},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-xs font-bold transition-colors",children:"复制"})]})]}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("p",{className:"text-blue-200 text-sm mb-2",children:"\uD83C\uDFAE 支持的钱包"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{name:"MetaMask",icon:"\uD83E\uDD8A"},{name:"Trust Wallet",icon:"\uD83D\uDEE1️"},{name:"Coinbase Wallet",icon:"\uD83D\uDCB0"},{name:"WalletConnect",icon:"\uD83D\uDD17"}].map(e=>(0,s.jsxs)("div",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs flex items-center",children:[(0,s.jsx)("span",{className:"mr-1",children:e.icon}),e.name]},e.name))})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{r(""),c("")},className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:"\uD83D\uDD04 重新生成"}),(0,s.jsx)("button",{onClick:()=>window.open(o,"_blank"),className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:"\uD83D\uDE80 直接访问"})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-4xl mb-3",children:"\uD83C\uDFB0"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm mb-2",children:"\uD83D\uDCDD 使用说明"}),(0,s.jsxs)("ul",{className:"text-xs text-blue-100 space-y-1 text-left",children:[(0,s.jsx)("li",{children:'• 点击"生成二维码"按钮'}),(0,s.jsx)("li",{children:"• 用手机扫描二维码"}),(0,s.jsx)("li",{children:"• 在手机上连接钱包"}),(0,s.jsx)("li",{children:"• 开始游戏！"})]})]}),(0,s.jsx)("button",{onClick:generateQRCode,disabled:d,className:"w-full py-3 px-6 rounded-lg font-bold transition-all transform ".concat(d?"bg-gray-500 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white hover:scale-105 shadow-lg"),children:d?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"生成中..."]}):"\uD83C\uDFAF 生成游戏二维码"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-lg p-4 mt-4",children:[(0,s.jsx)("h4",{className:"text-white font-bold text-sm mb-2",children:"\uD83C\uDF1F 游戏特色"}),(0,s.jsxs)("div",{className:"text-xs text-yellow-200 space-y-1",children:[(0,s.jsx)("p",{children:"• \uD83C\uDFAF 6个区域平均分配，视觉美观"}),(0,s.jsxs)("p",{children:["• \uD83C\uDFC6 丰富奖励等级，从150到","MAO"===t?"3000":"300000"]}),(0,s.jsx)("p",{children:"• \uD83D\uDCF1 移动端优化，流畅游戏体验"}),(0,s.jsx)("p",{children:"• \uD83D\uDD17 区块链技术，透明公平"})]})]})]})})};let o=["function playMAOGame() external","function playPIGame() external","function getPlayerHistory(address player) external view returns (tuple(address player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 timestamp, uint256 randomSeed)[])","function getRewardLevelName(uint8 level) external pure returns (string)","event GamePlayed(address indexed player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 randomSeed)"],c=["function balanceOf(address owner) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"],d={WHEEL_GAME:"0xc27e29BCe41db77815435a9415329424849Daeb6",MAO_TOKEN:"0x22f49bcb3dad370a9268ba3fca33cb037ca3d022",PI_TOKEN:"0xfd4680e25e05b3435c7f698668d1ce80d2a9f444"},m={chainId:"0xED5",chainName:"AlveyChain Mainnet",nativeCurrency:{name:"ALV",symbol:"ALV",decimals:18},rpcUrls:["https://elves-core1.alvey.io"],blockExplorerUrls:["https://alveyscan.com"]};function Home(){let[e,t]=(0,a.useState)(null),[l,i]=(0,a.useState)(null),[x,h]=(0,a.useState)(null),[u,b]=(0,a.useState)({}),[p,w]=(0,a.useState)({MAO:"0",PI:"0"}),[j,f]=(0,a.useState)([]),[g,N]=(0,a.useState)(!1),[v,y]=(0,a.useState)("web"),[F,D]=(0,a.useState)("MAO"),checkNetwork=async()=>{if(!window.ethereum)return!1;try{let e=await window.ethereum.request({method:"eth_chainId"});return e===m.chainId}catch(e){return console.error("检查网络错误:",e),!1}},switchToAlveyNetwork=async()=>{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:m.chainId}]})}catch(e){if(4902===e.code)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[m]})}catch(e){throw console.error("添加网络错误:",e),e}else throw e}},connectWallet=async()=>{if(!window.ethereum){alert("请安装 MetaMask!");return}try{N(!0);let e=await checkNetwork();e||await switchToAlveyNetwork();let l=await window.ethereum.request({method:"eth_requestAccounts"});if(l.length>0){let e=new n.providers.Web3Provider(window.ethereum),s=e.getSigner();t(l[0]),i(e),h(s),await initializeContracts(s),await loadBalances(l[0],s),await loadGameHistory(l[0],s)}}catch(e){console.error("连接钱包错误:",e),alert("连接钱包失败: "+e.message)}finally{N(!1)}},initializeContracts=async e=>{try{let t=new r.CH(d.WHEEL_GAME,o,e),l=new r.CH(d.MAO_TOKEN,c,e),s=new r.CH(d.PI_TOKEN,c,e);return b({wheelGame:t,maoToken:l,piToken:s}),{wheelGame:t,maoToken:l,piToken:s}}catch(e){throw console.error("初始化合约错误:",e),e}},loadBalances=async(e,t)=>{try{let l=u.maoToken?u:await initializeContracts(t),[s,a]=await Promise.all([l.maoToken.balanceOf(e),l.piToken.balanceOf(e)]);w({MAO:n.utils.formatEther(s),PI:n.utils.formatEther(a)})}catch(e){console.error("加载余额错误:",e)}},loadGameHistory=async(e,t)=>{try{let l=u.wheelGame?u:await initializeContracts(t),s=await l.wheelGame.getPlayerHistory(e),a=s.map((e,t)=>({id:t+1,token:0===e.tokenType?"MAO":"PI",betAmount:n.utils.formatEther(e.betAmount),rewardAmount:n.utils.formatEther(e.rewardAmount),isWin:e.rewardLevel>0,timestamp:1e3*e.timestamp.toNumber(),txHash:null}));f(a)}catch(e){console.error("加载游戏历史错误:",e)}},updateBalances=async()=>{e&&x&&await loadBalances(e,x)},approveTokens=async()=>{if(u.maoToken&&u.piToken)try{N(!0);let t=n.constants.MaxUint256,[l,s]=await Promise.all([u.maoToken.allowance(e,d.WHEEL_GAME),u.piToken.allowance(e,d.WHEEL_GAME)]),a=[];if(l.lt(n.utils.parseEther("1000"))&&a.push(u.maoToken.approve(d.WHEEL_GAME,t)),s.lt(n.utils.parseEther("100000"))&&a.push(u.piToken.approve(d.WHEEL_GAME,t)),a.length>0){for(let e of(alert("需要授权 ".concat(a.length," 个代币，请在钱包中确认交易")),a)){let t=await e;await t.wait()}alert("代币授权成功！")}}catch(e){console.error("授权错误:",e),alert("授权失败: "+e.message)}finally{N(!1)}};return(0,a.useEffect)(()=>(window.ethereum&&(window.ethereum.on("accountsChanged",e=>{0===e.length?(t(null),i(null),h(null),b({}),w({MAO:"0",PI:"0"}),f([])):connectWallet()}),window.ethereum.on("chainChanged",()=>{window.location.reload()})),()=>{window.ethereum&&(window.ethereum.removeAllListeners("accountsChanged"),window.ethereum.removeAllListeners("chainChanged"))}),[]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[(0,s.jsx)("header",{className:"bg-black/20 backdrop-blur-lg border-b border-white/10",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-white",children:"\uD83C\uDFB0 MAO转盘游戏"}),(0,s.jsx)("div",{className:"ml-4 text-sm text-blue-200",children:"AlveyChain 区块链游戏"})]}),e&&(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"bg-white/10 rounded-lg p-1 flex",children:[(0,s.jsx)("button",{onClick:()=>y("web"),className:"px-4 py-2 rounded-md font-semibold text-sm transition-all ".concat("web"===v?"bg-blue-600 text-white":"text-blue-200 hover:text-white"),children:"\uD83D\uDDA5️ 网页游戏"}),(0,s.jsx)("button",{onClick:()=>y("qr"),className:"px-4 py-2 rounded-md font-semibold text-sm transition-all ".concat("qr"===v?"bg-purple-600 text-white":"text-blue-200 hover:text-white"),children:"\uD83D\uDCF1 扫码游戏"})]}),(0,s.jsx)("button",{onClick:approveTokens,disabled:g,className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-semibold text-sm",children:g?"处理中...":"授权代币"}),(0,s.jsx)("button",{onClick:updateBalances,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold text-sm",children:"\uD83D\uDD04 刷新余额"})]})]})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["0x0000000000000000000000000000000000000000"===d.WHEEL_GAME&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-500 rounded-lg p-4 mb-8",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-red-400 mr-2",children:"⚠️"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-red-200 font-semibold",children:"合约未部署"}),(0,s.jsx)("p",{className:"text-red-200 text-sm",children:"请先部署智能合约并更新合约地址"})]})]})}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-8",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDA5️"}),(0,s.jsx)("h3",{className:"text-white font-semibold",children:"网页游戏"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm",children:"在电脑上直接游戏"})]}),(0,s.jsx)("div",{className:"text-white text-2xl",children:"VS"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF1"}),(0,s.jsx)("h3",{className:"text-white font-semibold",children:"扫码游戏"}),(0,s.jsx)("p",{className:"text-blue-200 text-sm",children:"用手机钱包扫码游戏"})]})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-8",children:[(0,s.jsx)(components_WalletConnection,{account:e,balances:p,onConnect:connectWallet}),"qr"===v&&e&&(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"\uD83C\uDFAF 选择代币"}),(0,s.jsx)("div",{className:"space-y-3",children:["MAO","PI"].map(e=>(0,s.jsx)("button",{onClick:()=>D(e),className:"w-full p-3 rounded-lg font-semibold transition-all ".concat(F===e?"bg-blue-600 text-white":"bg-white/20 text-blue-200 hover:bg-white/30 hover:text-white"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("span",{className:"text-sm",children:"MAO"===e?"100 MAO":"10,000 PI"})]})},e))})]}),e&&(0,s.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"\uD83C\uDFC6 游戏统计"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"总游戏次数:"}),(0,s.jsx)("span",{className:"text-white font-bold",children:j.length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"获胜次数:"}),(0,s.jsx)("span",{className:"text-green-400 font-bold",children:j.filter(e=>e.isWin).length})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"胜率:"}),(0,s.jsx)("span",{className:"text-yellow-400 font-bold",children:j.length>0?"".concat((j.filter(e=>e.isWin).length/j.length*100).toFixed(1),"%"):"0%"})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-blue-200",children:"游戏模式:"}),(0,s.jsx)("span",{className:"text-purple-400 font-bold",children:"web"===v?"\uD83D\uDDA5️ 网页":"\uD83D\uDCF1 扫码"})]})]})]})]}),(0,s.jsx)("div",{className:"lg:col-span-1",children:"web"===v?(0,s.jsx)(components_WheelGame,{account:e,contract:u.wheelGame,balances:p,onUpdateBalances:updateBalances,onGameResult:t=>{let l={id:j.length+1,token:t.token,betAmount:t.betAmount,rewardAmount:t.amount,isWin:t.isWin,timestamp:Date.now(),txHash:null};if(f(e=>[l,...e]),e){let t=[l,...j];localStorage.setItem("gameHistory_".concat(e),JSON.stringify(t))}}}):(0,s.jsx)(components_QRGameComponent,{gameType:F,onGameResult:t=>{let l={id:j.length+1,token:F,betAmount:"MAO"===F?"100":"10000",rewardAmount:t.amount.toString(),isWin:t.isWin,timestamp:Date.now(),txHash:t.transactionHash};if(f(e=>[l,...e]),e){let t=[l,...j];localStorage.setItem("gameHistory_".concat(e),JSON.stringify(t))}updateBalances(),alert("游戏完成！".concat(t.isWin?"恭喜获得 ".concat(t.amount," ").concat(F,"！"):"谢谢惠顾！"))}})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(components_GameHistory,{history:j,account:e})})]})]}),(0,s.jsx)("footer",{className:"bg-black/20 backdrop-blur-lg border-t border-white/10 mt-16",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-blue-200 text-sm",children:"\uD83C\uDFAE 基于 AlveyChain 的去中心化转盘游戏"}),(0,s.jsx)("p",{className:"text-blue-300 text-xs mt-2",children:"支持网页游戏和手机扫码游戏 • 请理性游戏，风险自担"})]})})})]})}}},function(e){e.O(0,[7583,465,9774,2888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);