"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{6415:function(e,t,l){var a=l(5893),o=l(7294),n=l(565);t.Z=e=>{let{account:t,contract:l,balances:r,onUpdateBalances:s,onGameResult:i}=e,[c,d]=(0,o.useState)("MAO"),[m,x]=(0,o.useState)(!1),[h,u]=(0,o.useState)(null),[F,b]=(0,o.useState)(!1),f=(0,o.useRef)(null),g={MAO:{betAmount:100,rewards:[{level:0,name:"谢谢惠顾",amount:0,color:"#6B7280",textColor:"#FFFFFF"},{level:1,name:"小奖",amount:150,color:"#F59E0B",textColor:"#FFFFFF"},{level:2,name:"中奖",amount:400,color:"#EF4444",textColor:"#FFFFFF"},{level:3,name:"大奖",amount:800,color:"#8B5CF6",textColor:"#FFFFFF"},{level:4,name:"超级大奖",amount:1500,color:"#10B981",textColor:"#FFFFFF"},{level:5,name:"终极大奖",amount:3e3,color:"#F97316",textColor:"#FFFFFF"}]},PI:{betAmount:1e4,rewards:[{level:0,name:"谢谢惠顾",amount:0,color:"#6B7280",textColor:"#FFFFFF"},{level:1,name:"小奖",amount:15e3,color:"#F59E0B",textColor:"#FFFFFF"},{level:2,name:"中奖",amount:4e4,color:"#EF4444",textColor:"#FFFFFF"},{level:3,name:"大奖",amount:8e4,color:"#8B5CF6",textColor:"#FFFFFF"},{level:4,name:"超级大奖",amount:15e4,color:"#10B981",textColor:"#FFFFFF"},{level:5,name:"终极大奖",amount:3e5,color:"#F97316",textColor:"#FFFFFF"}]}},p=g[c].rewards.map((e,t)=>({...e,startAngle:60*t,endAngle:(t+1)*60,angle:60})),drawWheel=()=>{let e=f.current;if(!e)return;let t=e.getContext("2d"),l=e.width/2,a=e.height/2,o=Math.min(l,a)-15;t.clearRect(0,0,e.width,e.height),t.beginPath(),t.arc(l,a,o+8,0,2*Math.PI),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(),p.forEach((e,n)=>{let r=e.startAngle*Math.PI/180-Math.PI/2,s=e.endAngle*Math.PI/180-Math.PI/2;t.beginPath(),t.moveTo(l,a),t.arc(l,a,o,r,s),t.closePath();let i=t.createRadialGradient(l,a,0,l,a,o);i.addColorStop(0,e.color),i.addColorStop(1,e.color+"80"),t.fillStyle=i,t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=3,t.stroke();let c=(r+s)/2,d=.65*o,m=l+Math.cos(c)*d,x=a+Math.sin(c)*d;if(t.save(),t.translate(m,x),t.rotate(c+Math.PI/2),t.fillStyle=e.textColor,t.font="bold 14px Arial",t.textAlign="center",t.strokeStyle="rgba(0, 0, 0, 0.8)",t.lineWidth=2,t.strokeText(e.name,0,-5),t.fillText(e.name,0,-5),e.amount>0){t.font="bold 12px Arial";let l="".concat(e.amount.toLocaleString());t.strokeText(l,0,10),t.fillText(l,0,10)}t.restore()});let n=t.createRadialGradient(l,a,0,l,a,40);n.addColorStop(0,"#FFFFFF"),n.addColorStop(1,"#E5E7EB"),t.beginPath(),t.arc(l,a,40,0,2*Math.PI),t.fillStyle=n,t.fill(),t.strokeStyle="#374151",t.lineWidth=3,t.stroke(),t.fillStyle="#374151",t.font="bold 16px Arial",t.textAlign="center",t.fillText("\uD83C\uDFB0",l,a+5),t.beginPath(),t.moveTo(l+o+5,a),t.lineTo(l+o-25,a-12.5),t.lineTo(l+o-25,a+12.5),t.closePath();let r=t.createLinearGradient(l+o+5,a,l+o-25,a);r.addColorStop(0,"#EF4444"),r.addColorStop(1,"#DC2626"),t.fillStyle=r,t.fill(),t.strokeStyle="#7F1D1D",t.lineWidth=2,t.stroke()};(0,o.useEffect)(()=>{drawWheel()},[c]);let spinWheel=e=>{let t=f.current;if(!t)return;let l=2880+e,a=Date.now(),o=0,animate=()=>{let e=Date.now()-a,n=Math.min(e/4e3,1);o=l*(1-Math.pow(1-n,4)),t.style.transform="rotate(".concat(o,"deg)"),n<1?requestAnimationFrame(animate):(x(!1),b(!0))};requestAnimationFrame(animate)},playGame=async()=>{if(!t||!l){alert("请先连接钱包");return}let e=g[c],a=e.betAmount;if(r[c]<a){alert("余额不足！需要 ".concat(a.toLocaleString()," ").concat(c));return}try{let t;x(!0),b(!1),u(null),t="MAO"===c?await l.playMAOGame():await l.playPIGame();let a=await t.wait(),o=a.events.find(e=>"GamePlayed"===e.event);if(o){let{rewardAmount:t,rewardLevel:l,randomSeed:a}=o.args,r={level:l,name:e.rewards[l].name,amount:parseFloat(n.utils.formatEther(t)),isWin:l>0};u(r);let c=p[l],d=Math.random()*c.angle,m=360-(c.startAngle+d);spinWheel(m),s&&s(),i&&i(r)}}catch(e){console.error("游戏错误:",e),x(!1),alert("游戏失败："+(e.reason||e.message))}},closeResult=()=>{b(!1),u(null),f.current&&(f.current.style.transform="rotate(0deg)")};return(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-white mb-6 text-center",children:"\uD83C\uDFB0 转盘游戏"}),(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsx)("div",{className:"bg-white/20 rounded-lg p-1 flex",children:["MAO","PI"].map(e=>(0,a.jsx)("button",{onClick:()=>d(e),className:"px-6 py-2 rounded-md font-semibold transition-all ".concat(c===e?"bg-blue-600 text-white shadow-lg":"text-blue-200 hover:text-white"),children:e},e))})}),(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsx)("div",{className:"relative wheel-container",children:(0,a.jsx)("canvas",{ref:f,width:350,height:350,className:"transition-transform duration-1000 ease-out drop-shadow-2xl"})})}),(0,a.jsx)("div",{className:"bg-white/20 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("h4",{className:"text-lg font-semibold text-white mb-2",children:[c," 转盘游戏"]}),(0,a.jsxs)("div",{className:"text-blue-200 text-sm space-y-1",children:[(0,a.jsxs)("p",{children:["投注金额: ",(0,a.jsxs)("span",{className:"text-yellow-400 font-bold",children:[g[c].betAmount.toLocaleString()," ",c]})]}),(0,a.jsxs)("p",{children:["您的余额: ",(0,a.jsxs)("span",{className:"text-green-400 font-bold",children:[parseFloat(r[c]).toFixed(2)," ",c]})]})]})]})}),(0,a.jsxs)("div",{className:"bg-white/20 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h5",{className:"text-white font-semibold mb-3 text-center",children:"\uD83C\uDFC6 奖励表"}),(0,a.jsx)("div",{className:"space-y-2",children:g[c].rewards.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded mr-2",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-white font-medium",children:e.name})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"text-yellow-400 font-bold",children:e.amount>0?"".concat(e.amount.toLocaleString()," ").concat(c):"无奖励"})})]},t))})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:playGame,disabled:m||!t||r[c]<g[c].betAmount,className:"w-full py-4 px-6 rounded-lg font-bold text-xl transition-all duration-200 transform ".concat(m?"bg-gray-500 cursor-not-allowed":t?r[c]<g[c].betAmount?"bg-red-500 cursor-not-allowed":"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white hover:scale-105 shadow-lg":"bg-gray-500 cursor-not-allowed"),children:m?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-2"}),"转盘中..."]}):t?r[c]<g[c].betAmount?"余额不足":"\uD83C\uDFAF 开始游戏 (".concat(g[c].betAmount.toLocaleString()," ").concat(c,")"):"请连接钱包"})}),F&&h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 modal-enter",onClick:closeResult,children:(0,a.jsx)("div",{className:"bg-white rounded-xl p-8 max-w-md mx-4 shadow-2xl",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4 animate-bounce",children:h.isWin?"\uD83C\uDF89":"\uD83D\uDE14"}),(0,a.jsx)("h3",{className:"text-2xl font-bold mb-2 text-gray-800",children:h.name}),h.isWin?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-green-600 text-xl font-bold mb-2",children:"恭喜中奖！"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["获得奖励: ",(0,a.jsxs)("span",{className:"text-yellow-600 font-bold text-xl",children:[h.amount.toLocaleString()," ",c]})]})]}):(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"很遗憾，请再试一次！"}),(0,a.jsx)("button",{onClick:closeResult,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition-all",children:"继续游戏"})]})})})]})}}}]);