<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ° MAOè½¬ç›˜æ¸¸æˆ - ç´§æ€¥ä¿®å¤ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        .professional-wheel {
            background: conic-gradient(
                from 0deg,
                #FF6B9D 0deg 208.8deg,    /* è°¢è°¢æƒ é¡¾ 58% */
                #4ECDC4 208.8deg 288deg,  /* å°å¥– 22% */
                #45B7D1 288deg 331.2deg, /* ä¸­å¥– 12% */
                #96CEB4 331.2deg 352.8deg, /* å¤§å¥– 6% */
                #FFEAA7 352.8deg 358.2deg, /* è¶…çº§å¤§å¥– 1.5% */
                #DDA0DD 358.2deg 360deg  /* ç»ˆæå¤§å¥– 0.5% */
            );
            border: 8px solid #FFD700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            animation: wheelGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes wheelGlow {
            0% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
            100% { box-shadow: 0 0 60px rgba(255, 215, 0, 1); }
        }
        
        .game-button {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border: 4px solid white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .game-button:hover:not(:disabled) {
            transform: scale(1.1);
        }
        
        .game-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #FFD700;
            z-index: 10;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 900;
            color: white;
            border: 3px solid white;
            z-index: 5;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <div class="container mx-auto px-4 py-4 max-w-md">
        
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-4">
            <h1 class="text-2xl font-bold text-white mb-2">ğŸ° MAOè½¬ç›˜æ¸¸æˆ</h1>
            <p class="text-blue-200 text-sm">ç´§æ€¥ä¿®å¤ç‰ˆ - è§£å†³ä½™é¢å’Œç•Œé¢é—®é¢˜</p>
        </div>

        <!-- è¿æ¥é’±åŒ… -->
        <div id="walletConnect" class="space-y-4">
            <button id="connectBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl">
                ğŸ”— è¿æ¥é’±åŒ…å¼€å§‹æ¸¸æˆ
            </button>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameInterface" style="display: none;" class="space-y-4">
            
            <!-- é’±åŒ…ä¿¡æ¯ - ç®€åŒ–ç‰ˆ -->
            <div class="bg-white/10 rounded-xl p-3">
                <div class="flex justify-between text-sm">
                    <span class="text-blue-200">é’±åŒ…:</span>
                    <span class="text-white" id="userAddress">æœªè¿æ¥</span>
                </div>
                <div class="flex justify-between text-sm mt-1">
                    <span class="text-blue-200">ç½‘ç»œ:</span>
                    <span class="text-green-400">âœ… AlveyChain</span>
                </div>
            </div>

            <!-- ä½™é¢æ˜¾ç¤º - ä¿®å¤ç‰ˆ -->
            <div class="bg-white/10 rounded-xl p-3">
                <h3 class="text-white font-bold mb-2 text-center">ğŸ’° ä»£å¸ä½™é¢</h3>
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-blue-200">MAO:</span>
                        <span class="text-yellow-400 font-bold" id="maoBalance">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-blue-200">PI:</span>
                        <span class="text-purple-400 font-bold" id="piBalance">åŠ è½½ä¸­...</span>
                    </div>
                </div>
                <button onclick="refreshBalances()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg text-sm mt-2">
                    ğŸ”„ åˆ·æ–°ä½™é¢
                </button>
            </div>

            <!-- ä»£å¸é€‰æ‹© - ç®€åŒ–ç‰ˆ -->
            <div class="bg-white/10 rounded-xl p-3">
                <h3 class="text-white font-bold mb-2 text-center">ğŸ¯ é€‰æ‹©ä»£å¸</h3>
                <div class="flex gap-2">
                    <button id="maoBtn" onclick="selectToken('MAO')" class="flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm">
                        MAO
                    </button>
                    <button id="piBtn" onclick="selectToken('PI')" class="flex-1 bg-purple-600 text-white py-2 rounded-lg text-sm">
                        PI
                    </button>
                </div>
                <div class="text-center mt-2">
                    <span class="text-white text-sm">å½“å‰: </span>
                    <span class="text-yellow-400 font-bold" id="selectedTokenDisplay">MAO (100/æ¬¡)</span>
                </div>
            </div>

            <!-- æˆæƒ - ç®€åŒ–ç‰ˆ -->
            <div class="bg-white/10 rounded-xl p-3">
                <h3 class="text-white font-bold mb-2 text-center">ğŸ”“ ä»£å¸æˆæƒ</h3>
                <button id="approveBtn" onclick="approveCurrentToken()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 rounded-lg">
                    æˆæƒå½“å‰ä»£å¸
                </button>
                <div class="text-center mt-2">
                    <span class="text-sm" id="approvalStatus">çŠ¶æ€: æ£€æŸ¥ä¸­...</span>
                </div>
            </div>

            <!-- è½¬ç›˜æ¸¸æˆ - æ ¸å¿ƒéƒ¨åˆ† -->
            <div class="bg-white/10 rounded-xl p-4">
                <h3 class="text-white font-bold text-center mb-3">ğŸ° å¹¸è¿è½¬ç›˜</h3>
                
                <div class="flex justify-center mb-3">
                    <div class="relative">
                        <div id="wheel" class="w-48 h-48 rounded-full professional-wheel relative">
                            <!-- è½¬ç›˜æŒ‡é’ˆ -->
                            <div class="wheel-pointer"></div>
                            
                            <!-- ä¸­å¿ƒLogo -->
                            <div class="wheel-center">MAO</div>
                        </div>
                        
                        <!-- æ¸¸æˆæŒ‰é’® -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-10">
                            <button id="spinBtn" onclick="startGame()" disabled class="game-button font-bold text-white">
                                <div class="text-xl mb-1">ğŸ”’</div>
                                <div class="text-xs">éœ€æˆæƒ</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ¸¸æˆçŠ¶æ€ -->
                <div class="text-center">
                    <p class="text-blue-200 text-sm mb-1">æŠ•æ³¨é‡‘é¢: <span class="text-yellow-400 font-bold" id="betAmount">100 MAO</span></p>
                    <p class="text-white text-sm" id="gameStatus">è¯·è¿æ¥é’±åŒ…å¹¶æˆæƒä»£å¸</p>
                </div>
            </div>

            <!-- ç´§æ€¥ä¿®å¤å·¥å…· -->
            <div class="bg-red-600/20 rounded-xl p-3">
                <h3 class="text-white font-bold mb-2 text-center">ğŸ”§ ç´§æ€¥ä¿®å¤</h3>
                <div class="space-y-2">
                    <button onclick="forceEnableGame()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg text-sm">
                        å¼ºåˆ¶å¯ç”¨æ¸¸æˆ
                    </button>
                    <button onclick="debugInfo()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 rounded-lg text-sm">
                        æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯
                    </button>
                    <button onclick="resetInterface()" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 rounded-lg text-sm">
                        é‡ç½®ç•Œé¢
                    </button>
                </div>
            </div>

            <!-- æ¸¸æˆè®°å½• -->
            <div class="bg-white/10 rounded-xl p-3">
                <h3 class="text-white font-bold mb-2 text-center">ğŸ“Š æ¸¸æˆè®°å½•</h3>
                <div id="gameHistory" class="text-xs text-blue-200 text-center">
                    æš‚æ— è®°å½•
                </div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®
        const ALVEY_NETWORK = {
            chainId: '0xED5',
            chainName: 'AlveyChain Mainnet',
            nativeCurrency: { name: 'ALV', symbol: 'ALV', decimals: 18 },
            rpcUrls: ['https://elves-core1.alvey.io'],
            blockExplorerUrls: ['https://alveyscan.com'],
        };

        const CONTRACTS = {
            WHEEL_GAME: '0xB677DBcA76061E6301272c83179c8243A4eeB6A5',
            MAO_TOKEN: '0x22f49bcb3dad370a9268ba3fca33cb037ca3d022',
            PI_TOKEN: '0xfd4680e25e05b3435c7f698668d1ce80d2a9f444'
        };

        // å…¨å±€å˜é‡
        let currentAccount = null;
        let provider = null;
        let signer = null;
        let contracts = {};
        let selectedToken = 'MAO';
        let balances = { MAO: 0, PI: 0 };
        let approvalStatus = { MAO: false, PI: false };
        let isSpinning = false;

        // DOMå…ƒç´ 
        const connectBtn = document.getElementById('connectBtn');
        const walletConnect = document.getElementById('walletConnect');
        const gameInterface = document.getElementById('gameInterface');
        const spinBtn = document.getElementById('spinBtn');
        const approveBtn = document.getElementById('approveBtn');

        // ABI
        const WHEEL_GAME_ABI = [
            "function playMAOGame() external",
            "function playPIGame() external"
        ];

        const TOKEN_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function decimals() view returns (uint8)"
        ];

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    alert('è¯·ä½¿ç”¨Web3é’±åŒ…æµè§ˆå™¨ï¼\næ¨èï¼šTPé’±åŒ…ã€Trust Walletã€MetaMask');
                    return;
                }

                connectBtn.textContent = 'è¿æ¥ä¸­...';
                connectBtn.disabled = true;

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts',
                });

                if (accounts.length === 0) {
                    throw new Error('æœªè·å¾—è´¦æˆ·æˆæƒ');
                }

                // æ£€æŸ¥ç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== ALVEY_NETWORK.chainId) {
                    await switchToAlveyNetwork();
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                currentAccount = accounts[0];

                // åˆå§‹åŒ–åˆçº¦
                contracts = {
                    wheelGame: new ethers.Contract(CONTRACTS.WHEEL_GAME, WHEEL_GAME_ABI, signer),
                    maoToken: new ethers.Contract(CONTRACTS.MAO_TOKEN, TOKEN_ABI, signer),
                    piToken: new ethers.Contract(CONTRACTS.PI_TOKEN, TOKEN_ABI, signer)
                };

                // ç«‹å³åŠ è½½æ•°æ®
                await refreshBalances();
                await checkApprovals();

                // æ›´æ–°ç•Œé¢
                document.getElementById('userAddress').textContent = currentAccount.slice(0, 6) + '...' + currentAccount.slice(-4);
                walletConnect.style.display = 'none';
                gameInterface.style.display = 'block';

                console.log('âœ… é’±åŒ…è¿æ¥æˆåŠŸ');

            } catch (error) {
                console.error('è¿æ¥é”™è¯¯:', error);
                alert('è¿æ¥å¤±è´¥: ' + error.message);
                connectBtn.textContent = 'ğŸ”— è¿æ¥é’±åŒ…å¼€å§‹æ¸¸æˆ';
                connectBtn.disabled = false;
            }
        }

        // åˆ‡æ¢ç½‘ç»œ
        async function switchToAlveyNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: ALVEY_NETWORK.chainId }],
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [ALVEY_NETWORK],
                    });
                }
            }
        }

        // åˆ·æ–°ä½™é¢ - ä¿®å¤ç‰ˆæœ¬
        async function refreshBalances() {
            try {
                if (!contracts.maoToken || !contracts.piToken) return;

                const [maoBalance, piBalance] = await Promise.all([
                    contracts.maoToken.balanceOf(currentAccount),
                    contracts.piToken.balanceOf(currentAccount)
                ]);

                // æ­£ç¡®æ ¼å¼åŒ–ä½™é¢ - ä½¿ç”¨9ä½å°æ•°
                balances.MAO = parseFloat(ethers.utils.formatUnits(maoBalance, 9));
                balances.PI = parseFloat(ethers.utils.formatUnits(piBalance, 9));

                // æ›´æ–°æ˜¾ç¤º - æ ¼å¼åŒ–ä¸ºæ˜“è¯»æ ¼å¼
                document.getElementById('maoBalance').textContent = balances.MAO.toLocaleString('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                document.getElementById('piBalance').textContent = balances.PI.toLocaleString('zh-CN', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });

                console.log('âœ… ä½™é¢æ›´æ–°:', { MAO: balances.MAO, PI: balances.PI });

            } catch (error) {
                console.error('åŠ è½½ä½™é¢é”™è¯¯:', error);
                document.getElementById('maoBalance').textContent = 'é”™è¯¯';
                document.getElementById('piBalance').textContent = 'é”™è¯¯';
            }
        }

        // æ£€æŸ¥æˆæƒ
        async function checkApprovals() {
            try {
                if (!contracts.maoToken || !contracts.piToken) return;

                const [maoAllowance, piAllowance] = await Promise.all([
                    contracts.maoToken.allowance(currentAccount, CONTRACTS.WHEEL_GAME),
                    contracts.piToken.allowance(currentAccount, CONTRACTS.WHEEL_GAME)
                ]);

                // æ£€æŸ¥æˆæƒ - ä½¿ç”¨18ä½å°æ•°è¿›è¡Œæ¯”è¾ƒ
                const maoRequired = ethers.utils.parseUnits('100', 18);
                const piRequired = ethers.utils.parseUnits('10000', 18);

                approvalStatus.MAO = maoAllowance.gte(maoRequired);
                approvalStatus.PI = piAllowance.gte(piRequired);

                updateApprovalDisplay();
                updateGameButtonStatus();

                console.log('âœ… æˆæƒçŠ¶æ€æ£€æŸ¥å®Œæˆ:', approvalStatus);

            } catch (error) {
                console.error('æ£€æŸ¥æˆæƒé”™è¯¯:', error);
            }
        }

        // é€‰æ‹©ä»£å¸
        function selectToken(token) {
            selectedToken = token;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.getElementById('maoBtn').className = token === 'MAO' ? 'flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm' : 'flex-1 bg-gray-600 text-white py-2 rounded-lg text-sm';
            document.getElementById('piBtn').className = token === 'PI' ? 'flex-1 bg-purple-600 text-white py-2 rounded-lg text-sm' : 'flex-1 bg-gray-600 text-white py-2 rounded-lg text-sm';

            // æ›´æ–°æ˜¾ç¤º
            const betAmounts = { MAO: '100 MAO', PI: '10,000 PI' };
            const displayTexts = { MAO: 'MAO (100/æ¬¡)', PI: 'PI (10,000/æ¬¡)' };
            
            document.getElementById('selectedTokenDisplay').textContent = displayTexts[token];
            document.getElementById('betAmount').textContent = betAmounts[token];

            updateApprovalDisplay();
            updateGameButtonStatus();
        }

        // æ›´æ–°æˆæƒæ˜¾ç¤º
        function updateApprovalDisplay() {
            const isApproved = approvalStatus[selectedToken];
            const statusText = isApproved ? 'âœ… å·²æˆæƒ' : 'âŒ éœ€è¦æˆæƒ';
            
            document.getElementById('approvalStatus').textContent = `çŠ¶æ€: ${statusText}`;
            
            if (isApproved) {
                approveBtn.textContent = 'âœ… å·²æˆæƒ';
                approveBtn.disabled = true;
                approveBtn.className = 'w-full bg-green-600 text-white font-bold py-2 rounded-lg cursor-not-allowed';
            } else {
                approveBtn.textContent = `ğŸ”“ æˆæƒ ${selectedToken}`;
                approveBtn.disabled = false;
                approveBtn.className = 'w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 rounded-lg';
            }
        }

        // æ›´æ–°æ¸¸æˆæŒ‰é’®çŠ¶æ€
        function updateGameButtonStatus() {
            const isApproved = approvalStatus[selectedToken];
            const hasBalance = balances[selectedToken] >= (selectedToken === 'MAO' ? 100 : 10000);
            
            if (isApproved && hasBalance) {
                spinBtn.disabled = false;
                spinBtn.className = 'game-button font-bold text-white';
                spinBtn.innerHTML = '<div class="text-xl mb-1">ğŸ²</div><div class="text-xs">å¼€å§‹</div>';
                document.getElementById('gameStatus').textContent = 'âœ… å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æ¸¸æˆï¼';
            } else if (!isApproved) {
                spinBtn.disabled = true;
                spinBtn.className = 'game-button font-bold text-white opacity-50 cursor-not-allowed';
                spinBtn.innerHTML = '<div class="text-xl mb-1">ğŸ”’</div><div class="text-xs">éœ€æˆæƒ</div>';
                document.getElementById('gameStatus').textContent = `âŒ è¯·å…ˆæˆæƒ${selectedToken}ä»£å¸`;
            } else if (!hasBalance) {
                spinBtn.disabled = true;
                spinBtn.className = 'game-button font-bold text-white opacity-50 cursor-not-allowed';
                spinBtn.innerHTML = '<div class="text-xl mb-1">ğŸ’°</div><div class="text-xs">ä½™é¢ä¸è¶³</div>';
                document.getElementById('gameStatus').textContent = `âŒ ${selectedToken}ä½™é¢ä¸è¶³`;
            }
        }

        // æˆæƒä»£å¸
        async function approveCurrentToken() {
            try {
                const contract = selectedToken === 'MAO' ? contracts.maoToken : contracts.piToken;
                
                approveBtn.textContent = 'æˆæƒä¸­...';
                approveBtn.disabled = true;

                const tx = await contract.approve(CONTRACTS.WHEEL_GAME, ethers.constants.MaxUint256);
                const receipt = await tx.wait();

                console.log('âœ… æˆæƒæˆåŠŸ:', receipt.transactionHash);
                alert(`${selectedToken}ä»£å¸æˆæƒæˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹æ¸¸æˆäº†ï¼`);

                // é‡æ–°æ£€æŸ¥æˆæƒçŠ¶æ€
                await checkApprovals();

            } catch (error) {
                console.error('æˆæƒé”™è¯¯:', error);
                alert('æˆæƒå¤±è´¥: ' + error.message);
                updateApprovalDisplay();
            }
        }

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            if (isSpinning) return;
            
            try {
                // æ£€æŸ¥æˆæƒ
                if (!approvalStatus[selectedToken]) {
                    alert('è¯·å…ˆæˆæƒä»£å¸ï¼');
                    return;
                }

                // æ£€æŸ¥ä½™é¢
                const required = selectedToken === 'MAO' ? 100 : 10000;
                if (balances[selectedToken] < required) {
                    alert(`${selectedToken}ä½™é¢ä¸è¶³ï¼éœ€è¦${required}ä¸ª${selectedToken}`);
                    return;
                }

                isSpinning = true;
                spinBtn.innerHTML = '<div class="text-lg mb-1">â³</div><div class="text-xs">æ¸¸æˆä¸­</div>';
                spinBtn.disabled = true;
                document.getElementById('gameStatus').textContent = 'ğŸ° æ¸¸æˆè¿›è¡Œä¸­...';

                // è½¬ç›˜åŠ¨ç”»
                const wheel = document.getElementById('wheel');
                const randomRotation = 1800 + Math.random() * 1800;
                wheel.style.transition = 'transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                wheel.style.transform = `rotate(${randomRotation}deg)`;

                // è°ƒç”¨æ™ºèƒ½åˆçº¦
                const method = selectedToken === 'MAO' ? 'playMAOGame' : 'playPIGame';
                const tx = await contracts.wheelGame[method]();
                
                document.getElementById('gameStatus').textContent = 'â³ äº¤æ˜“ç¡®è®¤ä¸­...';
                const receipt = await tx.wait();

                // ç®€å•çš„ç»“æœæ˜¾ç¤º
                alert('ğŸ‰ æ¸¸æˆå®Œæˆï¼è¯·æŸ¥çœ‹æ‚¨çš„ä½™é¢å˜åŒ–ã€‚');
                
                // åˆ·æ–°æ•°æ®
                await refreshBalances();

                // æ·»åŠ åˆ°è®°å½•
                const time = new Date().toLocaleTimeString();
                const historyEntry = `${time} - ${selectedToken}æ¸¸æˆ - äº¤æ˜“: ${receipt.transactionHash.slice(0, 8)}...`;
                document.getElementById('gameHistory').innerHTML = historyEntry + '<br>' + document.getElementById('gameHistory').innerHTML;

            } catch (error) {
                console.error('æ¸¸æˆé”™è¯¯:', error);
                alert('æ¸¸æˆå¤±è´¥: ' + error.message);
            } finally {
                isSpinning = false;
                updateGameButtonStatus();
                wheel.style.transition = 'transform 0.5s ease';
            }
        }

        // ç´§æ€¥ä¿®å¤å‡½æ•°
        function forceEnableGame() {
            spinBtn.disabled = false;
            spinBtn.className = 'game-button font-bold text-white';
            spinBtn.innerHTML = '<div class="text-xl mb-1">ğŸ²</div><div class="text-xs">å¼ºåˆ¶å¯ç”¨</div>';
            document.getElementById('gameStatus').textContent = 'ğŸ”§ æŒ‰é’®å·²å¼ºåˆ¶å¯ç”¨';
            alert('ğŸ”§ æ¸¸æˆæŒ‰é’®å·²å¼ºåˆ¶å¯ç”¨ï¼');
        }

        function debugInfo() {
            const info = `
ğŸ” è°ƒè¯•ä¿¡æ¯:
è´¦æˆ·: ${currentAccount}
é€‰æ‹©ä»£å¸: ${selectedToken}
MAOä½™é¢: ${balances.MAO}
PIä½™é¢: ${balances.PI}
MAOæˆæƒ: ${approvalStatus.MAO}
PIæˆæƒ: ${approvalStatus.PI}
æŒ‰é’®çŠ¶æ€: ${spinBtn.disabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
            `;
            alert(info);
            console.log('è°ƒè¯•ä¿¡æ¯:', {
                currentAccount,
                selectedToken,
                balances,
                approvalStatus,
                buttonDisabled: spinBtn.disabled
            });
        }

        function resetInterface() {
            location.reload();
        }

        // äº‹ä»¶ç›‘å¬
        connectBtn.addEventListener('click', connectWallet);

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æ£€æŸ¥è¿æ¥
        window.addEventListener('load', async () => {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ');
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        console.log('ğŸ”— æ£€æµ‹åˆ°å·²è¿æ¥è´¦æˆ·ï¼Œè‡ªåŠ¨è¿æ¥ä¸­...');
                        setTimeout(connectWallet, 1000);
                    }
                } catch (error) {
                    console.log('è‡ªåŠ¨è¿æ¥æ£€æŸ¥å¤±è´¥:', error);
                }
            }
        });

        // é’±åŒ…å˜åŒ–ç›‘å¬
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else if (accounts[0] !== currentAccount) {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }
    </script>
</body>
</html> 