# 🔧 区块链交易错误解决指南

## 📋 常见错误类型及解决方案

### 1. ⛽ Gas费用相关错误

#### 错误信息特征：
- `gasPrice`
- `maxFeePerGas`
- `gas limit exceeded`
- `insufficient funds for gas`

#### 🔧 解决方案：
1. **检查ALV余额**
   ```bash
   # 运行修复脚本检查余额
   node simple-transaction-fix.js
   ```

2. **优化Gas设置**
   - 游戏已自动优化Gas费用（增加10%缓冲）
   - MAO游戏：Gas限制 300,000
   - PI游戏：Gas限制 500,000
   - 授权交易：Gas限制 100,000

3. **推荐ALV余额**
   - 最低：0.01 ALV
   - 推荐：0.1 ALV
   - 安全：1 ALV

### 2. 🔐 授权相关错误

#### 错误信息特征：
- `allowance`
- `ERC20: insufficient allowance`
- `approve`

#### 🔧 解决方案：
1. **自动修复授权**
   ```bash
   node simple-transaction-fix.js
   ```

2. **手动重新授权**
   - 在游戏界面点击"授权"按钮
   - 在钱包中确认授权交易
   - 授权额度设置为最大值

### 3. 🌐 网络连接错误

#### 错误信息特征：
- `network error`
- `connection timeout`
- `RPC error`

#### 🔧 解决方案：
1. **多RPC节点自动切换**
   - 系统已配置3个RPC节点
   - 自动故障转移
   - 节点列表：
     - `https://elves-core2.alvey.io/`
     - `https://elves-core3.alvey.io/`
     - `https://elves-core1.alvey.io/`

2. **手动切换网络**
   - 断开钱包连接
   - 重新连接钱包
   - 刷新页面

### 4. 🔢 Nonce错误

#### 错误信息特征：
- `nonce too low`
- `nonce too high`
- `transaction nonce`

#### 🔧 解决方案：
1. **重置钱包**
   - 在MetaMask中：设置 → 高级 → 重置账户
   - 清除待处理交易

2. **等待网络同步**
   - 等待1-2分钟
   - 刷新页面重试

### 5. 👤 用户操作错误

#### 错误信息特征：
- `user rejected`
- `user denied`
- `transaction cancelled`

#### 🔧 解决方案：
1. **确认交易**
   - 在钱包中点击"确认"
   - 检查交易详情
   - 确保Gas费用合理

2. **检查网络**
   - 确保钱包连接到AlveyChain
   - Chain ID: 3797

## 🛠️ 自动修复工具

### 运行修复脚本
```bash
# 检查并修复所有常见问题
node simple-transaction-fix.js
```

### 修复内容
- ✅ 网络连接优化
- ✅ Gas费用优化
- ✅ 代币授权修复
- ✅ 错误处理改进

## 📊 系统状态检查

### 检查项目
1. **ALV余额** - 支付Gas费用
2. **MAO余额** - 游戏投注
3. **PI余额** - 游戏投注
4. **授权状态** - 代币使用权限
5. **网络连接** - RPC节点状态

### 正常状态指标
- ALV余额 > 0.01
- 代币授权 > 1,000,000
- 网络连接稳定
- 合约地址正确

## 🎮 游戏配置信息

### 合约地址
- **游戏合约**: `0xA9E4FD96B29e4f512a0a75E402C156B04D6E6c35`
- **MAO代币**: `0x22f49bcb3dad370a9268ba3fca33cb037ca3d022`
- **PI代币**: `0xfd4680e25e05b3435c7f698668d1ce80d2a9f444`

### 网络配置
- **网络名称**: AlveyChain Mainnet
- **Chain ID**: 3797
- **RPC URL**: https://elves-core2.alvey.io/
- **区块浏览器**: https://alveyscan.com/

### 游戏参数
- **MAO投注**: 100 MAO
- **PI投注**: 1,000 PI
- **中奖概率**: 50%
- **奖励等级**: 6级

## 🚨 紧急情况处理

### 如果游戏完全无法使用
1. **立即检查**
   ```bash
   node simple-transaction-fix.js
   ```

2. **备用方案**
   - 刷新页面
   - 重新连接钱包
   - 切换浏览器
   - 清除缓存

3. **联系支持**
   - 提供错误截图
   - 说明操作步骤
   - 提供钱包地址

## 💡 预防措施

### 日常维护
1. **保持充足余额**
   - ALV余额 > 0.1
   - 定期检查余额

2. **定期授权检查**
   - 每周运行一次修复脚本
   - 监控授权状态

3. **网络监控**
   - 关注网络状态
   - 避免网络拥堵时游戏

### 最佳实践
1. **交易前检查**
   - 确认网络连接
   - 检查余额充足
   - 验证授权状态

2. **错误处理**
   - 记录错误信息
   - 尝试自动修复
   - 必要时手动处理

3. **安全意识**
   - 保护私钥安全
   - 使用官方RPC节点
   - 定期更新钱包

## 📞 技术支持

### 常用命令
```bash
# 检查系统状态
node simple-transaction-fix.js

# 启动本地测试
python3 -m http.server 8000

# 查看日志
tail -f auto-reward.log
```

### 故障排除清单
- [ ] ALV余额充足
- [ ] 代币授权正常
- [ ] 网络连接稳定
- [ ] 合约地址正确
- [ ] 钱包网络匹配
- [ ] 浏览器兼容性

---

🎯 **记住**: 大多数交易错误都可以通过运行 `node simple-transaction-fix.js` 自动修复！ 