<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•ä½™é¢æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body style="padding: 20px; font-family: Arial, sans-serif;">
    <h1>ğŸ” è¶…çº§ç®€å•çš„ä½™é¢æµ‹è¯•</h1>
    
    <button onclick="connectAndGetBalance()" style="padding: 10px 20px; font-size: 16px; margin: 10px;">
        è¿æ¥é’±åŒ…å¹¶è·å–ä½™é¢
    </button>
    
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;"></div>

    <script>
        // åˆçº¦åœ°å€ - å°±è¿™ä¹ˆç®€å•
        const MAO_TOKEN = "0x22f49bcb3dad370a9268ba3fca33cb037ca3d022";
        const PI_TOKEN = "0xfd4680e25e05b3435c7f698668d1ce80d2a9f444";
        
        // ERC20 ABI - åªéœ€è¦ balanceOf
        const ERC20_ABI = [
            "function balanceOf(address owner) view returns (uint256)"
        ];

        async function connectAndGetBalance() {
            const resultDiv = document.getElementById('result');
            
            try {
                resultDiv.innerHTML = 'ğŸ”„ è¿æ¥é’±åŒ…ä¸­...';
                
                // 1. è¿æ¥é’±åŒ…
                if (!window.ethereum) {
                    resultDiv.innerHTML = 'âŒ è¯·ä½¿ç”¨Web3é’±åŒ…æµè§ˆå™¨ï¼ˆå¦‚TPé’±åŒ…ï¼‰';
                    return;
                }
                
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                if (accounts.length === 0) {
                    resultDiv.innerHTML = 'âŒ æœªè·å¾—é’±åŒ…æˆæƒ';
                    return;
                }
                
                const userAddress = accounts[0];
                resultDiv.innerHTML = `âœ… é’±åŒ…è¿æ¥æˆåŠŸ: ${userAddress}<br>ğŸ” æ­£åœ¨æŸ¥è¯¢ä½™é¢...`;
                
                // 2. åˆ›å»ºproviderå’Œåˆçº¦å®ä¾‹
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const maoContract = new ethers.Contract(MAO_TOKEN, ERC20_ABI, provider);
                const piContract = new ethers.Contract(PI_TOKEN, ERC20_ABI, provider);
                
                // 3. è°ƒç”¨balanceOf - å°±è¿™ä¹ˆç®€å•ï¼
                const maoBalanceWei = await maoContract.balanceOf(userAddress);
                const piBalanceWei = await piContract.balanceOf(userAddress);
                
                // 4. æ ¼å¼åŒ–æ˜¾ç¤º - æ¢å¤18ä½å°æ•°
                const maoBalance = ethers.utils.formatUnits(maoBalanceWei, 18);
                const piBalance = ethers.utils.formatUnits(piBalanceWei, 18);
                
                // 5. æ˜¾ç¤ºç»“æœ
                resultDiv.innerHTML = `
                    <h3>âœ… ä½™é¢æŸ¥è¯¢æˆåŠŸï¼</h3>
                    <p><strong>é’±åŒ…åœ°å€:</strong> ${userAddress}</p>
                    <p><strong>MAOä½™é¢:</strong> ${parseFloat(maoBalance).toLocaleString()} MAO</p>
                    <p><strong>PIä½™é¢:</strong> ${parseFloat(piBalance).toLocaleString()} PI</p>
                    <hr>
                    <p><strong>åŸå§‹æ•°æ®:</strong></p>
                    <p>MAO Wei: ${maoBalanceWei.toString()}</p>
                    <p>PI Wei: ${piBalanceWei.toString()}</p>
                    <hr>
                    <p>ğŸ‰ å°±æ˜¯è¿™ä¹ˆç®€å•ï¼åªéœ€è¦è°ƒç”¨åˆçº¦çš„ balanceOf å‡½æ•°ï¼</p>
                `;
                
            } catch (error) {
                console.error('é”™è¯¯:', error);
                resultDiv.innerHTML = `âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html> 