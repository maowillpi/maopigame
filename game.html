<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ° MAOè½¬ç›˜æ¸¸æˆ - AlveyChain åŒºå—é“¾æ¸¸æˆ</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ethers.js CDN - ä½¿ç”¨æ›´ç¨³å®šçš„ç‰ˆæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <style>
        body {
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        .wheel-animation {
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .bounce-animation {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -30px, 0); }
            70% { transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        .bg-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ä¸“ä¸šè½¬ç›˜è®¾è®¡ */
        .professional-wheel {
            background: conic-gradient(
                from 0deg,
                #1e3a8a 0deg 60deg,
                #fbbf24 60deg 120deg,
                #dc2626 120deg 180deg,
                #7c3aed 180deg 240deg,
                #059669 240deg 300deg,
                #ea580c 300deg 360deg
            );
            border: 6px solid #ffd700;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.3),
                0 0 60px rgba(255, 215, 0, 0.3);
            position: relative;
        }
        
        .professional-wheel::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 1;
        }
        
        /* MAO Logo è®¾è®¡ */
        .mao-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8, #1e40af);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: white;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.5),
                0 0 10px rgba(59, 130, 246, 0.5);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2),
                0 0 20px rgba(59, 130, 246, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 15;
        }
        
        .mao-logo::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 15px;
            z-index: -1;
        }
        
        /* è½¬ç›˜åŒºåŸŸå¢å¼º */
        .wheel-section {
            position: absolute;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 5;
        }
        
        .wheel-section .emoji {
            font-size: 32px;
            margin-bottom: 4px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .wheel-section .reward-badge {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 12px;
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        /* ä¸“ä¸šæŒ‡é’ˆè®¾è®¡ */
        .professional-pointer {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
        }
        
        .professional-pointer::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid #ffd700;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }
        
        .professional-pointer::after {
            content: '';
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 16px;
            background: #ffd700;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        }
        
        /* è½¬ç›˜åˆ†å‰²çº¿ä¼˜åŒ– */
        .wheel-divider {
            position: absolute;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            height: 2px;
            transform-origin: center;
            z-index: 3;
        }
        
        /* å¤šäººäº’åŠ¨åŠŸèƒ½æ ·å¼ */
        .multiplayer-panel {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .online-indicator {
            animation: pulse-green 2s infinite;
        }
        
        @keyframes pulse-green {
            0%, 100% { opacity: 1; box-shadow: 0 0 5px #10b981; }
            50% { opacity: 0.7; box-shadow: 0 0 15px #10b981; }
        }
        
        .chat-message {
            animation: slideInFromRight 0.5s ease-out;
        }
        
        @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .recent-win {
            animation: goldGlow 2s ease-in-out;
        }
        
        @keyframes goldGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
        }
        
        .leaderboard-item {
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateX(5px);
        }
        
        .nickname-badge {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient min-h-screen">
    
    <!-- å¤´éƒ¨ -->
    <div class="glass-effect sticky top-0 z-50 px-4 py-3 text-center">
        <h1 class="text-xl font-bold text-white">ğŸ° MAOè½¬ç›˜æ¸¸æˆ</h1>
        <p class="text-xs text-blue-200">AlveyChain åŒºå—é“¾æ¸¸æˆ</p>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="px-4 py-4 space-y-4 pb-20" id="app">
        
        <!-- è¿æ¥é’±åŒ…ç•Œé¢ -->
        <div id="walletConnect" class="text-center space-y-6">
            <div class="glass-effect rounded-2xl p-6">
                <div class="text-6xl mb-4 bounce-animation">ğŸ°</div>
                <h2 class="text-2xl font-bold text-white mb-3">æ¬¢è¿æ¥åˆ°MAOè½¬ç›˜</h2>
                <p class="text-blue-200 text-sm mb-6">è¿æ¥æ‚¨çš„é’±åŒ…å¼€å§‹è½¬ç›˜ä¹‹æ—…</p>
                <button 
                    id="connectBtn" 
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
                >
                    ğŸ”— è¿æ¥é’±åŒ…å¼€å§‹æ¸¸æˆ
                </button>
            </div>
            
            <!-- å¥–åŠ±é¢„è§ˆ - æ–°å¥–åŠ±æ–¹æ¡ˆ -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ’° å…¨æ–°å¥–åŠ±æ–¹æ¡ˆ - 40%ä¸­å¥–ç‡ï¼</h3>
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ’«</div>
                        <div class="text-yellow-400 font-bold">å®‰æ…°å¥– 60%</div>
                        <div class="text-white text-xs">50 MAO</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ</div>
                        <div class="text-yellow-400 font-bold">å°å¥– 20%</div>
                        <div class="text-white text-xs">200 MAO</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ†</div>
                        <div class="text-yellow-400 font-bold">ä¸­å¥– 12%</div>
                        <div class="text-white text-xs">500 MAO</div>
                    </div>
                    <div class="glass-effect rounded-lg p-3 text-center">
                        <div class="text-2xl mb-1">ğŸ’°</div>
                        <div class="text-yellow-400 font-bold">ç»ˆæå¤§å¥–</div>
                        <div class="text-white text-xs">5,000 MAO</div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <p class="text-xs text-green-300">
                        ğŸ‰ ä¸­å¥–ç‡ä»15%æå‡åˆ°40%ï¼æœ€é«˜å¥–åŠ±50å€ï¼
                    </p>
                </div>
            </div>

            <!-- æ¸¸æˆè¯´æ˜ - æ–°å¥–åŠ±æ–¹æ¡ˆ -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ“– æ¸¸æˆè¯´æ˜</h3>
                <ul class="text-blue-200 text-sm space-y-2">
                    <li>â€¢ æ¯æ¬¡æ¸¸æˆæ¶ˆè€— 100 MAO æˆ– 1,000 PI</li>
                    <li>â€¢ å…¨æ–°6çº§å¥–åŠ±ç³»ç»Ÿï¼Œ40%æ€»ä¸­å¥–ç‡</li>
                    <li>â€¢ æœ€é«˜å¥–åŠ±æå‡è‡³50å€ï¼ˆ5,000 MAO / 50,000 PIï¼‰</li>
                    <li>â€¢ åŸºäºAlveyChainæ™ºèƒ½åˆçº¦ï¼Œå…¬å¹³é€æ˜</li>
                    <li>â€¢ æ”¯æŒTPé’±åŒ…ã€Trust Walletç­‰ä¸»æµé’±åŒ…</li>
                    <li>â€¢ å¥–åŠ±è‡ªåŠ¨è½¬è´¦ï¼Œå³æ—¶åˆ°è´¦</li>
                </ul>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameInterface" class="space-y-4" style="display: none;">
            
            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <div class="glass-effect rounded-xl p-4">
                <div class="flex justify-between items-center mb-3">
                    <div>
                        <p class="text-blue-200 text-xs">é’±åŒ…åœ°å€</p>
                        <p class="text-white text-sm font-mono" id="userAddress">æœªè¿æ¥</p>
                    </div>
                    <div class="text-right">
                        <p class="text-blue-200 text-xs">å½“å‰ä½™é¢</p>
                        <p class="text-white font-bold text-lg" id="userBalance">0 MAO</p>
                    </div>
                </div>
                
                <!-- ä½™é¢æµ‹è¯•æŒ‰é’® -->
                <button 
                    id="testBalanceBtn"
                    class="w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-all duration-200"
                    onclick="testBalance()"
                    style="display: none;"
                >
                    ğŸ” æµ‹è¯•ä½™é¢éªŒè¯
                </button>
            </div>

            <!-- ä»£å¸é€‰æ‹© -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">é€‰æ‹©æ¸¸æˆä»£å¸</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button 
                        id="maoBtn" 
                        class="token-btn py-4 px-4 rounded-xl font-semibold transition-all bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg scale-105"
                        data-token="MAO"
                    >
                        <div class="text-lg">MAO</div>
                        <div class="text-xs mt-1">100 MAO/æ¬¡</div>
                        <div class="text-xs text-yellow-400" id="maoBalance">ä½™é¢: 0</div>
                        <div class="text-xs text-green-400 mt-1">âœ… ç¨³å®šè¿è¡Œ</div>
                    </button>
                    <button 
                        id="piBtn" 
                        class="token-btn py-4 px-4 rounded-xl font-semibold transition-all bg-white/20 text-blue-200 hover:bg-white/30"
                        data-token="PI"
                    >
                        <div class="text-lg">PI</div>
                        <div class="text-xs mt-1">1,000 PI/æ¬¡</div>
                        <div class="text-xs text-yellow-400" id="piBalance">ä½™é¢: 0</div>
                        <div class="text-xs text-orange-400 mt-1">âš ï¸ å¥–æ± æ£€æŸ¥ä¸­</div>
                    </button>
                </div>
                <div class="mt-3 text-center">
                    <p class="text-xs text-blue-300">
                        ğŸ’¡ å»ºè®®ä¼˜å…ˆé€‰æ‹©MAOæ¸¸æˆï¼ŒPIæ¸¸æˆå¯èƒ½å› å¥–æ± é—®é¢˜æš‚æ—¶ä¸å¯ç”¨
                    </p>
                </div>
            </div>

            <!-- è½¬ç›˜æ¸¸æˆ -->
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-white font-bold text-center mb-4 text-lg">ğŸ° å¹¸è¿è½¬ç›˜</h3>
                
                <!-- ä¸“ä¸šè½¬ç›˜è®¾è®¡ -->
                <div class="flex justify-center mb-4">
                    <div class="relative">
                        <div 
                            id="wheel"
                            class="w-80 h-80 rounded-full professional-wheel wheel-animation shadow-2xl relative overflow-hidden"
                        >
                            <!-- è½¬ç›˜å¥–é¡¹åŒºåŸŸ - ä¸“ä¸šè®¾è®¡ -->
                            <!-- åŒºåŸŸ1: å†è¯•ä¸€æ¬¡ (0-60åº¦) -->
                            <div class="wheel-section absolute top-6 left-1/2 transform -translate-x-1/2 text-center">
                                <div class="emoji">ğŸ’«</div>
                                <div class="text-sm font-bold mb-1">å†è¯•ä¸€æ¬¡</div>
                                <div class="reward-badge" id="reward0">50</div>
                            </div>
                            
                            <!-- åŒºåŸŸ2: å°å¥– (60-120åº¦) -->
                            <div class="wheel-section absolute top-12 right-6 transform text-center">
                                <div class="emoji">ğŸ</div>
                                <div class="text-sm font-bold mb-1">å°å¥–</div>
                                <div class="reward-badge" id="reward1">200</div>
                            </div>
                            
                            <!-- åŒºåŸŸ3: ä¸­å¥– (120-180åº¦) -->
                            <div class="wheel-section absolute bottom-12 right-6 transform text-center">
                                <div class="emoji">ğŸ†</div>
                                <div class="text-sm font-bold mb-1">ä¸­å¥–</div>
                                <div class="reward-badge" id="reward2">500</div>
                            </div>
                            
                            <!-- åŒºåŸŸ4: å¤§å¥– (180-240åº¦) -->
                            <div class="wheel-section absolute bottom-6 left-1/2 transform -translate-x-1/2 text-center">
                                <div class="emoji">ğŸ’</div>
                                <div class="text-sm font-bold mb-1">å¤§å¥–</div>
                                <div class="reward-badge" id="reward3">1,200</div>
                            </div>
                            
                            <!-- åŒºåŸŸ5: è¶…çº§å¤§å¥– (240-300åº¦) -->
                            <div class="wheel-section absolute bottom-12 left-6 transform text-center">
                                <div class="emoji">ğŸŒŸ</div>
                                <div class="text-sm font-bold mb-1">è¶…çº§</div>
                                <div class="reward-badge" id="reward4">2,500</div>
                            </div>
                            
                            <!-- åŒºåŸŸ6: ç»ˆæå¤§å¥– (300-360åº¦) -->
                            <div class="wheel-section absolute top-12 left-6 transform text-center">
                                <div class="emoji">ğŸ’°</div>
                                <div class="text-sm font-bold mb-1">ç»ˆæ</div>
                                <div class="reward-badge" id="reward5">5,000</div>
                            </div>
                            
                            <!-- ä¸“ä¸šåˆ†å‰²çº¿ -->
                            <div class="wheel-divider top-0 left-1/2 w-full transform -translate-x-1/2"></div>
                            <div class="wheel-divider top-1/2 left-0 w-full transform -translate-y-1/2 rotate-60"></div>
                            <div class="wheel-divider top-1/2 left-0 w-full transform -translate-y-1/2 rotate-120"></div>
                            
                            <!-- MAO Logo ä¸­å¿ƒ -->
                            <div class="mao-logo">
                                M
                            </div>
                        </div>
                        
                        <!-- ä¸“ä¸šæŒ‡é’ˆ -->
                        <div class="professional-pointer"></div>
                        
                        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 translate-y-16 z-10">
                            <button
                                id="spinBtn"
                                class="w-28 h-28 rounded-full font-bold text-sm transition-all shadow-2xl bg-gradient-to-r from-yellow-500 via-yellow-600 to-orange-500 hover:from-yellow-600 hover:via-yellow-700 hover:to-orange-600 transform hover:scale-110 text-white border-4 border-white relative overflow-hidden"
                            >
                                <div class="relative z-10">
                                    <div class="text-3xl mb-1">ğŸ²</div>
                                    <div class="text-xs font-bold">å¼€å§‹æ¸¸æˆ</div>
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 animate-pulse"></div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ¸¸æˆçŠ¶æ€å’Œè¿ç»­æ¸¸æˆæ§åˆ¶ -->
                <div class="glass-effect rounded-lg p-3 mb-4">
                    <div class="text-center">
                        <p class="text-blue-200 text-sm mb-2">
                            æœ¬è½®æŠ•æ³¨: <span class="text-yellow-400 font-bold text-lg" id="betAmount">1,000 PI</span>
                        </p>
                        <div class="flex justify-center gap-3 mb-3">
                            <div class="text-center">
                                <div class="text-xs text-blue-300">æ¸¸æˆæ¬¡æ•°</div>
                                <div class="text-yellow-400 font-bold" id="gameCount">0</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-blue-300">æ€»æŠ•æ³¨</div>
                                <div class="text-yellow-400 font-bold" id="totalBet">0</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-blue-300">æ€»å¥–åŠ±</div>
                                <div class="text-green-400 font-bold" id="totalReward">0</div>
                            </div>
                        </div>
                        <div id="lastResult" class="hidden bg-black/30 rounded-lg p-3">
                            <p class="text-green-400 text-sm" id="resultText"></p>
                        </div>
                    </div>
                </div>

                <!-- å¥–åŠ±éªŒè¯åŒºåŸŸ -->
                <div class="glass-effect rounded-lg p-3 mb-4">
                    <h4 class="text-white font-semibold text-center mb-2 text-sm">ğŸ’° å¥–åŠ±è‡ªåŠ¨è½¬è´¦éªŒè¯</h4>
                    <div class="text-xs text-blue-200 text-center mb-2">
                        æ™ºèƒ½åˆçº¦å°†è‡ªåŠ¨å°†å¥–åŠ±è½¬å…¥æ‚¨çš„é’±åŒ…åœ°å€
                    </div>
                    <div class="flex justify-between text-xs">
                        <span class="text-blue-300">æ¸¸æˆå‰ä½™é¢:</span>
                        <span class="text-white" id="balanceBefore">-</span>
                    </div>
                    <div class="flex justify-between text-xs">
                        <span class="text-blue-300">æ¸¸æˆåä½™é¢:</span>
                        <span class="text-green-400" id="balanceAfter">-</span>
                    </div>
                    <div class="flex justify-between text-xs">
                        <span class="text-blue-300">å¥–åŠ±å·®é¢:</span>
                        <span class="text-yellow-400 font-bold" id="balanceDiff">-</span>
                    </div>
                </div>

                <!-- æˆæƒ/æ¸¸æˆæŒ‰é’® - ç§»é™¤è¿ç»­æ¸¸æˆåŠŸèƒ½ -->
                <div class="space-y-3">
                    <button
                        id="approveBtn"
                        class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-4 rounded-xl shadow-lg text-base"
                    >
                        ğŸ”“ æˆæƒ PI ä»£å¸
                    </button>
                    
                    <!-- å•ä¸ªæ¸¸æˆæŒ‰é’® -->
                    <button
                        id="startGameBtn" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-200 transform hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled
                    >
                        ğŸ® å¼€å§‹æ¸¸æˆ
                    </button>
                </div>
            </div>

            <!-- å¤šäººäº’åŠ¨åŠŸèƒ½ -->
            <div class="space-y-4">
                
                <!-- åœ¨çº¿çŠ¶æ€å’Œç©å®¶æ˜µç§° -->
                <div class="glass-effect rounded-xl p-4">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full online-indicator"></div>
                            <span class="text-white font-semibold">åœ¨çº¿çŠ¶æ€</span>
                            <span class="text-green-400 font-bold" id="onlineCount">42</span>
                            <span class="text-blue-200 text-sm">äººåœ¨çº¿</span>
                        </div>
                        <button id="setNicknameBtn" class="nickname-badge text-white text-xs px-3 py-1 rounded-full">
                            <span id="currentNickname">è®¾ç½®æ˜µç§°</span>
                        </button>
                    </div>
                    <div class="text-xs text-blue-200">
                        ğŸ® å½“å‰æ´»è·ƒç©å®¶: <span id="activePlayer" class="text-yellow-400">MAO***88</span> åˆšåˆšè·å¾—äº† <span class="text-green-400">2,500 MAO</span>ï¼
                    </div>
                </div>

                <!-- å®æ—¶æ’è¡Œæ¦œ -->
                <div class="glass-effect rounded-xl p-4">
                    <h3 class="text-white font-semibold mb-3 text-center flex items-center justify-center gap-2">
                        ğŸ† ä»Šæ—¥æ’è¡Œæ¦œ
                        <span class="text-xs text-blue-300">(å®æ—¶æ›´æ–°)</span>
                    </h3>
                    <div id="leaderboard" class="space-y-2">
                        <!-- æ’è¡Œæ¦œå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æœ€è¿‘ä¸­å¥–è®°å½• -->
                <div class="glass-effect rounded-xl p-4">
                    <h3 class="text-white font-semibold mb-3 text-center flex items-center justify-center gap-2">
                        âš¡ æœ€è¿‘ä¸­å¥–
                        <span class="text-xs text-blue-300">(æ¯5ç§’æ›´æ–°)</span>
                    </h3>
                    <div id="recentWins" class="space-y-2 max-h-40 overflow-y-auto">
                        <!-- æœ€è¿‘ä¸­å¥–è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- å®æ—¶èŠå¤© -->
                <div class="glass-effect rounded-xl p-4">
                    <h3 class="text-white font-semibold mb-3 text-center">ğŸ’¬ ç©å®¶èŠå¤©</h3>
                    <div id="chatMessages" class="space-y-2 max-h-32 overflow-y-auto mb-3">
                        <!-- èŠå¤©æ¶ˆæ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            id="chatInput" 
                            placeholder="è¾“å…¥æ¶ˆæ¯... (å›è½¦å‘é€)" 
                            maxlength="50"
                            class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm placeholder-blue-300 focus:outline-none focus:border-yellow-400"
                        >
                        <button 
                            id="sendChatBtn"
                            class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition-all"
                        >
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>

            <!-- æ¸¸æˆè®°å½• -->
            <div class="glass-effect rounded-xl p-4">
                <h3 class="text-white font-semibold mb-3 text-center">ğŸ® æ¸¸æˆè®°å½•</h3>
                <div id="gameHistory" class="text-center py-8">
                    <p class="text-blue-200">æš‚æ— æ¸¸æˆè®°å½•</p>
                    <p class="text-xs text-blue-300 mt-1">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡æ¸¸æˆå§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="fixed bottom-0 left-0 right-0 glass-effect p-3 text-center">
        <p class="text-blue-200 text-xs">
            åŸºäº AlveyChain æ™ºèƒ½åˆçº¦ Â· å…¬å¹³é€æ˜ Â· ç«‹å³åˆ°è´¦
        </p>
    </div>

    <!-- JavaScript -->
    <script>
        // ç­‰å¾…ethers.jsåŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            // æ£€æŸ¥ethersæ˜¯å¦æ­£ç¡®åŠ è½½
            if (typeof ethers === 'undefined') {
                console.error('ethers.jsæœªæ­£ç¡®åŠ è½½');
                alert('æ­£åœ¨åŠ è½½åŒºå—é“¾åº“ï¼Œè¯·ç¨å€™é‡è¯•...');
                setTimeout(() => location.reload(), 2000);
                return;
            }
            
            console.log('ethers.jsåŠ è½½æˆåŠŸ:', ethers.version);
        });

        // æ™ºèƒ½åˆçº¦é…ç½®
        const CONTRACTS = {
            WHEEL_GAME: "0xc27e29BCe41db77815435a9415329424849Daeb6",
            MAO_TOKEN: "0x22f49bcb3dad370a9268ba3fca33cb037ca3d022",
            PI_TOKEN: "0xfd4680e25e05b3435c7f698668d1ce80d2a9f444"
        };

        const ALVEY_NETWORK = {
            chainId: '0xED5',
            chainName: 'AlveyChain Mainnet',
            nativeCurrency: { name: 'ALV', symbol: 'ALV', decimals: 18 },
            rpcUrls: ['https://elves-core1.alvey.io'],
            blockExplorerUrls: ['https://alveyscan.com'],
        };

        const WHEEL_GAME_ABI = [
            "function playMAOGame() external",
            "function playPIGame() external",
            "event GamePlayed(address indexed player, uint8 tokenType, uint256 betAmount, uint256 rewardAmount, uint8 rewardLevel, uint256 randomSeed)"
        ];

        const ERC20_ABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)"
        ];

        const REWARDS = [
            { name: 'å†è¯•ä¸€æ¬¡', mao: 50, pi: 500, emoji: 'ğŸ’«' },        // 60% - å®‰æ…°å¥– 0.5å€
            { name: 'å°å¥–', mao: 200, pi: 2000, emoji: 'ğŸ' },          // 20% - å°å¥– 2å€  
            { name: 'ä¸­å¥–', mao: 500, pi: 5000, emoji: 'ğŸ†' },          // 12% - ä¸­å¥– 5å€
            { name: 'å¤§å¥–', mao: 1200, pi: 12000, emoji: 'ğŸ’' },        // 5% - å¤§å¥– 12å€
            { name: 'è¶…çº§å¤§å¥–', mao: 2500, pi: 25000, emoji: 'ğŸŒŸ' },    // 2.5% - è¶…çº§ 25å€
            { name: 'ç»ˆæå¤§å¥–', mao: 5000, pi: 50000, emoji: 'ğŸ’°' }     // 0.5% - ç»ˆæ 50å€
        ];

        // æ¸¸æˆçŠ¶æ€ - ç®€åŒ–ç‰ˆæœ¬ï¼ˆç§»é™¤è¿ç»­æ¸¸æˆï¼‰
        let currentAccount = null;
        let provider = null;
        let signer = null;
        let contracts = {};
        let selectedToken = 'MAO';
        let isSpinning = false;
        let isApproved = false;
        let balances = { MAO: '0', PI: '0' };
        let gameStats = { count: 0, totalBet: 0, totalReward: 0 };
        // å·²ç§»é™¤ï¼šisContinuousMode - å–æ¶ˆè¿ç»­æ¸¸æˆåŠŸèƒ½

        // DOM å…ƒç´ ï¼ˆç§»é™¤è¿ç»­æ¸¸æˆï¼‰
        const connectBtn = document.getElementById('connectBtn');
        const walletConnect = document.getElementById('walletConnect');
        const gameInterface = document.getElementById('gameInterface');
        const spinBtn = document.getElementById('spinBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        // å·²ç§»é™¤ï¼šcontinuousBtn - å–æ¶ˆè¿ç»­æ¸¸æˆåŠŸèƒ½
        const approveBtn = document.getElementById('approveBtn');
        const wheel = document.getElementById('wheel');
        const userAddress = document.getElementById('userAddress');
        const userBalance = document.getElementById('userBalance');
        const maoBalance = document.getElementById('maoBalance');
        const piBalance = document.getElementById('piBalance');
        const betAmount = document.getElementById('betAmount');
        const lastResult = document.getElementById('lastResult');
        const resultText = document.getElementById('resultText');
        const maoBtn = document.getElementById('maoBtn');
        const piBtn = document.getElementById('piBtn');
        const testBalanceBtn = document.getElementById('testBalanceBtn');

        // æ–°å¢æ¸¸æˆç»Ÿè®¡å…ƒç´ 
        const gameCount = document.getElementById('gameCount');
        const totalBet = document.getElementById('totalBet');
        const totalReward = document.getElementById('totalReward');
        const balanceBefore = document.getElementById('balanceBefore');
        const balanceAfter = document.getElementById('balanceAfter');
        const balanceDiff = document.getElementById('balanceDiff');

        // è½¬ç›˜å¥–åŠ±æ˜¾ç¤ºå…ƒç´ 
        const reward0 = document.getElementById('reward0');
        const reward1 = document.getElementById('reward1');
        const reward2 = document.getElementById('reward2');
        const reward3 = document.getElementById('reward3');
        const reward4 = document.getElementById('reward4');
        const reward5 = document.getElementById('reward5');

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                // æ£€æŸ¥ethersæ˜¯å¦åŠ è½½
                if (typeof ethers === 'undefined') {
                    alert('åŒºå—é“¾åº“æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨å€™é‡è¯•...');
                    setTimeout(() => location.reload(), 2000);
                    return;
                }

                if (!window.ethereum) {
                    alert('è¯·ä½¿ç”¨æ”¯æŒWeb3çš„é’±åŒ…æµè§ˆå™¨ï¼\næ¨èä½¿ç”¨ï¼šTPé’±åŒ…ã€Trust Walletã€MetaMaskç­‰');
                    return;
                }

                connectBtn.textContent = 'è¿æ¥ä¸­...';
                connectBtn.disabled = true;

                // æ£€æŸ¥å¹¶åˆ‡æ¢ç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== ALVEY_NETWORK.chainId) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: ALVEY_NETWORK.chainId }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [ALVEY_NETWORK],
                            });
                        }
                    }
                }

                // è¯·æ±‚è´¦æˆ·è¿æ¥
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts',
                });

                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();

                    // åˆå§‹åŒ–åˆçº¦
                    contracts.wheelGame = new ethers.Contract(CONTRACTS.WHEEL_GAME, WHEEL_GAME_ABI, signer);
                    contracts.maoToken = new ethers.Contract(CONTRACTS.MAO_TOKEN, ERC20_ABI, signer);
                    contracts.piToken = new ethers.Contract(CONTRACTS.PI_TOKEN, ERC20_ABI, signer);

                    // æ›´æ–°ç•Œé¢
                    userAddress.textContent = currentAccount.slice(0, 6) + '...' + currentAccount.slice(-4);
                    
                    // åŠ è½½ä½™é¢
                    await loadBalances();
                    await checkApproval();
                    updateWheelRewards();

                    // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
                    walletConnect.style.display = 'none';
                    gameInterface.style.display = 'block';
                    
                    // æ˜¾ç¤ºä½™é¢æµ‹è¯•æŒ‰é’®
                    testBalanceBtn.style.display = 'block';
                }
            } catch (error) {
                console.error('è¿æ¥é’±åŒ…é”™è¯¯:', error);
                alert('è¿æ¥é’±åŒ…å¤±è´¥: ' + error.message);
                connectBtn.textContent = 'ğŸ”— è¿æ¥é’±åŒ…å¼€å§‹æ¸¸æˆ';
                connectBtn.disabled = false;
            }
        }

        // åŠ è½½ä½™é¢
        async function loadBalances() {
            try {
                const [maoBalanceWei, piBalanceWei] = await Promise.all([
                    contracts.maoToken.balanceOf(currentAccount),
                    contracts.piToken.balanceOf(currentAccount)
                ]);

                balances.MAO = ethers.utils.formatEther(maoBalanceWei);
                balances.PI = ethers.utils.formatEther(piBalanceWei);

                maoBalance.textContent = `ä½™é¢: ${parseFloat(balances.MAO).toFixed(2)}`;
                piBalance.textContent = `ä½™é¢: ${parseFloat(balances.PI).toFixed(2)}`;
                
                updateCurrentBalance();
            } catch (error) {
                console.error('åŠ è½½ä½™é¢é”™è¯¯:', error);
            }
        }

        // æ›´æ–°å½“å‰ä½™é¢æ˜¾ç¤º
        function updateCurrentBalance() {
            userBalance.textContent = `${parseFloat(balances[selectedToken]).toFixed(2)} ${selectedToken}`;
        }

        // æ›´æ–°è½¬ç›˜å¥–åŠ±æ˜¾ç¤º - æ–°å¥–åŠ±æ–¹æ¡ˆ
        function updateWheelRewards() {
            if (selectedToken === 'MAO') {
                reward0.textContent = '50';      // å®‰æ…°å¥–
                reward1.textContent = '200';     // å°å¥–
                reward2.textContent = '500';     // ä¸­å¥–
                reward3.textContent = '1,200';   // å¤§å¥–
                reward4.textContent = '2,500';   // è¶…çº§å¤§å¥–
                reward5.textContent = '5,000';   // ç»ˆæå¤§å¥–
            } else {
                reward0.textContent = '500';     // å®‰æ…°å¥–
                reward1.textContent = '2K';      // å°å¥–
                reward2.textContent = '5K';      // ä¸­å¥–
                reward3.textContent = '12K';     // å¤§å¥–
                reward4.textContent = '25K';     // è¶…çº§å¤§å¥–
                reward5.textContent = '50K';     // ç»ˆæå¤§å¥–
            }
        }

        // æ›´æ–°æ¸¸æˆç»Ÿè®¡
        function updateGameStats() {
            gameCount.textContent = gameStats.count;
            totalBet.textContent = `${gameStats.totalBet} ${selectedToken}`;
            totalReward.textContent = `${gameStats.totalReward} ${selectedToken}`;
        }

        // æ£€æŸ¥æˆæƒçŠ¶æ€
        async function checkApproval() {
            try {
                const tokenContract = selectedToken === 'MAO' ? contracts.maoToken : contracts.piToken;
                const allowance = await tokenContract.allowance(currentAccount, CONTRACTS.WHEEL_GAME);
                const required = ethers.utils.parseEther(selectedToken === 'MAO' ? '1000' : '10000');
                
                isApproved = allowance.gte(required);
                updateApproveButton();
            } catch (error) {
                console.error('æ£€æŸ¥æˆæƒé”™è¯¯:', error);
            }
        }

        // æ›´æ–°æˆæƒæŒ‰é’® - å¢å¼ºç‰ˆæœ¬ï¼ˆç§»é™¤è¿ç»­æ¸¸æˆï¼‰
        function updateApproveButton() {
            // é‡ç½®æˆæƒæŒ‰é’®çŠ¶æ€
            approveBtn.disabled = false;
            
            if (isApproved) {
                approveBtn.style.display = 'none';
                startGameBtn.disabled = false;
                spinBtn.disabled = false;
                spinBtn.innerHTML = '<div class="text-2xl">ğŸ²</div><div class="text-[10px]">å¼€å§‹æ¸¸æˆ</div>';
                startGameBtn.textContent = 'ğŸ® å¼€å§‹æ¸¸æˆ';
                
                console.log(`${selectedToken} æˆæƒçŠ¶æ€ï¼šå·²æˆæƒï¼Œæ¸¸æˆå¯ç”¨`);
            } else {
                approveBtn.style.display = 'block';
                approveBtn.textContent = `ğŸ”“ æˆæƒ ${selectedToken} ä»£å¸`;
                startGameBtn.disabled = true;
                spinBtn.disabled = true;
                spinBtn.innerHTML = '<div class="text-2xl">ğŸ”’</div><div class="text-[10px]">éœ€è¦æˆæƒ</div>';
                startGameBtn.textContent = `ğŸ”’ éœ€å…ˆæˆæƒ${selectedToken}`;
                
                console.log(`${selectedToken} æˆæƒçŠ¶æ€ï¼šæœªæˆæƒï¼Œéœ€è¦æˆæƒ`);
            }
        }

        // æˆæƒä»£å¸
        async function approveTokens() {
            try {
                approveBtn.textContent = 'æˆæƒä¸­...';
                approveBtn.disabled = true;

                const tokenContract = selectedToken === 'MAO' ? contracts.maoToken : contracts.piToken;
                const tx = await tokenContract.approve(CONTRACTS.WHEEL_GAME, ethers.constants.MaxUint256);
                await tx.wait();

                isApproved = true;
                updateApproveButton();
                alert('ä»£å¸æˆæƒæˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹æ¸¸æˆäº†ã€‚');
            } catch (error) {
                console.error('æˆæƒé”™è¯¯:', error);
                alert('æˆæƒå¤±è´¥: ' + error.message);
                approveBtn.textContent = `ğŸ”“ æˆæƒ ${selectedToken} ä»£å¸`;
                approveBtn.disabled = false;
            }
        }

        // è®°å½•æ¸¸æˆå‰ä½™é¢
        async function recordBalanceBefore() {
            const currentBalance = parseFloat(balances[selectedToken]);
            balanceBefore.textContent = `${currentBalance.toFixed(2)} ${selectedToken}`;
            return currentBalance;
        }

        // è®°å½•æ¸¸æˆåä½™é¢å¹¶æ˜¾ç¤ºå·®é¢
        async function recordBalanceAfter(beforeBalance) {
            await loadBalances();
            const afterBalance = parseFloat(balances[selectedToken]);
            const diff = afterBalance - beforeBalance;
            
            balanceAfter.textContent = `${afterBalance.toFixed(2)} ${selectedToken}`;
            balanceDiff.textContent = diff > 0 ? `+${diff.toFixed(2)} ${selectedToken}` : `${diff.toFixed(2)} ${selectedToken}`;
            
            return diff;
        }

        // å¼€å§‹æ¸¸æˆ - ç®€åŒ–ç¨³å®šç‰ˆæœ¬
        async function startGame() {
            if (isSpinning || !isApproved) {
                if (!isApproved) {
                    alert('è¯·å…ˆæˆæƒä»£å¸ï¼');
                }
                return;
            }

            try {
                // å…ˆåˆ·æ–°ä½™é¢ï¼Œç¡®ä¿æ˜¯æœ€æ–°çš„
                await loadBalances();
                
                // æ£€æŸ¥ä½™é¢
                const required = selectedToken === 'MAO' ? 100 : 1000;
                const currentBalance = parseFloat(balances[selectedToken]) || 0;
                
                console.log(`æ£€æŸ¥ä½™é¢: ${currentBalance} ${selectedToken}, éœ€è¦: ${required} ${selectedToken}`);
                
                if (currentBalance < required) {
                    alert(`âŒ ä½™é¢ä¸è¶³ï¼\n\nå½“å‰ä½™é¢: ${currentBalance.toFixed(2)} ${selectedToken}\néœ€è¦ä½™é¢: ${required} ${selectedToken}\n\nè¯·å…ˆå……å€¼è¶³å¤Ÿçš„${selectedToken}ä»£å¸åˆ°æ‚¨çš„é’±åŒ…ï¼`);
                    return;
                }

                isSpinning = true;
                
                // è®°å½•æ¸¸æˆå‰ä½™é¢
                const beforeBalance = await recordBalanceBefore();
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                spinBtn.innerHTML = '<div class="animate-spin text-2xl">ğŸ°</div><div class="text-[10px]">è½¬åŠ¨ä¸­</div>';
                spinBtn.disabled = true;
                startGameBtn.textContent = 'ğŸ° è½¬ç›˜è¿è¡Œä¸­...';
                startGameBtn.disabled = true;
                // å·²ç§»é™¤è¿ç»­æ¸¸æˆæ¨¡å¼ï¼Œæ­¤éƒ¨åˆ†ä¸å†æ‰§è¡Œ

                // å¼€å§‹è½¬ç›˜åŠ¨ç”» - ç®€å•ç‰ˆæœ¬
                const randomSpins = 1800 + Math.random() * 720; // 5-7åœˆ
                wheel.style.transition = 'transform 4s cubic-bezier(0.23, 1, 0.32, 1)';
                wheel.style.transform = `rotate(${randomSpins}deg)`;

                // è°ƒç”¨æ™ºèƒ½åˆçº¦
                const gameFunction = selectedToken === 'MAO' ? 'playMAOGame' : 'playPIGame';
                const gasLimit = selectedToken === 'PI' ? 500000 : 300000;
                
                let tx;
                try {
                    tx = await contracts.wheelGame[gameFunction]({ gasLimit });
                } catch (gasError) {
                    console.error('Gasä¼°ç®—é”™è¯¯:', gasError);
                    
                    let errorMsg = 'æ¸¸æˆè°ƒç”¨å¤±è´¥';
                    if (selectedToken === 'PI' && gasError.message.includes('prize pool')) {
                        errorMsg = 'PIæ¸¸æˆå¥–æ± ä¸è¶³ï¼Œè¯·é€‰æ‹©MAOæ¸¸æˆ';
                    } else if (gasError.message.includes('insufficient funds')) {
                        errorMsg = 'è´¦æˆ·ALVä½™é¢ä¸è¶³æ”¯ä»˜gasè´¹ç”¨';
                    } else if (gasError.message.includes('allowance')) {
                        errorMsg = 'ä»£å¸æˆæƒä¸è¶³ï¼Œè¯·é‡æ–°æˆæƒ';
                        isApproved = false;
                        updateApproveButton();
                    }
                    
                    alert('âŒ ' + errorMsg);
                    resetGameButtons();
                    return;
                }
                
                const receipt = await tx.wait();

                // è§£æç»“æœ
                let rewardLevel = 0;
                for (const log of receipt.logs) {
                    try {
                        const parsed = contracts.wheelGame.interface.parseLog(log);
                        if (parsed.name === 'GamePlayed') {
                            rewardLevel = parsed.args.rewardLevel.toNumber();
                            break;
                        }
                    } catch (e) {}
                }

                // è°ƒæ•´è½¬ç›˜åˆ°æœ€ç»ˆä½ç½®
                const finalAngle = rewardLevel * 60;
                const finalRotation = randomSpins - (randomSpins % 360) + finalAngle;
                wheel.style.transform = `rotate(${finalRotation}deg)`;

                // æ˜¾ç¤ºç»“æœ
                setTimeout(async () => {
                    const reward = REWARDS[rewardLevel];
                    const amount = selectedToken === 'MAO' ? reward.mao : reward.pi;
                    
                    // æ›´æ–°æ¸¸æˆç»Ÿè®¡
                    gameStats.count++;
                    gameStats.totalBet += required;
                    gameStats.totalReward += amount;
                    updateGameStats();

                    // è®°å½•æ¸¸æˆåä½™é¢
                    const balanceDiff = await recordBalanceAfter(beforeBalance);
                    
                    resultText.textContent = `${reward.emoji} ç»“æœ: ${reward.name}`;
                    if (amount > 0) {
                        resultText.textContent += ` (+${amount} ${selectedToken})`;
                        alert(`ğŸ‰ æ­å–œï¼è·å¾— ${reward.name}ï¼\nå¥–åŠ±: ${amount} ${selectedToken}\nâœ… å¥–åŠ±å·²è‡ªåŠ¨è½¬å…¥æ‚¨çš„é’±åŒ…ï¼`);
                        
                        // æ·»åŠ åˆ°å¤šäººäº’åŠ¨ç³»ç»Ÿ
                        if (typeof addRecentWin === 'function' && multiplayerData && multiplayerData.nickname) {
                            setTimeout(() => {
                                addRecentWin(multiplayerData.nickname, amount, selectedToken, true);
                            }, 500);
                        }
                        
                        // æ·»åŠ èƒœåˆ©èŠå¤©æ¶ˆæ¯
                        if (typeof addChatMessage === 'function' && multiplayerData && multiplayerData.nickname) {
                            const levelMessages = {
                                0: 'å°å°æ”¶è·ä¹Ÿæ˜¯å¥½è¿æ°”ï¼ğŸ’«',
                                1: 'ä¸é”™çš„æ‰‹æ°”ï¼ğŸ',
                                2: 'ä¸­å¥–äº†ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ†',
                                3: 'å¤§å¥–æ¥äº†ï¼æ‰‹æ°”çœŸæ£’ï¼ğŸ’',
                                4: 'è¶…çº§å¤§å¥–ï¼ï¼ï¼å¤ªå¹¸è¿äº†ï¼ğŸŒŸ',
                                5: 'ç»ˆæå¤§å¥–ï¼ï¼ï¼ä¼ è¯´çº§è¿æ°”ï¼ğŸ’°'
                            };
                            
                            // æ‰¾åˆ°å¯¹åº”çš„å¥–åŠ±ç­‰çº§
                            let rewardLevel = 0;
                            if (amount >= 5000) rewardLevel = 5;
                            else if (amount >= 2500) rewardLevel = 4;
                            else if (amount >= 1200) rewardLevel = 3;
                            else if (amount >= 500) rewardLevel = 2;
                            else if (amount >= 200) rewardLevel = 1;
                            
                            setTimeout(() => {
                                addChatMessage(multiplayerData.nickname, levelMessages[rewardLevel] || 'ä¸­å¥–äº†ï¼', 'user');
                            }, 1000);
                        }
                    } else {
                        alert('ğŸ˜… è°¢è°¢æƒ é¡¾ï¼å†è¯•ä¸€æ¬¡å§ï¼');
                    }
                    
                    lastResult.classList.remove('hidden');
                    
                    // é‡ç½®æŒ‰é’®
                    resetGameButtons();
                    
                    // è¿ç»­æ¸¸æˆæ¨¡å¼
                    // å·²ç§»é™¤è¿ç»­æ¸¸æˆæ¨¡å¼ï¼Œæ­¤éƒ¨åˆ†ä¸å†æ‰§è¡Œ
                }, 4000);

            } catch (error) {
                console.error('æ¸¸æˆé”™è¯¯:', error);
                
                let errorMessage = 'æ¸¸æˆå¤±è´¥';
                if (error.message.includes('user rejected')) {
                    errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
                } else if (error.message.includes('insufficient funds')) {
                    errorMessage = 'ä½™é¢ä¸è¶³æ”¯ä»˜gasè´¹ç”¨';
                } else if (error.message.includes('prize pool')) {
                    errorMessage = `${selectedToken}æ¸¸æˆå¥–æ± æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·å°è¯•å…¶ä»–ä»£å¸`;
                } else if (error.message.includes('allowance')) {
                    errorMessage = 'ä»£å¸æˆæƒä¸è¶³ï¼Œè¯·é‡æ–°æˆæƒ';
                } else {
                    errorMessage = `æ¸¸æˆæ‰§è¡Œå¤±è´¥: ${error.reason || error.message}`;
                }
                
                alert('âŒ ' + errorMessage);
                resetGameButtons();
            }
        }

        // è¿ç»­æ¸¸æˆæ¨¡å¼
        function toggleContinuousMode() {
            // å·²ç§»é™¤è¿ç»­æ¸¸æˆæ¨¡å¼ï¼Œæ­¤éƒ¨åˆ†ä¸å†æ‰§è¡Œ
            alert('è¿ç»­æ¸¸æˆåŠŸèƒ½å·²ç§»é™¤ï¼');
        }

        // é‡ç½®æ¸¸æˆæŒ‰é’®çŠ¶æ€ - ç§»é™¤è¿ç»­æ¸¸æˆåŠŸèƒ½
        function resetGameButtons() {
            isSpinning = false;
            // é‡ç½®è½¬ç›˜æ ·å¼
            wheel.style.transition = 'transform 0.5s ease';
            
            spinBtn.innerHTML = '<div class="text-2xl">ğŸ²</div><div class="text-[10px]">å¼€å§‹æ¸¸æˆ</div>';
            spinBtn.disabled = !isApproved;
            startGameBtn.textContent = 'ğŸ® å¼€å§‹æ¸¸æˆ';
            startGameBtn.disabled = !isApproved;
        }

        // é€‰æ‹©ä»£å¸ - ä¿®å¤åˆ‡æ¢é—®é¢˜
        async function selectToken(token) {
            // å·²ç§»é™¤è¿ç»­æ¸¸æˆæ¨¡å¼ï¼Œæ­¤éƒ¨åˆ†ä¸å†æ‰§è¡Œ
            if (isSpinning) {
                alert('æ¸¸æˆè¿›è¡Œä¸­ï¼Œæ— æ³•åˆ‡æ¢ä»£å¸ï¼');
                return;
            }
            
            // å…ˆæ˜¾ç¤ºåˆ‡æ¢çŠ¶æ€
            const oldToken = selectedToken;
            selectedToken = token;
            
            console.log(`åˆ‡æ¢ä»£å¸: ${oldToken} â†’ ${token}`);
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            maoBtn.className = 'token-btn py-4 px-4 rounded-xl font-semibold transition-all ' + 
                (token === 'MAO' ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg scale-105' : 'bg-white/20 text-blue-200 hover:bg-white/30');
            piBtn.className = 'token-btn py-4 px-4 rounded-xl font-semibold transition-all ' + 
                (token === 'PI' ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg scale-105' : 'bg-white/20 text-blue-200 hover:bg-white/30');
            
            // æ›´æ–°æŠ•æ³¨é‡‘é¢æ˜¾ç¤º
            betAmount.textContent = token === 'MAO' ? '100 MAO' : '1,000 PI';
            
            // æ›´æ–°è½¬ç›˜å¥–åŠ±æ˜¾ç¤º
            updateWheelRewards();
            
            // å…ˆåˆ·æ–°ä½™é¢
            if (currentAccount) {
                await loadBalances();
                updateCurrentBalance();
            }
            
            // é‡ç½®æˆæƒçŠ¶æ€ï¼Œå¼ºåˆ¶é‡æ–°æ£€æŸ¥
            isApproved = false;
            
            // å…ˆæ˜¾ç¤ºéœ€è¦æ£€æŸ¥çŠ¶æ€
            approveBtn.style.display = 'block';
            approveBtn.textContent = `ğŸ” æ£€æŸ¥ ${token} æˆæƒ...`;
            approveBtn.disabled = true;
            startGameBtn.disabled = true;
            // å·²ç§»é™¤è¿ç»­æ¸¸æˆæ¨¡å¼ï¼Œæ­¤éƒ¨åˆ†ä¸å†æ‰§è¡Œ
            spinBtn.disabled = true;
            spinBtn.innerHTML = '<div class="text-2xl">â³</div><div class="text-[10px]">æ£€æŸ¥ä¸­</div>';
            
            // å¼‚æ­¥æ£€æŸ¥æ–°ä»£å¸çš„æˆæƒçŠ¶æ€
            if (currentAccount) {
                try {
                    await checkApproval();
                    console.log(`${token} æˆæƒæ£€æŸ¥å®Œæˆï¼ŒisApproved: ${isApproved}`);
                    
                    // æ˜¾ç¤ºåˆ‡æ¢æˆåŠŸæç¤º
                    if (isApproved) {
                        alert(`âœ… åˆ‡æ¢æˆåŠŸï¼\n\nå·²åˆ‡æ¢åˆ° ${token} æ¸¸æˆ\næˆæƒçŠ¶æ€ï¼šå·²æˆæƒ\nå¯ä»¥å¼€å§‹æ¸¸æˆï¼`);
                    } else {
                        alert(`âš ï¸ åˆ‡æ¢æˆåŠŸï¼\n\nå·²åˆ‡æ¢åˆ° ${token} æ¸¸æˆ\næˆæƒçŠ¶æ€ï¼šéœ€è¦æˆæƒ\nè¯·å…ˆæˆæƒ${token}ä»£å¸`);
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥æˆæƒé”™è¯¯:', error);
                    alert(`âŒ åˆ‡æ¢ ${token} æ—¶æ£€æŸ¥æˆæƒå¤±è´¥: ${error.message}`);
                }
            }
        }

        // ä½™é¢æµ‹è¯•å‡½æ•° - è¯¦ç»†è°ƒè¯•ç‰ˆæœ¬
        async function testBalance() {
            if (!currentAccount) {
                alert('âŒ è¯·å…ˆè¿æ¥é’±åŒ…ï¼');
                return;
            }
            
            try {
                // å…ˆåˆ·æ–°ä½™é¢
                await loadBalances();
                
                const maoBalance = parseFloat(balances.MAO) || 0;
                const piBalance = parseFloat(balances.PI) || 0;
                
                // æ£€æŸ¥æˆæƒçŠ¶æ€
                const maoContract = contracts.maoToken;
                const piContract = contracts.piToken;
                const maoAllowance = await maoContract.allowance(currentAccount, CONTRACTS.WHEEL_GAME);
                const piAllowance = await piContract.allowance(currentAccount, CONTRACTS.WHEEL_GAME);
                
                const maoAllowanceFormatted = ethers.utils.formatEther(maoAllowance);
                const piAllowanceFormatted = ethers.utils.formatEther(piAllowance);
                
                // æ¸¸æˆè¦æ±‚
                const maoRequired = 100;
                const piRequired = 1000;
                const maoAuthRequired = 1000;
                const piAuthRequired = 10000;
                
                // æ£€æŸ¥æ¸¸æˆå¯ç”¨æ€§
                const maoGameAvailable = maoBalance >= maoRequired && parseFloat(maoAllowanceFormatted) >= maoAuthRequired;
                const piGameAvailable = piBalance >= piRequired && parseFloat(piAllowanceFormatted) >= piAuthRequired;
                
                const debugInfo = `ğŸ” è¯¦ç»†ä½™é¢æ£€æŸ¥æŠ¥å‘Š\n\n` +
                    `ğŸ’° ä»£å¸ä½™é¢ï¼š\n` +
                    `â€¢ MAO: ${maoBalance.toFixed(6)} (éœ€è¦: ${maoRequired})\n` +
                    `â€¢ PI: ${piBalance.toFixed(6)} (éœ€è¦: ${piRequired})\n\n` +
                    `ğŸ” æˆæƒçŠ¶æ€ï¼š\n` +
                    `â€¢ MAOæˆæƒ: ${parseFloat(maoAllowanceFormatted).toFixed(2)} (éœ€è¦: ${maoAuthRequired})\n` +
                    `â€¢ PIæˆæƒ: ${parseFloat(piAllowanceFormatted).toFixed(2)} (éœ€è¦: ${piAuthRequired})\n\n` +
                    `ğŸ® æ¸¸æˆå¯ç”¨æ€§ï¼š\n` +
                    `â€¢ MAOæ¸¸æˆ: ${maoGameAvailable ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}\n` +
                    `â€¢ PIæ¸¸æˆ: ${piGameAvailable ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}\n\n` +
                    `ğŸ“Š å½“å‰é€‰æ‹©: ${selectedToken}\n` +
                    `ğŸ¯ å½“å‰æ¸¸æˆ: ${selectedToken === 'MAO' ? (maoGameAvailable ? 'âœ… å¯ä»¥å¼€å§‹' : 'âŒ æ— æ³•å¼€å§‹') : (piGameAvailable ? 'âœ… å¯ä»¥å¼€å§‹' : 'âŒ æ— æ³•å¼€å§‹')}`;
                
                alert(debugInfo);
                console.log('ä½™é¢è°ƒè¯•ä¿¡æ¯:', {
                    balances: { mao: maoBalance, pi: piBalance },
                    allowances: { mao: maoAllowanceFormatted, pi: piAllowanceFormatted },
                    gameAvailable: { mao: maoGameAvailable, pi: piGameAvailable },
                    selectedToken,
                    isApproved
                });
                
            } catch (error) {
                console.error('ä½™é¢æµ‹è¯•é”™è¯¯:', error);
                alert('âŒ ä½™é¢æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // äº‹ä»¶ç›‘å¬
        connectBtn.addEventListener('click', connectWallet);
        approveBtn.addEventListener('click', approveTokens);
        spinBtn.addEventListener('click', startGame);
        startGameBtn.addEventListener('click', startGame);
        // å·²ç§»é™¤ï¼šcontinuousBtn.addEventListener('click', toggleContinuousMode); - å–æ¶ˆè¿ç»­æ¸¸æˆåŠŸèƒ½
        maoBtn.addEventListener('click', async () => await selectToken('MAO'));
        piBtn.addEventListener('click', async () => await selectToken('PI'));
        testBalanceBtn.addEventListener('click', testBalance);

        // è‡ªåŠ¨è¿æ¥å·²è¿æ¥çš„é’±åŒ…
        window.addEventListener('load', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.log('è‡ªåŠ¨è¿æ¥å¤±è´¥:', error);
                }
            }
        });

        // ç›‘å¬è´¦æˆ·å˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else if (accounts[0] !== currentAccount) {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }

        // ===== å¤šäººäº’åŠ¨åŠŸèƒ½ç³»ç»Ÿ =====
        
        // å¤šäººåŠŸèƒ½çŠ¶æ€
        let multiplayerData = {
            nickname: localStorage.getItem('mao_nickname') || '',
            onlineCount: 42,
            leaderboard: [],
            recentWins: [],
            chatMessages: []
        };

        // éšæœºç©å®¶åç§°ç”Ÿæˆå™¨
        const playerNames = ['MAO***', 'PI***', 'ALV***', 'Game***', 'Lucky***', 'Win***', 'Big***', 'Gold***'];
        const numberSuffixes = ['88', '99', '66', '77', '168', '888', '666', '777', '999'];

        function generateRandomPlayer() {
            const name = playerNames[Math.floor(Math.random() * playerNames.length)];
            const number = numberSuffixes[Math.floor(Math.random() * numberSuffixes.length)];
            return name + number;
        }

        // æ˜µç§°è®¾ç½®åŠŸèƒ½
        function setupNickname() {
            const setNicknameBtn = document.getElementById('setNicknameBtn');
            const currentNickname = document.getElementById('currentNickname');
            
            if (multiplayerData.nickname) {
                currentNickname.textContent = multiplayerData.nickname;
            }
            
            setNicknameBtn.addEventListener('click', () => {
                const nickname = prompt('è®¾ç½®æ‚¨çš„æ¸¸æˆæ˜µç§° (æœ€å¤š8ä¸ªå­—ç¬¦):', multiplayerData.nickname);
                if (nickname && nickname.trim() && nickname.length <= 8) {
                    multiplayerData.nickname = nickname.trim();
                    localStorage.setItem('mao_nickname', multiplayerData.nickname);
                    currentNickname.textContent = multiplayerData.nickname;
                    
                    // å‘é€ç³»ç»Ÿæ¶ˆæ¯
                    addChatMessage('ç³»ç»Ÿ', `æ¬¢è¿ ${multiplayerData.nickname} åŠ å…¥æ¸¸æˆï¼`, 'system');
                }
            });
        }

        // åœ¨çº¿äººæ•°æ¨¡æ‹Ÿ
        function updateOnlineCount() {
            const onlineCountEl = document.getElementById('onlineCount');
            // æ¨¡æ‹Ÿåœ¨çº¿äººæ•°æ³¢åŠ¨ (30-60äºº)
            multiplayerData.onlineCount = 30 + Math.floor(Math.random() * 31);
            onlineCountEl.textContent = multiplayerData.onlineCount;
        }

        // æ’è¡Œæ¦œåŠŸèƒ½
        function generateLeaderboard() {
            const leaderboard = [];
            for (let i = 0; i < 5; i++) {
                leaderboard.push({
                    rank: i + 1,
                    player: generateRandomPlayer(),
                    wins: Math.floor(Math.random() * 50) + 10,
                    amount: Math.floor(Math.random() * 10000) + 1000
                });
            }
            // æŒ‰å¥–åŠ±é‡‘é¢æ’åº
            leaderboard.sort((a, b) => b.amount - a.amount);
            multiplayerData.leaderboard = leaderboard;
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const leaderboardEl = document.getElementById('leaderboard');
            leaderboardEl.innerHTML = multiplayerData.leaderboard.map((player, index) => `
                <div class="leaderboard-item flex justify-between items-center p-2 rounded-lg ${index === 0 ? 'bg-yellow-500/20' : 'bg-white/5'}">
                    <div class="flex items-center gap-2">
                        <span class="text-yellow-400 font-bold text-lg">${index === 0 ? 'ğŸ‘‘' : '#' + player.rank}</span>
                        <span class="text-white font-semibold">${player.player}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-bold">${player.amount.toLocaleString()} MAO</div>
                        <div class="text-blue-300 text-xs">${player.wins} æ¬¡ä¸­å¥–</div>
                    </div>
                </div>
            `).join('');
        }

        // æœ€è¿‘ä¸­å¥–è®°å½•
        function addRecentWin(player, amount, token, isUser = false) {
            const win = {
                id: Date.now(),
                player: player || generateRandomPlayer(),
                amount,
                token,
                timestamp: new Date(),
                isUser
            };
            
            multiplayerData.recentWins.unshift(win);
            if (multiplayerData.recentWins.length > 10) {
                multiplayerData.recentWins.pop();
            }
            
            renderRecentWins();
            
            // æ›´æ–°æ´»è·ƒç©å®¶æ˜¾ç¤º
            if (!isUser) {
                updateActivePlayer(win);
            }
        }

        function renderRecentWins() {
            const recentWinsEl = document.getElementById('recentWins');
            recentWinsEl.innerHTML = multiplayerData.recentWins.map(win => `
                <div class="recent-win flex justify-between items-center p-2 rounded-lg bg-white/5 ${win.isUser ? 'border border-yellow-400' : ''}">
                    <div class="flex items-center gap-2">
                        <span class="text-${win.amount > 1000 ? 'yellow' : 'green'}-400">${getRewardEmoji(win.amount)}</span>
                        <span class="text-white font-semibold">${win.player}</span>
                        ${win.isUser ? '<span class="text-yellow-400 text-xs">(ä½ )</span>' : ''}
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-bold">+${win.amount} ${win.token}</div>
                        <div class="text-blue-300 text-xs">${getTimeAgo(win.timestamp)}</div>
                    </div>
                </div>
            `).join('');
        }

        function getRewardEmoji(amount) {
            if (amount >= 3000) return 'ğŸ’°';
            if (amount >= 1500) return 'ğŸŒŸ';
            if (amount >= 800) return 'ğŸ’';
            if (amount >= 400) return 'ğŸ†';
            if (amount >= 150) return 'ğŸ';
            return 'ğŸ’«';
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((new Date() - timestamp) / 1000);
            if (seconds < 60) return 'åˆšåˆš';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'åˆ†é’Ÿå‰';
            return Math.floor(seconds / 3600) + 'å°æ—¶å‰';
        }

        function updateActivePlayer(win) {
            const activePlayerEl = document.getElementById('activePlayer');
            const activeAmount = document.querySelector('#activePlayer').parentElement;
            activePlayerEl.textContent = win.player;
            const amountSpan = activeAmount.querySelector('.text-green-400');
            amountSpan.textContent = `${win.amount} ${win.token}`;
        }

        // èŠå¤©ç³»ç»Ÿ
        function setupChat() {
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');
            
            // å›è½¦å‘é€
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // ç‚¹å‡»å‘é€
            sendChatBtn.addEventListener('click', sendMessage);
            
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message && multiplayerData.nickname) {
                    addChatMessage(multiplayerData.nickname, message, 'user');
                    chatInput.value = '';
                    
                    // æ¨¡æ‹Ÿå…¶ä»–ç©å®¶å›å¤
                    setTimeout(() => {
                        const responses = [
                            'å¥½è¿ï¼', 'æ­å–œï¼', 'æˆ‘ä¹Ÿè¦è¯•è¯•', 'å‰å®³ï¼', 'å†æ¥ä¸€æŠŠ',
                            'æ‰‹æ°”çœŸå¥½', 'åˆ†äº«ä¸€ä¸‹è¿æ°”', 'ä¸‹æ³¨äº†ï¼', 'ä¸€èµ·èµ¢å¤§å¥–',
                            'å¤ªå¹¸è¿äº†', 'ç»§ç»­åŠ æ²¹', 'ç¥å¥½è¿ï¼'
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addChatMessage(generateRandomPlayer(), randomResponse, 'other');
                    }, 1000 + Math.random() * 3000);
                }
            }
        }

        function addChatMessage(player, message, type) {
            const chatMessage = {
                id: Date.now(),
                player,
                message,
                type,
                timestamp: new Date()
            };
            
            multiplayerData.chatMessages.unshift(chatMessage);
            if (multiplayerData.chatMessages.length > 20) {
                multiplayerData.chatMessages.pop();
            }
            
            renderChatMessages();
        }

        function renderChatMessages() {
            const chatMessagesEl = document.getElementById('chatMessages');
            chatMessagesEl.innerHTML = multiplayerData.chatMessages.slice(0, 10).map(msg => `
                <div class="chat-message p-2 rounded-lg ${msg.type === 'user' ? 'bg-blue-500/20' : msg.type === 'system' ? 'bg-green-500/20' : 'bg-white/5'}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <span class="text-${msg.type === 'user' ? 'blue' : msg.type === 'system' ? 'green' : 'yellow'}-400 font-semibold text-sm">${msg.player}:</span>
                            <span class="text-white text-sm ml-2">${msg.message}</span>
                        </div>
                        <span class="text-blue-300 text-xs">${getTimeAgo(msg.timestamp)}</span>
                    </div>
                </div>
            `).reverse().join('');
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
        }

        // ç”ŸæˆéšæœºèŠå¤©æ¶ˆæ¯
        function generateRandomChatMessages() {
            const messages = [
                'åˆšåˆšä¸­äº†å¤§å¥–ï¼', 'è¿æ°”ä¸é”™å•Š', 'ç»§ç»­ä¸‹æ³¨', 'è¿™ä¸ªæ¸¸æˆå¾ˆå¥½ç©',
                'å¸Œæœ›ä¸‹æŠŠèƒ½ä¸­', 'æ‰‹æ°”æ¥äº†', 'åŠ æ²¹åŠ æ²¹', 'ä»Šå¤©è¿æ°”å¾ˆå¥½',
                'è½¬ç›˜çœŸåˆºæ¿€', 'æœŸå¾…å¤§å¥–', 'ä¸€èµ·ç©æ¸¸æˆ', 'ç¥å¤§å®¶å¥½è¿'
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            addChatMessage(generateRandomPlayer(), message, 'other');
        }

        // ç”Ÿæˆéšæœºæ´»åŠ¨
        function generateRandomActivity() {
            // éšæœºä¸­å¥–
            if (Math.random() < 0.3) {
                const amounts = [50, 200, 500, 1200, 2500, 5000];
                const amount = amounts[Math.floor(Math.random() * amounts.length)];
                addRecentWin(null, amount, 'MAO');
            }
            
            // éšæœºèŠå¤©
            if (Math.random() < 0.2) {
                generateRandomChatMessages();
            }
        }

        // åˆå§‹åŒ–å¤šäººåŠŸèƒ½
        function initMultiplayer() {
            setupNickname();
            setupChat();
            generateLeaderboard();
            
            // æ·»åŠ ä¸€äº›åˆå§‹æ•°æ®
            for (let i = 0; i < 5; i++) {
                const amounts = [50, 200, 500, 1200, 2500];
                const amount = amounts[Math.floor(Math.random() * amounts.length)];
                const timestamp = new Date(Date.now() - Math.random() * 3600000); // è¿‡å»1å°æ—¶å†…
                multiplayerData.recentWins.push({
                    id: Date.now() + i,
                    player: generateRandomPlayer(),
                    amount,
                    token: 'MAO',
                    timestamp,
                    isUser: false
                });
            }
            renderRecentWins();
            
            // æ·»åŠ åˆå§‹èŠå¤©æ¶ˆæ¯
            const welcomeMessages = [
                { player: 'ç³»ç»Ÿ', message: 'æ¬¢è¿æ¥åˆ°MAOè½¬ç›˜æ¸¸æˆï¼', type: 'system' },
                { player: 'MAO***88', message: 'å¤§å®¶ä¸€èµ·æ¥ç©è½¬ç›˜æ¸¸æˆï¼', type: 'other' },
                { player: 'Lucky***168', message: 'åˆšåˆšä¸­äº†2500 MAOï¼Œæ‰‹æ°”ä¸é”™ï¼', type: 'other' }
            ];
            
            welcomeMessages.forEach(msg => {
                addChatMessage(msg.player, msg.message, msg.type);
            });
            
            // å®šæ—¶æ›´æ–°
            setInterval(() => {
                updateOnlineCount();
                generateRandomActivity();
            }, 5000);
            
            // å®šæ—¶æ›´æ–°æ’è¡Œæ¦œ
            setInterval(() => {
                generateLeaderboard();
            }, 30000);
        }

        // æ¸¸æˆç»“æœå¤„ç†å¢å¼º
        const originalStartGame = startGame;
        startGame = async function() {
            await originalStartGame();
            
            // å¦‚æœç”¨æˆ·æœ‰æ˜µç§°ä¸”æ¸¸æˆæˆåŠŸï¼Œæ·»åŠ åˆ°æœ€è¿‘ä¸­å¥–
            if (multiplayerData.nickname && !isSpinning) {
                // è¿™é‡Œå¯ä»¥åœ¨æ¸¸æˆæˆåŠŸåè°ƒç”¨
                // addRecentWin(multiplayerData.nickname, rewardAmount, selectedToken, true);
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å¤šäººåŠŸèƒ½
        window.addEventListener('load', () => {
            setTimeout(initMultiplayer, 1000);
        });
    </script>
</body>
</html> 